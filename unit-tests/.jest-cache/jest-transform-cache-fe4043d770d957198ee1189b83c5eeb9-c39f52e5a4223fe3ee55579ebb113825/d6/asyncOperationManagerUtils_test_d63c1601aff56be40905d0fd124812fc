d8526e52c30e3ef696760cca6355e7d8
"use strict";

var _chai = require("chai");

var _asyncOperationManagerUtils = require("../asyncOperationManagerUtils");
/* eslint-env jest */


describe('asyncOperationManagerUtils', function () {
  var state;
  beforeEach(function () {
    state = {};
  });
  describe('registerAsyncOperationDescriptors', function () {
    it('should accept object argument to register one async operation decriptor to state', function () {
      (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
        descriptorId: 'FETCH_ALL_BEVERAGES_FOR_ORG',
        requiredParams: ['orgId'],
        operationType: 'READ'
      });
      var registeredAsyncDescriptors = (0, _asyncOperationManagerUtils.getRegisteredAsyncDescriptors)(state);
      (0, _chai.expect)(Object.keys(registeredAsyncDescriptors)).to.have.lengthOf(1);
      (0, _chai.expect)(registeredAsyncDescriptors).to.have.all.keys('FETCH_ALL_BEVERAGES_FOR_ORG');
    });
    it('should accept array argument to register multiple async operation descriptors to state', function () {
      (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)([{
        descriptorId: 'FETCH_ALL_BEVERAGES_FOR_ORG',
        requiredParams: ['orgId'],
        operationType: 'READ'
      }, {
        descriptorId: 'DRINK_BEVERAGE_BY_ID_FOR_ORG',
        requiredParams: ['orgId', 'beverageId'],
        operationType: 'WRITE'
      }]);
      var registeredAsyncDescriptors = (0, _asyncOperationManagerUtils.getRegisteredAsyncDescriptors)(state);
      (0, _chai.expect)(Object.keys(registeredAsyncDescriptors)).to.have.lengthOf(2);
      (0, _chai.expect)(registeredAsyncDescriptors).to.have.all.keys('FETCH_ALL_BEVERAGES_FOR_ORG', 'DRINK_BEVERAGE_BY_ID_FOR_ORG');
    });
  });
  describe('getAsyncOperationDescriptor', function () {
    it('should successfully return a registered asyncOperationDescriptor', function () {
      (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
        descriptorId: 'FETCH_PERSON_DATA_BY_ID',
        requiredParams: ['personId'],
        operationType: 'READ',
        // optional values
        parentAsyncOperation: 'FETCH_ALL_PERSON_DATA',
        debug: false,
        alwaysImmutable: false,
        minCacheTime: 5000,
        maxCacheTime: 60000
      });
      var asyncOperationDescriptor = (0, _asyncOperationManagerUtils.getAsyncOperationDescriptor)('FETCH_PERSON_DATA_BY_ID');
      (0, _chai.expect)(asyncOperationDescriptor).to.be.an('object');
      (0, _chai.expect)(asyncOperationDescriptor).to.matchSnapshot('well formed async operation descriptor');
    });
  });
  describe('getStateForOperationAfterStep', function () {
    beforeEach(function () {
      var dateNowStub = jest.fn(function () {
        return 1530518207007;
      });
      global.Date.now = dateNowStub;
    });
    describe('READ async operations', function () {
      it('should update state to read show async operation as pending state from initial state', function () {
        (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
          descriptorId: 'FETCH_PERSON_DATA',
          requiredParams: ['personId'],
          operationType: 'READ'
        });
        var transformedState = (0, _asyncOperationManagerUtils.getStateForOperationAfterStep)(state, 'BEGIN_ASYNC_OPERATION', 'FETCH_PERSON_DATA', {
          personId: 111
        });
        (0, _chai.expect)(transformedState).to.nested.include({
          'FETCH_PERSON_DATA_111.fetchStatus': 'PENDING'
        });
        (0, _chai.expect)(transformedState).to.matchSnapshot('updated state showing begun read async operation');
      });
      it('should update state to read show async operation as successful state from pending state', function () {
        state = {
          FETCH_PERSON_DATA_111: {
            descriptorId: 'FETCH_PERSON_DATA',
            fetchStatus: 'PENDING',
            dataStatus: 'ABSENT',
            message: null,
            lastFetchStatusTime: 0,
            lastDataStatusTime: 0,
            personId: 111
          }
        };
        (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
          descriptorId: 'FETCH_PERSON_DATA',
          requiredParams: ['personId'],
          operationType: 'READ'
        });
        var transformedState = (0, _asyncOperationManagerUtils.getStateForOperationAfterStep)(state, 'RESOLVE_ASYNC_OPERATION', 'FETCH_PERSON_DATA', {
          personId: 111
        });
        (0, _chai.expect)(transformedState).to.nested.include({
          'FETCH_PERSON_DATA_111.fetchStatus': 'SUCCESSFUL'
        });
        (0, _chai.expect)(transformedState).to.matchSnapshot('updated state showing successful read async operation');
      });
      it('should update state to read show async operation as failed state from pending state', function () {
        state = {
          FETCH_PERSON_DATA_111: {
            descriptorId: 'FETCH_PERSON_DATA',
            fetchStatus: 'PENDING',
            dataStatus: 'ABSENT',
            message: null,
            lastFetchStatusTime: 0,
            lastDataStatusTime: 0,
            personId: 111
          }
        };
        (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
          descriptorId: 'FETCH_PERSON_DATA',
          requiredParams: ['personId'],
          operationType: 'READ'
        });
        var transformedState = (0, _asyncOperationManagerUtils.getStateForOperationAfterStep)(state, 'REJECT_ASYNC_OPERATION', 'FETCH_PERSON_DATA', {
          personId: 111
        });
        (0, _chai.expect)(transformedState).to.nested.include({
          'FETCH_PERSON_DATA_111.fetchStatus': 'FAILED'
        });
        (0, _chai.expect)(transformedState).to.matchSnapshot('updated state showing rejected async operation');
      });
    });
    describe('WRITE async operations', function () {
      it('should update state to show write async operation as pending state from initial state', function () {
        (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
          descriptorId: 'UPDATE_PERSON_DATA',
          requiredParams: ['personId'],
          operationType: 'WRITE'
        });
        var transformedState = (0, _asyncOperationManagerUtils.getStateForOperationAfterStep)(state, 'BEGIN_ASYNC_OPERATION', 'UPDATE_PERSON_DATA', {
          personId: 111
        });
        (0, _chai.expect)(transformedState).to.nested.include({
          'UPDATE_PERSON_DATA_111.fetchStatus': 'PENDING'
        });
        (0, _chai.expect)(transformedState).to.matchSnapshot('updated state showing pending write async operation');
      });
      it('should update state to show write async operation as successful state from pending state', function () {
        state = {
          UPDATE_PERSON_DATA_111: {
            descriptorId: 'UPDATE_PERSON_DATA',
            fetchStatus: 'PENDING',
            message: null,
            lastFetchStatusTime: 0,
            lastDataStatusTime: 0,
            personId: 111
          }
        };
        (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
          descriptorId: 'UPDATE_PERSON_DATA',
          requiredParams: ['personId'],
          operationType: 'WRITE'
        });
        var transformedState = (0, _asyncOperationManagerUtils.getStateForOperationAfterStep)(state, 'RESOLVE_ASYNC_OPERATION', 'UPDATE_PERSON_DATA', {
          personId: 111
        });
        (0, _chai.expect)(transformedState).to.nested.include({
          'UPDATE_PERSON_DATA_111.fetchStatus': 'SUCCESSFUL'
        });
        (0, _chai.expect)(transformedState).to.matchSnapshot('updated state showing successful write async operation');
      });
      it('should update state to show write async operation as failed state from pending state', function () {
        state = {
          UPDATE_PERSON_DATA_111: {
            descriptorId: 'UPDATE_PERSON_DATA',
            fetchStatus: 'PENDING',
            message: null,
            lastFetchStatusTime: 0,
            lastDataStatusTime: 0,
            personId: 111
          }
        };
        (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
          descriptorId: 'UPDATE_PERSON_DATA',
          requiredParams: ['personId'],
          operationType: 'WRITE'
        });
        var transformedState = (0, _asyncOperationManagerUtils.getStateForOperationAfterStep)(state, 'REJECT_ASYNC_OPERATION', 'UPDATE_PERSON_DATA', {
          personId: 111
        });
        (0, _chai.expect)(transformedState).to.nested.include({
          'UPDATE_PERSON_DATA_111.fetchStatus': 'FAILED'
        });
        (0, _chai.expect)(transformedState).to.matchSnapshot('updated state showing failed write async operation');
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzX3Rlc3QuanMiXSwibmFtZXMiOlsiX2NoYWkiLCJyZXF1aXJlIiwiX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzIiwiZGVzY3JpYmUiLCJzdGF0ZSIsImJlZm9yZUVhY2giLCJpdCIsInJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyIsImRlc2NyaXB0b3JJZCIsInJlcXVpcmVkUGFyYW1zIiwib3BlcmF0aW9uVHlwZSIsInJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzIiwiZ2V0UmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMiLCJleHBlY3QiLCJPYmplY3QiLCJrZXlzIiwidG8iLCJoYXZlIiwibGVuZ3RoT2YiLCJhbGwiLCJwYXJlbnRBc3luY09wZXJhdGlvbiIsImRlYnVnIiwiYWx3YXlzSW1tdXRhYmxlIiwibWluQ2FjaGVUaW1lIiwibWF4Q2FjaGVUaW1lIiwiYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwiZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwiYmUiLCJhbiIsIm1hdGNoU25hcHNob3QiLCJkYXRlTm93U3R1YiIsImplc3QiLCJmbiIsImdsb2JhbCIsIkRhdGUiLCJub3ciLCJ0cmFuc2Zvcm1lZFN0YXRlIiwiZ2V0U3RhdGVGb3JPcGVyYXRpb25BZnRlclN0ZXAiLCJwZXJzb25JZCIsIm5lc3RlZCIsImluY2x1ZGUiLCJGRVRDSF9QRVJTT05fREFUQV8xMTEiLCJmZXRjaFN0YXR1cyIsImRhdGFTdGF0dXMiLCJtZXNzYWdlIiwibGFzdEZldGNoU3RhdHVzVGltZSIsImxhc3REYXRhU3RhdHVzVGltZSIsIlVQREFURV9QRVJTT05fREFUQV8xMTEiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQUlBLEtBQUssR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBbkI7O0FBRUEsSUFBSUMsMkJBQTJCLEdBQUdELE9BQU8sQ0FBQywrQkFBRCxDQUF6QztBQUVBOzs7QUFDQUUsUUFB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QywyQkFBMkIsQ0FBQ21DLDZCQUFoQyxFQUErRGpDLEtBQS9ELEVBQXNFLHdCQUF0RSxFQUFnRyxvQkFBaEcsRUFBc0g7QUFDM0lrQyxVQUFBQSxRQUFRLEVBQUU7QUFEaUksU0FBdEgsQ0FBdkI7QUFHQSxTQUFDLEdBQUd0QyxLQUFLLENBQUNhLE1BQVYsRUFBa0J1QixnQkFBbEIsRUFBb0NwQixFQUFwQyxDQUF1Q3VCLE1BQXZDLENBQThDQyxPQUE5QyxDQUFzRDtBQUNwRCxnREFBc0M7QUFEYyxTQUF0RDtBQUdBLFNBQUMsR0FBR3hDLEtBQUssQ0FBQ2EsTUFBVixFQUFrQnVCLGdCQUFsQixFQUFvQ3BCLEVBQXBDLENBQXVDYSxhQUF2QyxDQUFxRCxvREFBckQ7QUFDRCxPQXZCQyxDQUFGO0FBd0JELEtBL0RPLENBQVI7QUFnRUQsR0F6SU8sQ0FBUjtBQTBJRCxDQTNMTyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfY2hhaSA9IHJlcXVpcmUoXCJjaGFpXCIpO1xuXG52YXIgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzID0gcmVxdWlyZShcIi4uL2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzXCIpO1xuXG4vKiBlc2xpbnQtZW52IGplc3QgKi9cbmRlc2NyaWJlKCdhc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscycsIGZ1bmN0aW9uICgpIHtcbiAgdmFyIHN0YXRlO1xuICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICBzdGF0ZSA9IHt9O1xuICB9KTtcbiAgZGVzY3JpYmUoJ3JlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBvYmplY3QgYXJndW1lbnQgdG8gcmVnaXN0ZXIgb25lIGFzeW5jIG9wZXJhdGlvbiBkZWNyaXB0b3IgdG8gc3RhdGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAoMCwgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLnJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycykoe1xuICAgICAgICBkZXNjcmlwdG9ySWQ6ICdGRVRDSF9BTExfQkVWRVJBR0VTX0ZPUl9PUkcnLFxuICAgICAgICByZXF1aXJlZFBhcmFtczogWydvcmdJZCddLFxuICAgICAgICBvcGVyYXRpb25UeXBlOiAnUkVBRCdcbiAgICAgIH0pO1xuICAgICAgdmFyIHJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzID0gKDAsIF9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscy5nZXRSZWdpc3RlcmVkQXN5bmNEZXNjcmlwdG9ycykoc3RhdGUpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoT2JqZWN0LmtleXMocmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMpKS50by5oYXZlLmxlbmd0aE9mKDEpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkocmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMpLnRvLmhhdmUuYWxsLmtleXMoJ0ZFVENIX0FMTF9CRVZFUkFHRVNfRk9SX09SRycpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgYWNjZXB0IGFycmF5IGFyZ3VtZW50IHRvIHJlZ2lzdGVyIG11bHRpcGxlIGFzeW5jIG9wZXJhdGlvbiBkZXNjcmlwdG9ycyB0byBzdGF0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKShbe1xuICAgICAgICBkZXNjcmlwdG9ySWQ6ICdGRVRDSF9BTExfQkVWRVJBR0VTX0ZPUl9PUkcnLFxuICAgICAgICByZXF1aXJlZFBhcmFtczogWydvcmdJZCddLFxuICAgICAgICBvcGVyYXRpb25UeXBlOiAnUkVBRCdcbiAgICAgIH0sIHtcbiAgICAgICAgZGVzY3JpcHRvcklkOiAnRFJJTktfQkVWRVJBR0VfQllfSURfRk9SX09SRycsXG4gICAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ29yZ0lkJywgJ2JldmVyYWdlSWQnXSxcbiAgICAgICAgb3BlcmF0aW9uVHlwZTogJ1dSSVRFJ1xuICAgICAgfV0pO1xuICAgICAgdmFyIHJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzID0gKDAsIF9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscy5nZXRSZWdpc3RlcmVkQXN5bmNEZXNjcmlwdG9ycykoc3RhdGUpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoT2JqZWN0LmtleXMocmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMpKS50by5oYXZlLmxlbmd0aE9mKDIpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkocmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMpLnRvLmhhdmUuYWxsLmtleXMoJ0ZFVENIX0FMTF9CRVZFUkFHRVNfRk9SX09SRycsICdEUklOS19CRVZFUkFHRV9CWV9JRF9GT1JfT1JHJyk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IHJldHVybiBhIHJlZ2lzdGVyZWQgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yJywgZnVuY3Rpb24gKCkge1xuICAgICAgKDAsIF9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscy5yZWdpc3RlckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMpKHtcbiAgICAgICAgZGVzY3JpcHRvcklkOiAnRkVUQ0hfUEVSU09OX0RBVEFfQllfSUQnLFxuICAgICAgICByZXF1aXJlZFBhcmFtczogWydwZXJzb25JZCddLFxuICAgICAgICBvcGVyYXRpb25UeXBlOiAnUkVBRCcsXG4gICAgICAgIC8vIG9wdGlvbmFsIHZhbHVlc1xuICAgICAgICBwYXJlbnRBc3luY09wZXJhdGlvbjogJ0ZFVENIX0FMTF9QRVJTT05fREFUQScsXG4gICAgICAgIGRlYnVnOiBmYWxzZSxcbiAgICAgICAgYWx3YXlzSW1tdXRhYmxlOiBmYWxzZSxcbiAgICAgICAgbWluQ2FjaGVUaW1lOiA1MDAwLFxuICAgICAgICBtYXhDYWNoZVRpbWU6IDYwMDAwXG4gICAgICB9KTtcbiAgICAgIHZhciBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSAoMCwgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLmdldEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcikoJ0ZFVENIX1BFUlNPTl9EQVRBX0JZX0lEJyk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpLnRvLmJlLmFuKCdvYmplY3QnKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcikudG8ubWF0Y2hTbmFwc2hvdCgnd2VsbCBmb3JtZWQgYXN5bmMgb3BlcmF0aW9uIGRlc2NyaXB0b3InKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdnZXRTdGF0ZUZvck9wZXJhdGlvbkFmdGVyU3RlcCcsIGZ1bmN0aW9uICgpIHtcbiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBkYXRlTm93U3R1YiA9IGplc3QuZm4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gMTUzMDUxODIwNzAwNztcbiAgICAgIH0pO1xuICAgICAgZ2xvYmFsLkRhdGUubm93ID0gZGF0ZU5vd1N0dWI7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoJ1JFQUQgYXN5bmMgb3BlcmF0aW9ucycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGl0KCdzaG91bGQgdXBkYXRlIHN0YXRlIHRvIHJlYWQgc2hvdyBhc3luYyBvcGVyYXRpb24gYXMgcGVuZGluZyBzdGF0ZSBmcm9tIGluaXRpYWwgc3RhdGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSh7XG4gICAgICAgICAgZGVzY3JpcHRvcklkOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJ10sXG4gICAgICAgICAgb3BlcmF0aW9uVHlwZTogJ1JFQUQnXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdHJhbnNmb3JtZWRTdGF0ZSA9ICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMuZ2V0U3RhdGVGb3JPcGVyYXRpb25BZnRlclN0ZXApKHN0YXRlLCAnQkVHSU5fQVNZTkNfT1BFUkFUSU9OJywgJ0ZFVENIX1BFUlNPTl9EQVRBJywge1xuICAgICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgICAgfSk7XG4gICAgICAgICgwLCBfY2hhaS5leHBlY3QpKHRyYW5zZm9ybWVkU3RhdGUpLnRvLm5lc3RlZC5pbmNsdWRlKHtcbiAgICAgICAgICAnRkVUQ0hfUEVSU09OX0RBVEFfMTExLmZldGNoU3RhdHVzJzogJ1BFTkRJTkcnXG4gICAgICAgIH0pO1xuICAgICAgICAoMCwgX2NoYWkuZXhwZWN0KSh0cmFuc2Zvcm1lZFN0YXRlKS50by5tYXRjaFNuYXBzaG90KCd1cGRhdGVkIHN0YXRlIHNob3dpbmcgYmVndW4gcmVhZCBhc3luYyBvcGVyYXRpb24nKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCB1cGRhdGUgc3RhdGUgdG8gcmVhZCBzaG93IGFzeW5jIG9wZXJhdGlvbiBhcyBzdWNjZXNzZnVsIHN0YXRlIGZyb20gcGVuZGluZyBzdGF0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3RhdGUgPSB7XG4gICAgICAgICAgRkVUQ0hfUEVSU09OX0RBVEFfMTExOiB7XG4gICAgICAgICAgICBkZXNjcmlwdG9ySWQ6ICdGRVRDSF9QRVJTT05fREFUQScsXG4gICAgICAgICAgICBmZXRjaFN0YXR1czogJ1BFTkRJTkcnLFxuICAgICAgICAgICAgZGF0YVN0YXR1czogJ0FCU0VOVCcsXG4gICAgICAgICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgbGFzdEZldGNoU3RhdHVzVGltZTogMCxcbiAgICAgICAgICAgIGxhc3REYXRhU3RhdHVzVGltZTogMCxcbiAgICAgICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSh7XG4gICAgICAgICAgZGVzY3JpcHRvcklkOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJ10sXG4gICAgICAgICAgb3BlcmF0aW9uVHlwZTogJ1JFQUQnXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdHJhbnNmb3JtZWRTdGF0ZSA9ICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMuZ2V0U3RhdGVGb3JPcGVyYXRpb25BZnRlclN0ZXApKHN0YXRlLCAnUkVTT0xWRV9BU1lOQ19PUEVSQVRJT04nLCAnRkVUQ0hfUEVSU09OX0RBVEEnLCB7XG4gICAgICAgICAgcGVyc29uSWQ6IDExMVxuICAgICAgICB9KTtcbiAgICAgICAgKDAsIF9jaGFpLmV4cGVjdCkodHJhbnNmb3JtZWRTdGF0ZSkudG8ubmVzdGVkLmluY2x1ZGUoe1xuICAgICAgICAgICdGRVRDSF9QRVJTT05fREFUQV8xMTEuZmV0Y2hTdGF0dXMnOiAnU1VDQ0VTU0ZVTCdcbiAgICAgICAgfSk7XG4gICAgICAgICgwLCBfY2hhaS5leHBlY3QpKHRyYW5zZm9ybWVkU3RhdGUpLnRvLm1hdGNoU25hcHNob3QoJ3VwZGF0ZWQgc3RhdGUgc2hvd2luZyBzdWNjZXNzZnVsIHJlYWQgYXN5bmMgb3BlcmF0aW9uJyk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgdXBkYXRlIHN0YXRlIHRvIHJlYWQgc2hvdyBhc3luYyBvcGVyYXRpb24gYXMgZmFpbGVkIHN0YXRlIGZyb20gcGVuZGluZyBzdGF0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3RhdGUgPSB7XG4gICAgICAgICAgRkVUQ0hfUEVSU09OX0RBVEFfMTExOiB7XG4gICAgICAgICAgICBkZXNjcmlwdG9ySWQ6ICdGRVRDSF9QRVJTT05fREFUQScsXG4gICAgICAgICAgICBmZXRjaFN0YXR1czogJ1BFTkRJTkcnLFxuICAgICAgICAgICAgZGF0YVN0YXR1czogJ0FCU0VOVCcsXG4gICAgICAgICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgbGFzdEZldGNoU3RhdHVzVGltZTogMCxcbiAgICAgICAgICAgIGxhc3REYXRhU3RhdHVzVGltZTogMCxcbiAgICAgICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSh7XG4gICAgICAgICAgZGVzY3JpcHRvcklkOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJ10sXG4gICAgICAgICAgb3BlcmF0aW9uVHlwZTogJ1JFQUQnXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdHJhbnNmb3JtZWRTdGF0ZSA9ICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMuZ2V0U3RhdGVGb3JPcGVyYXRpb25BZnRlclN0ZXApKHN0YXRlLCAnUkVKRUNUX0FTWU5DX09QRVJBVElPTicsICdGRVRDSF9QRVJTT05fREFUQScsIHtcbiAgICAgICAgICBwZXJzb25JZDogMTExXG4gICAgICAgIH0pO1xuICAgICAgICAoMCwgX2NoYWkuZXhwZWN0KSh0cmFuc2Zvcm1lZFN0YXRlKS50by5uZXN0ZWQuaW5jbHVkZSh7XG4gICAgICAgICAgJ0ZFVENIX1BFUlNPTl9EQVRBXzExMS5mZXRjaFN0YXR1cyc6ICdGQUlMRUQnXG4gICAgICAgIH0pO1xuICAgICAgICAoMCwgX2NoYWkuZXhwZWN0KSh0cmFuc2Zvcm1lZFN0YXRlKS50by5tYXRjaFNuYXBzaG90KCd1cGRhdGVkIHN0YXRlIHNob3dpbmcgcmVqZWN0ZWQgYXN5bmMgb3BlcmF0aW9uJyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZSgnV1JJVEUgYXN5bmMgb3BlcmF0aW9ucycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGl0KCdzaG91bGQgdXBkYXRlIHN0YXRlIHRvIHNob3cgd3JpdGUgYXN5bmMgb3BlcmF0aW9uIGFzIHBlbmRpbmcgc3RhdGUgZnJvbSBpbml0aWFsIHN0YXRlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAoMCwgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLnJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycykoe1xuICAgICAgICAgIGRlc2NyaXB0b3JJZDogJ1VQREFURV9QRVJTT05fREFUQScsXG4gICAgICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnXSxcbiAgICAgICAgICBvcGVyYXRpb25UeXBlOiAnV1JJVEUnXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdHJhbnNmb3JtZWRTdGF0ZSA9ICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMuZ2V0U3RhdGVGb3JPcGVyYXRpb25BZnRlclN0ZXApKHN0YXRlLCAnQkVHSU5fQVNZTkNfT1BFUkFUSU9OJywgJ1VQREFURV9QRVJTT05fREFUQScsIHtcbiAgICAgICAgICBwZXJzb25JZDogMTExXG4gICAgICAgIH0pO1xuICAgICAgICAoMCwgX2NoYWkuZXhwZWN0KSh0cmFuc2Zvcm1lZFN0YXRlKS50by5uZXN0ZWQuaW5jbHVkZSh7XG4gICAgICAgICAgJ1VQREFURV9QRVJTT05fREFUQV8xMTEuZmV0Y2hTdGF0dXMnOiAnUEVORElORydcbiAgICAgICAgfSk7XG4gICAgICAgICgwLCBfY2hhaS5leHBlY3QpKHRyYW5zZm9ybWVkU3RhdGUpLnRvLm1hdGNoU25hcHNob3QoJ3VwZGF0ZWQgc3RhdGUgc2hvd2luZyBwZW5kaW5nIHdyaXRlIGFzeW5jIG9wZXJhdGlvbicpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIHVwZGF0ZSBzdGF0ZSB0byBzaG93IHdyaXRlIGFzeW5jIG9wZXJhdGlvbiBhcyBzdWNjZXNzZnVsIHN0YXRlIGZyb20gcGVuZGluZyBzdGF0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3RhdGUgPSB7XG4gICAgICAgICAgVVBEQVRFX1BFUlNPTl9EQVRBXzExMToge1xuICAgICAgICAgICAgZGVzY3JpcHRvcklkOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgICAgICAgIGZldGNoU3RhdHVzOiAnUEVORElORycsXG4gICAgICAgICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgbGFzdEZldGNoU3RhdHVzVGltZTogMCxcbiAgICAgICAgICAgIGxhc3REYXRhU3RhdHVzVGltZTogMCxcbiAgICAgICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSh7XG4gICAgICAgICAgZGVzY3JpcHRvcklkOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgICAgICByZXF1aXJlZFBhcmFtczogWydwZXJzb25JZCddLFxuICAgICAgICAgIG9wZXJhdGlvblR5cGU6ICdXUklURSdcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciB0cmFuc2Zvcm1lZFN0YXRlID0gKDAsIF9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscy5nZXRTdGF0ZUZvck9wZXJhdGlvbkFmdGVyU3RlcCkoc3RhdGUsICdSRVNPTFZFX0FTWU5DX09QRVJBVElPTicsICdVUERBVEVfUEVSU09OX0RBVEEnLCB7XG4gICAgICAgICAgcGVyc29uSWQ6IDExMVxuICAgICAgICB9KTtcbiAgICAgICAgKDAsIF9jaGFpLmV4cGVjdCkodHJhbnNmb3JtZWRTdGF0ZSkudG8ubmVzdGVkLmluY2x1ZGUoe1xuICAgICAgICAgICdVUERBVEVfUEVSU09OX0RBVEFfMTExLmZldGNoU3RhdHVzJzogJ1NVQ0NFU1NGVUwnXG4gICAgICAgIH0pO1xuICAgICAgICAoMCwgX2NoYWkuZXhwZWN0KSh0cmFuc2Zvcm1lZFN0YXRlKS50by5tYXRjaFNuYXBzaG90KCd1cGRhdGVkIHN0YXRlIHNob3dpbmcgc3VjY2Vzc2Z1bCB3cml0ZSBhc3luYyBvcGVyYXRpb24nKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCB1cGRhdGUgc3RhdGUgdG8gc2hvdyB3cml0ZSBhc3luYyBvcGVyYXRpb24gYXMgZmFpbGVkIHN0YXRlIGZyb20gcGVuZGluZyBzdGF0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3RhdGUgPSB7XG4gICAgICAgICAgVVBEQVRFX1BFUlNPTl9EQVRBXzExMToge1xuICAgICAgICAgICAgZGVzY3JpcHRvcklkOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgICAgICAgIGZldGNoU3RhdHVzOiAnUEVORElORycsXG4gICAgICAgICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgbGFzdEZldGNoU3RhdHVzVGltZTogMCxcbiAgICAgICAgICAgIGxhc3REYXRhU3RhdHVzVGltZTogMCxcbiAgICAgICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSh7XG4gICAgICAgICAgZGVzY3JpcHRvcklkOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgICAgICByZXF1aXJlZFBhcmFtczogWydwZXJzb25JZCddLFxuICAgICAgICAgIG9wZXJhdGlvblR5cGU6ICdXUklURSdcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciB0cmFuc2Zvcm1lZFN0YXRlID0gKDAsIF9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscy5nZXRTdGF0ZUZvck9wZXJhdGlvbkFmdGVyU3RlcCkoc3RhdGUsICdSRUpFQ1RfQVNZTkNfT1BFUkFUSU9OJywgJ1VQREFURV9QRVJTT05fREFUQScsIHtcbiAgICAgICAgICBwZXJzb25JZDogMTExXG4gICAgICAgIH0pO1xuICAgICAgICAoMCwgX2NoYWkuZXhwZWN0KSh0cmFuc2Zvcm1lZFN0YXRlKS50by5uZXN0ZWQuaW5jbHVkZSh7XG4gICAgICAgICAgJ1VQREFURV9QRVJTT05fREFUQV8xMTEuZmV0Y2hTdGF0dXMnOiAnRkFJTEVEJ1xuICAgICAgICB9KTtcbiAgICAgICAgKDAsIF9jaGFpLmV4cGVjdCkodHJhbnNmb3JtZWRTdGF0ZSkudG8ubWF0Y2hTbmFwc2hvdCgndXBkYXRlZCBzdGF0ZSBzaG93aW5nIGZhaWxlZCB3cml0ZSBhc3luYyBvcGVyYXRpb24nKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdfQ==