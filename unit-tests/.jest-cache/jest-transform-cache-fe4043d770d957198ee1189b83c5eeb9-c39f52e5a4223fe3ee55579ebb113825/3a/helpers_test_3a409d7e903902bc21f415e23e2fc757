f2f58fc4dbb45f826444461b5cd039b7
"use strict";

var _chai = require("chai");

var _sinon = _interopRequireDefault(require("sinon"));

var _config = _interopRequireDefault(require("../config"));

var _helpers = require("../helpers");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/* eslint-env jest */
describe('helpers', () => {
  beforeEach(() => {
    _config.default.setConfig({
      logger: {
        exceptionsCallback: _sinon.default.spy()
      }
    });
  });
  describe('generateAsyncOperationKey', () => {
    it('should create an asyncOperation key with no params', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData');
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData');
    });
    it('should create an asyncOperation key with one param', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_111');
    });
    it('should create an asyncOperation key with multiple params', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        teamId: 222,
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_222_111');
    });
    it('should throw an exception if a label is not provided', () => {
      const _asyncOperationManage = _config.default.getConfig(),
            logger = _asyncOperationManage.logger;

      (0, _helpers.generateAsyncOperationKey)();
      (0, _helpers.generateAsyncOperationKey)('');
      (0, _helpers.generateAsyncOperationKey)(undefined);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
    it('should throw an exception if a label is not a string', () => {
      const _asyncOperationManage2 = _config.default.getConfig(),
            logger = _asyncOperationManage2.logger;

      (0, _helpers.generateAsyncOperationKey)({});
      (0, _helpers.generateAsyncOperationKey)([]);
      (0, _helpers.generateAsyncOperationKey)(2);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
  });
  describe('getAndValidateParams', () => {
    beforeEach(() => {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should validate and successfully return correct asyncOperation params', () => {
      const params = {
        personId: 2,
        teamId: 10,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      const asyncOperationParams = (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(asyncOperationParams).to.deep.equal({
        personId: 2,
        teamId: 10
      });
    });
    it('should validate and fail on an undefined param', () => {
      const _asyncOperationManage3 = _config.default.getConfig(),
            logger = _asyncOperationManage3.logger;

      const params = {
        personId: undefined,
        teamId: 10,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
    it('should validate and fail on a missing param', () => {
      const _asyncOperationManage4 = _config.default.getConfig(),
            logger = _asyncOperationManage4.logger;

      const params = {
        personId: 2,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
  });
  describe('makeConstantsObject', () => {
    beforeEach(() => {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should make a constants object out of an array of string values', () => {
      const fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(fruits).to.deep.equal({
        APPLE: 'APPLE',
        BANANA: 'BANANA'
      });
    });
    it('should make a constants object that is immutable', () => {
      const fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(Object.isExtensible(fruits)).to.be.true;
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlcnNfdGVzdC5qcyJdLCJuYW1lcyI6WyJfY2hhaSIsInJlcXVpcmUiLCJfc2lub24iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2NvbmZpZyIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJzZXRDb25maWciLCJsb2dnZXIiLCJleGNlcHRpb25zQ2FsbGJhY2siLCJzcHkiLCJpdCIsImFzeW5jT3BlcmF0aW9uS2V5IiwiZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSIsImV4cGVjdCIsInRvIiwiZXF1YWwiLCJwZXJzb25JZCIsInRlYW1JZCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZSIsImdldENvbmZpZyIsInVuZGVmaW5lZCIsImNhbGxlZCIsImNhbGxDb3VudCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTIiLCJwYXJhbXMiLCJuYW1lIiwiYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwicmVxdWlyZWRQYXJhbXMiLCJhc3luY09wZXJhdGlvblBhcmFtcyIsImdldEFuZFZhbGlkYXRlUGFyYW1zIiwiZGVlcCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTMiLCJfYXN5bmNPcGVyYXRpb25NYW5hZ2U0IiwiZnJ1aXRzIiwibWFrZUNvbnN0YW50c09iamVjdCIsIkFQUExFIiwiQkFOQU5BIiwiT2JqZWN0IiwiaXNFeHRlbnNpYmxlIiwiYmUiLCJ0cnVlIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFJQSxRQUFRQyxRQUFRLE1BQVIsQ0FBWjs7QUFFQSxJQUFJQyxTQUFTQyx1QkFBdUJGLFFBQVEsT0FBUixDQUF2QixDQUFiOztBQUVBLElBQUlHLFVBQVVELHVCQUF1QkYsUUFBUSxXQUFSLENBQXZCLENBQWQ7O0FBRUEsSUFBSUksV0FBV0osUUFBUSxZQUFSLENBQWY7O0FBRUEsU0FBU0Usc0JBQVQsQ0FBZ0NHLEdBQWhDLEVBQXFDO0FBQUUsU0FBT0EsT0FBT0EsSUFBSUMsVUFBWCxHQUF3QkQsR0FBeEIsR0FBOEIsRUFBRUUsU0FBU0YsR0FBWCxFQUFyQztBQUF3RDs7QUFFL0Y7QUFDQUcsU0FBUyxTQUFULEVBQW9CLE1BQU07QUFDeEJDLGFBQVcsTUFBTTtBQUNmTixZQUFRSSxPQUFSLENBQWdCRyxTQUFoQixDQUEwQjtBQUN4QkMsY0FBUTtBQUNOQyw0QkFBb0JYLE9BQU9NLE9BQVAsQ0FBZU0sR0FBZjtBQURkO0FBRGdCLEtBQTFCO0FBS0QsR0FORDtBQU9BTCxXQUFTLDJCQUFULEVBQXNDLE1BQU07QUFDMUNNLE9BQUcsb0RBQUgsRUFBeUQsTUFBTTtBQUM3RCxZQUFNQyxvQkFBb0IsQ0FBQyxHQUFHWCxTQUFTWSx5QkFBYixFQUF3QyxrQkFBeEMsQ0FBMUI7QUFDQSxPQUFDLEdBQUdqQixNQUFNa0IsTUFBVixFQUFrQkYsaUJBQWxCLEVBQXFDRyxFQUFyQyxDQUF3Q0MsS0FBeEMsQ0FBOEMsa0JBQTlDO0FBQ0QsS0FIRDtBQUlBTCxPQUFHLG9EQUFILEVBQXlELE1BQU07QUFDN0QsWUFBTUMsb0JBQW9CLENBQUMsR0FBR1gsU0FBU1kseUJBQWIsRUFBd0Msa0JBQXhDLEVBQTREO0FBQ3BGSSxrQkFBVTtBQUQwRSxPQUE1RCxDQUExQjtBQUdBLE9BQUMsR0FBR3JCLE1BQU1rQixNQUFWLEVBQWtCRixpQkFBbEIsRUFBcUNHLEVBQXJDLENBQXdDQyxLQUF4QyxDQUE4QyxzQkFBOUM7QUFDRCxLQUxEO0FBTUFMLE9BQUcsMERBQUgsRUFBK0QsTUFBTTtBQUNuRSxZQUFNQyxvQkFBb0IsQ0FBQyxHQUFHWCxTQUFTWSx5QkFBYixFQUF3QyxrQkFBeEMsRUFBNEQ7QUFDcEZLLGdCQUFRLEdBRDRFO0FBRXBGRCxrQkFBVTtBQUYwRSxPQUE1RCxDQUExQjtBQUlBLE9BQUMsR0FBR3JCLE1BQU1rQixNQUFWLEVBQWtCRixpQkFBbEIsRUFBcUNHLEVBQXJDLENBQXdDQyxLQUF4QyxDQUE4QywwQkFBOUM7QUFDRCxLQU5EO0FBT0FMLE9BQUcsc0RBQUgsRUFBMkQsTUFBTTtBQUMvRCxZQUFNUSx3QkFBd0JuQixRQUFRSSxPQUFSLENBQWdCZ0IsU0FBaEIsRUFBOUI7QUFBQSxZQUNNWixTQUFTVyxzQkFBc0JYLE1BRHJDOztBQUdBLE9BQUMsR0FBR1AsU0FBU1kseUJBQWI7QUFDQSxPQUFDLEdBQUdaLFNBQVNZLHlCQUFiLEVBQXdDLEVBQXhDO0FBQ0EsT0FBQyxHQUFHWixTQUFTWSx5QkFBYixFQUF3Q1EsU0FBeEM7QUFDQSxPQUFDLEdBQUd6QixNQUFNa0IsTUFBVixFQUFrQk4sT0FBT0Msa0JBQVAsQ0FBMEJhLE1BQTVDLEVBQW9EUCxFQUFwRCxDQUF1REMsS0FBdkQsQ0FBNkQsSUFBN0Q7QUFDQSxPQUFDLEdBQUdwQixNQUFNa0IsTUFBVixFQUFrQk4sT0FBT0Msa0JBQVAsQ0FBMEJjLFNBQTVDLEVBQXVEUixFQUF2RCxDQUEwREMsS0FBMUQsQ0FBZ0UsQ0FBaEU7QUFDRCxLQVREO0FBVUFMLE9BQUcsc0RBQUgsRUFBMkQsTUFBTTtBQUMvRCxZQUFNYSx5QkFBeUJ4QixRQUFRSSxPQUFSLENBQWdCZ0IsU0FBaEIsRUFBL0I7QUFBQSxZQUNNWixTQUFTZ0IsdUJBQXVCaEIsTUFEdEM7O0FBR0EsT0FBQyxHQUFHUCxTQUFTWSx5QkFBYixFQUF3QyxFQUF4QztBQUNBLE9BQUMsR0FBR1osU0FBU1kseUJBQWIsRUFBd0MsRUFBeEM7QUFDQSxPQUFDLEdBQUdaLFNBQVNZLHlCQUFiLEVBQXdDLENBQXhDO0FBQ0EsT0FBQyxHQUFHakIsTUFBTWtCLE1BQVYsRUFBa0JOLE9BQU9DLGtCQUFQLENBQTBCYSxNQUE1QyxFQUFvRFAsRUFBcEQsQ0FBdURDLEtBQXZELENBQTZELElBQTdEO0FBQ0EsT0FBQyxHQUFHcEIsTUFBTWtCLE1BQVYsRUFBa0JOLE9BQU9DLGtCQUFQLENBQTBCYyxTQUE1QyxFQUF1RFIsRUFBdkQsQ0FBMERDLEtBQTFELENBQWdFLENBQWhFO0FBQ0QsS0FURDtBQVVELEdBdENEO0FBdUNBWCxXQUFTLHNCQUFULEVBQWlDLE1BQU07QUFDckNDLGVBQVcsTUFBTTtBQUNmTixjQUFRSSxPQUFSLENBQWdCRyxTQUFoQixDQUEwQjtBQUN4QkMsZ0JBQVE7QUFDTkMsOEJBQW9CWCxPQUFPTSxPQUFQLENBQWVNLEdBQWY7QUFEZDtBQURnQixPQUExQjtBQUtELEtBTkQ7QUFPQUMsT0FBRyx1RUFBSCxFQUE0RSxNQUFNO0FBQ2hGLFlBQU1jLFNBQVM7QUFDYlIsa0JBQVUsQ0FERztBQUViQyxnQkFBUSxFQUZLO0FBR2JRLGNBQU07QUFITyxPQUFmO0FBS0EsWUFBTUMsMkJBQTJCO0FBQy9CQyx3QkFBZ0IsQ0FBQyxVQUFELEVBQWEsUUFBYjtBQURlLE9BQWpDO0FBR0EsWUFBTUMsdUJBQXVCLENBQUMsR0FBRzVCLFNBQVM2QixvQkFBYixFQUFtQ0wsTUFBbkMsRUFBMkNFLHdCQUEzQyxDQUE3QjtBQUNBLE9BQUMsR0FBRy9CLE1BQU1rQixNQUFWLEVBQWtCZSxvQkFBbEIsRUFBd0NkLEVBQXhDLENBQTJDZ0IsSUFBM0MsQ0FBZ0RmLEtBQWhELENBQXNEO0FBQ3BEQyxrQkFBVSxDQUQwQztBQUVwREMsZ0JBQVE7QUFGNEMsT0FBdEQ7QUFJRCxLQWREO0FBZUFQLE9BQUcsZ0RBQUgsRUFBcUQsTUFBTTtBQUN6RCxZQUFNcUIseUJBQXlCaEMsUUFBUUksT0FBUixDQUFnQmdCLFNBQWhCLEVBQS9CO0FBQUEsWUFDTVosU0FBU3dCLHVCQUF1QnhCLE1BRHRDOztBQUdBLFlBQU1pQixTQUFTO0FBQ2JSLGtCQUFVSSxTQURHO0FBRWJILGdCQUFRLEVBRks7QUFHYlEsY0FBTTtBQUhPLE9BQWY7QUFLQSxZQUFNQywyQkFBMkI7QUFDL0JDLHdCQUFnQixDQUFDLFVBQUQsRUFBYSxRQUFiO0FBRGUsT0FBakM7QUFHQSxPQUFDLEdBQUczQixTQUFTNkIsb0JBQWIsRUFBbUNMLE1BQW5DLEVBQTJDRSx3QkFBM0M7QUFDQSxPQUFDLEdBQUcvQixNQUFNa0IsTUFBVixFQUFrQk4sT0FBT0Msa0JBQVAsQ0FBMEJhLE1BQTVDLEVBQW9EUCxFQUFwRCxDQUF1REMsS0FBdkQsQ0FBNkQsSUFBN0Q7QUFDRCxLQWREO0FBZUFMLE9BQUcsNkNBQUgsRUFBa0QsTUFBTTtBQUN0RCxZQUFNc0IseUJBQXlCakMsUUFBUUksT0FBUixDQUFnQmdCLFNBQWhCLEVBQS9CO0FBQUEsWUFDTVosU0FBU3lCLHVCQUF1QnpCLE1BRHRDOztBQUdBLFlBQU1pQixTQUFTO0FBQ2JSLGtCQUFVLENBREc7QUFFYlMsY0FBTTtBQUZPLE9BQWY7QUFJQSxZQUFNQywyQkFBMkI7QUFDL0JDLHdCQUFnQixDQUFDLFVBQUQsRUFBYSxRQUFiO0FBRGUsT0FBakM7QUFHQSxPQUFDLEdBQUczQixTQUFTNkIsb0JBQWIsRUFBbUNMLE1BQW5DLEVBQTJDRSx3QkFBM0M7QUFDQSxPQUFDLEdBQUcvQixNQUFNa0IsTUFBVixFQUFrQk4sT0FBT0Msa0JBQVAsQ0FBMEJhLE1BQTVDLEVBQW9EUCxFQUFwRCxDQUF1REMsS0FBdkQsQ0FBNkQsSUFBN0Q7QUFDRCxLQWJEO0FBY0QsR0FwREQ7QUFxREFYLFdBQVMscUJBQVQsRUFBZ0MsTUFBTTtBQUNwQ0MsZUFBVyxNQUFNO0FBQ2ZOLGNBQVFJLE9BQVIsQ0FBZ0JHLFNBQWhCLENBQTBCO0FBQ3hCQyxnQkFBUTtBQUNOQyw4QkFBb0JYLE9BQU9NLE9BQVAsQ0FBZU0sR0FBZjtBQURkO0FBRGdCLE9BQTFCO0FBS0QsS0FORDtBQU9BQyxPQUFHLGlFQUFILEVBQXNFLE1BQU07QUFDMUUsWUFBTXVCLFNBQVMsQ0FBQyxHQUFHakMsU0FBU2tDLG1CQUFiLEVBQWtDLENBQUMsT0FBRCxFQUFVLFFBQVYsQ0FBbEMsQ0FBZjtBQUNBLE9BQUMsR0FBR3ZDLE1BQU1rQixNQUFWLEVBQWtCb0IsTUFBbEIsRUFBMEJuQixFQUExQixDQUE2QmdCLElBQTdCLENBQWtDZixLQUFsQyxDQUF3QztBQUN0Q29CLGVBQU8sT0FEK0I7QUFFdENDLGdCQUFRO0FBRjhCLE9BQXhDO0FBSUQsS0FORDtBQU9BMUIsT0FBRyxrREFBSCxFQUF1RCxNQUFNO0FBQzNELFlBQU11QixTQUFTLENBQUMsR0FBR2pDLFNBQVNrQyxtQkFBYixFQUFrQyxDQUFDLE9BQUQsRUFBVSxRQUFWLENBQWxDLENBQWY7QUFDQSxPQUFDLEdBQUd2QyxNQUFNa0IsTUFBVixFQUFrQndCLE9BQU9DLFlBQVAsQ0FBb0JMLE1BQXBCLENBQWxCLEVBQStDbkIsRUFBL0MsQ0FBa0R5QixFQUFsRCxDQUFxREMsSUFBckQ7QUFDRCxLQUhEO0FBSUQsR0FuQkQ7QUFvQkQsQ0F4SEQiLCJmaWxlIjoiaGVscGVyc190ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfY2hhaSA9IHJlcXVpcmUoXCJjaGFpXCIpO1xuXG52YXIgX3Npbm9uID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwic2lub25cIikpO1xuXG52YXIgX2NvbmZpZyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5cbnZhciBfaGVscGVycyA9IHJlcXVpcmUoXCIuLi9oZWxwZXJzXCIpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG4vKiBlc2xpbnQtZW52IGplc3QgKi9cbmRlc2NyaWJlKCdoZWxwZXJzJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBfY29uZmlnLmRlZmF1bHQuc2V0Q29uZmlnKHtcbiAgICAgIGxvZ2dlcjoge1xuICAgICAgICBleGNlcHRpb25zQ2FsbGJhY2s6IF9zaW5vbi5kZWZhdWx0LnNweSgpXG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbiBhc3luY09wZXJhdGlvbiBrZXkgd2l0aCBubyBwYXJhbXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvbktleSA9ICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgndXBkYXRlUGVyc29uRGF0YScpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoYXN5bmNPcGVyYXRpb25LZXkpLnRvLmVxdWFsKCd1cGRhdGVQZXJzb25EYXRhJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW4gYXN5bmNPcGVyYXRpb24ga2V5IHdpdGggb25lIHBhcmFtJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25LZXkgPSAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoJ3VwZGF0ZVBlcnNvbkRhdGEnLCB7XG4gICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgIH0pO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoYXN5bmNPcGVyYXRpb25LZXkpLnRvLmVxdWFsKCd1cGRhdGVQZXJzb25EYXRhXzExMScpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGFuIGFzeW5jT3BlcmF0aW9uIGtleSB3aXRoIG11bHRpcGxlIHBhcmFtcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uS2V5ID0gKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCd1cGRhdGVQZXJzb25EYXRhJywge1xuICAgICAgICB0ZWFtSWQ6IDIyMixcbiAgICAgICAgcGVyc29uSWQ6IDExMVxuICAgICAgfSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShhc3luY09wZXJhdGlvbktleSkudG8uZXF1YWwoJ3VwZGF0ZVBlcnNvbkRhdGFfMjIyXzExMScpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGEgbGFiZWwgaXMgbm90IHByb3ZpZGVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgX2FzeW5jT3BlcmF0aW9uTWFuYWdlID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpLFxuICAgICAgICAgICAgbG9nZ2VyID0gX2FzeW5jT3BlcmF0aW9uTWFuYWdlLmxvZ2dlcjtcblxuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCk7XG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoJycpO1xuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKHVuZGVmaW5lZCk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxDb3VudCkudG8uZXF1YWwoMyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBleGNlcHRpb24gaWYgYSBsYWJlbCBpcyBub3QgYSBzdHJpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBfYXN5bmNPcGVyYXRpb25NYW5hZ2UyID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpLFxuICAgICAgICAgICAgbG9nZ2VyID0gX2FzeW5jT3BlcmF0aW9uTWFuYWdlMi5sb2dnZXI7XG5cbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSh7fSk7XG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoW10pO1xuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKDIpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsQ291bnQpLnRvLmVxdWFsKDMpO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2dldEFuZFZhbGlkYXRlUGFyYW1zJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgX2NvbmZpZy5kZWZhdWx0LnNldENvbmZpZyh7XG4gICAgICAgIGxvZ2dlcjoge1xuICAgICAgICAgIGV4Y2VwdGlvbnNDYWxsYmFjazogX3Npbm9uLmRlZmF1bHQuc3B5KClcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhbmQgc3VjY2Vzc2Z1bGx5IHJldHVybiBjb3JyZWN0IGFzeW5jT3BlcmF0aW9uIHBhcmFtcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgcGVyc29uSWQ6IDIsXG4gICAgICAgIHRlYW1JZDogMTAsXG4gICAgICAgIG5hbWU6ICdEYXJpZW4nXG4gICAgICB9O1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yID0ge1xuICAgICAgICByZXF1aXJlZFBhcmFtczogWydwZXJzb25JZCcsICd0ZWFtSWQnXVxuICAgICAgfTtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uUGFyYW1zID0gKDAsIF9oZWxwZXJzLmdldEFuZFZhbGlkYXRlUGFyYW1zKShwYXJhbXMsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcik7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShhc3luY09wZXJhdGlvblBhcmFtcykudG8uZGVlcC5lcXVhbCh7XG4gICAgICAgIHBlcnNvbklkOiAyLFxuICAgICAgICB0ZWFtSWQ6IDEwXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFuZCBmYWlsIG9uIGFuIHVuZGVmaW5lZCBwYXJhbScsICgpID0+IHtcbiAgICAgIGNvbnN0IF9hc3luY09wZXJhdGlvbk1hbmFnZTMgPSBfY29uZmlnLmRlZmF1bHQuZ2V0Q29uZmlnKCksXG4gICAgICAgICAgICBsb2dnZXIgPSBfYXN5bmNPcGVyYXRpb25NYW5hZ2UzLmxvZ2dlcjtcblxuICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICBwZXJzb25JZDogdW5kZWZpbmVkLFxuICAgICAgICB0ZWFtSWQ6IDEwLFxuICAgICAgICBuYW1lOiAnRGFyaWVuJ1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IHtcbiAgICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnLCAndGVhbUlkJ11cbiAgICAgIH07XG4gICAgICAoMCwgX2hlbHBlcnMuZ2V0QW5kVmFsaWRhdGVQYXJhbXMpKHBhcmFtcywgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGxvZ2dlci5leGNlcHRpb25zQ2FsbGJhY2suY2FsbGVkKS50by5lcXVhbCh0cnVlKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFuZCBmYWlsIG9uIGEgbWlzc2luZyBwYXJhbScsICgpID0+IHtcbiAgICAgIGNvbnN0IF9hc3luY09wZXJhdGlvbk1hbmFnZTQgPSBfY29uZmlnLmRlZmF1bHQuZ2V0Q29uZmlnKCksXG4gICAgICAgICAgICBsb2dnZXIgPSBfYXN5bmNPcGVyYXRpb25NYW5hZ2U0LmxvZ2dlcjtcblxuICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICBwZXJzb25JZDogMixcbiAgICAgICAgbmFtZTogJ0RhcmllbidcbiAgICAgIH07XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSB7XG4gICAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJywgJ3RlYW1JZCddXG4gICAgICB9O1xuICAgICAgKDAsIF9oZWxwZXJzLmdldEFuZFZhbGlkYXRlUGFyYW1zKShwYXJhbXMsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcik7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnbWFrZUNvbnN0YW50c09iamVjdCcsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIF9jb25maWcuZGVmYXVsdC5zZXRDb25maWcoe1xuICAgICAgICBsb2dnZXI6IHtcbiAgICAgICAgICBleGNlcHRpb25zQ2FsbGJhY2s6IF9zaW5vbi5kZWZhdWx0LnNweSgpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbWFrZSBhIGNvbnN0YW50cyBvYmplY3Qgb3V0IG9mIGFuIGFycmF5IG9mIHN0cmluZyB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmcnVpdHMgPSAoMCwgX2hlbHBlcnMubWFrZUNvbnN0YW50c09iamVjdCkoWydBUFBMRScsICdCQU5BTkEnXSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShmcnVpdHMpLnRvLmRlZXAuZXF1YWwoe1xuICAgICAgICBBUFBMRTogJ0FQUExFJyxcbiAgICAgICAgQkFOQU5BOiAnQkFOQU5BJ1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBtYWtlIGEgY29uc3RhbnRzIG9iamVjdCB0aGF0IGlzIGltbXV0YWJsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGZydWl0cyA9ICgwLCBfaGVscGVycy5tYWtlQ29uc3RhbnRzT2JqZWN0KShbJ0FQUExFJywgJ0JBTkFOQSddKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKE9iamVjdC5pc0V4dGVuc2libGUoZnJ1aXRzKSkudG8uYmUudHJ1ZTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXX0=