2f1bcf71123d13a0cf7a38f512ea9e61
"use strict";

var _chai = require("chai");

var _asyncOperationReducer = _interopRequireDefault(require("../asyncOperationReducer"));

var _asyncOperationManagerUtils = require("../../asyncOperationManagerUtils");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
/* eslint-env jest */


describe('asyncOperationReducer', function () {
  var state;
  beforeEach(function () {
    state = {};
    (0, _asyncOperationManagerUtils.clearRegisteredAsyncDescriptors)();
    var dateNowStub = jest.fn(function () {
      return 1530518207007;
    });
    global.Date.now = dateNowStub;
  });
  it('should return the initial state', function () {
    (0, _chai.expect)((0, _asyncOperationReducer.default)(undefined, {})).to.deep.equal(state);
  });
  it('should handle BEGIN_ASYNC_OPERATION for write action', function () {
    var action = {
      descriptorId: 'UPDATE_PERSON_DATA',
      operationStep: 'BEGIN_ASYNC_OPERATION',
      type: 'AOM//BEGIN__UPDATE_PERSON_DATA',
      actionType: 'UPDATE_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'UPDATE_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'WRITE'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('UPDATE_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for begun write async operation');
  });
  it('should handle RESOLVE_ASYNC_OPERATION for write action', function () {
    var action = {
      descriptorId: 'UPDATE_PERSON_DATA',
      operationStep: 'RESOLVE_ASYNC_OPERATION',
      type: 'AOM//RESOLVE__UPDATE_PERSON_DATA',
      actionType: 'UPDATE_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'UPDATE_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'WRITE'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('UPDATE_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for resolved write async operation');
  });
  it('should handle REJECT_ASYNC_OPERATION for write action', function () {
    var action = {
      descriptorId: 'UPDATE_PERSON_DATA',
      operationStep: 'REJECT_ASYNC_OPERATION',
      type: 'AOM//REJECT__UPDATE_PERSON_DATA',
      actionType: 'UPDATE_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'UPDATE_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'WRITE'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('UPDATE_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for rejected read async operation');
  });
  it('should handle BEGIN_ASYNC_OPERATION for read action', function () {
    var action = {
      descriptorId: 'FETCH_PERSON_DATA',
      operationStep: 'BEGIN_ASYNC_OPERATION',
      type: 'AOM//BEGIN__FETCH_PERSON_DATA',
      actionType: 'FETCH_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'FETCH_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'READ'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('FETCH_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for begun read async operation');
  });
  it('should handle RESOLVE_ASYNC_OPERATION for read action', function () {
    var action = {
      descriptorId: 'FETCH_PERSON_DATA',
      operationStep: 'RESOLVE_ASYNC_OPERATION',
      type: 'AOM//RESOLVE__FETCH_PERSON_DATA',
      actionType: 'FETCH_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'FETCH_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'READ'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('FETCH_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for resolved read async operation');
  });
  it('should handle REJECT_ASYNC_OPERATION for write action', function () {
    var action = {
      descriptorId: 'FETCH_PERSON_DATA',
      operationStep: 'REJECT_ASYNC_OPERATION',
      type: 'AOM//REJECT__FETCH_PERSON_DATA',
      actionType: 'FETCH_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'FETCH_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'WRITE'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('FETCH_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for rejected write async operation');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jT3BlcmF0aW9uUmVkdWNlcl90ZXN0cy5qcyJdLCJuYW1lcyI6WyJfY2hhaSIsInJlcXVpcmUiLCJfYXN5bmNPcGVyYXRpb25SZWR1Y2VyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscyIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiZGVzY3JpYmUiLCJzdGF0ZSIsImJlZm9yZUVhY2giLCJjbGVhclJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzIiwiZGF0ZU5vd1N0dWIiLCJqZXN0IiwiZm4iLCJnbG9iYWwiLCJEYXRlIiwibm93IiwiaXQiLCJleHBlY3QiLCJ1bmRlZmluZWQiLCJ0byIsImRlZXAiLCJlcXVhbCIsImFjdGlvbiIsImRlc2NyaXB0b3JJZCIsIm9wZXJhdGlvblN0ZXAiLCJ0eXBlIiwiYWN0aW9uVHlwZSIsInBlcnNvbklkIiwicmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzIiwicmVxdWlyZWRQYXJhbXMiLCJvcGVyYXRpb25UeXBlIiwiaGF2ZSIsImFsbCIsImtleXMiLCJtYXRjaFNuYXBzaG90Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFJQSxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQW5COztBQUVBLElBQUlDLHNCQUFzQixHQUFHQyxzQkFBc0IsQ0FBQ0YsT0FBTyxDQUFDLDBCQUFELENBQVIsQ0FBbkQ7O0FBRUEsSUFBSUcsMkJBQTJCLEdBQUdILE9BQU8sQ0FBQyxrQ0FBRCxDQUF6Qzs7QUFFQSxTQUFTRSxzQkFBVCxDQUFnQ0UsR0FBaEMsRUFBcUM7QUFBRSxTQUFPQSxHQUFHLElBQUlBLEdBQUcsQ0FBQ0MsVUFBWCxHQUF3QkQsR0FBeEIsR0FBOEI7QUFBRUUsSUFBQUEsT0FBTyxFQUFFRjtBQUFYLEdBQXJDO0FBQXdEO0FBRS9GOzs7QUFDQUcsUUFBUSxDQUFDLHVCQUFELEVBQTBCLFlBQVk7QUFDNUMsTUFBSUMsS0FBSjtBQUNB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c0RBQXZGO0FBQ0QsR0FmQyxDQUFGO0FBZ0JELENBN0dPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxudmFyIF9jaGFpID0gcmVxdWlyZShcImNoYWlcIik7XG5cbnZhciBfYXN5bmNPcGVyYXRpb25SZWR1Y2VyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vYXN5bmNPcGVyYXRpb25SZWR1Y2VyXCIpKTtcblxudmFyIF9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscyA9IHJlcXVpcmUoXCIuLi8uLi9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlsc1wiKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuLyogZXNsaW50LWVudiBqZXN0ICovXG5kZXNjcmliZSgnYXN5bmNPcGVyYXRpb25SZWR1Y2VyJywgZnVuY3Rpb24gKCkge1xuICB2YXIgc3RhdGU7XG4gIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgIHN0YXRlID0ge307XG4gICAgKDAsIF9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscy5jbGVhclJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzKSgpO1xuICAgIHZhciBkYXRlTm93U3R1YiA9IGplc3QuZm4oZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIDE1MzA1MTgyMDcwMDc7XG4gICAgfSk7XG4gICAgZ2xvYmFsLkRhdGUubm93ID0gZGF0ZU5vd1N0dWI7XG4gIH0pO1xuICBpdCgnc2hvdWxkIHJldHVybiB0aGUgaW5pdGlhbCBzdGF0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KSh1bmRlZmluZWQsIHt9KSkudG8uZGVlcC5lcXVhbChzdGF0ZSk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGhhbmRsZSBCRUdJTl9BU1lOQ19PUEVSQVRJT04gZm9yIHdyaXRlIGFjdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYWN0aW9uID0ge1xuICAgICAgZGVzY3JpcHRvcklkOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgIG9wZXJhdGlvblN0ZXA6ICdCRUdJTl9BU1lOQ19PUEVSQVRJT04nLFxuICAgICAgdHlwZTogJ0FPTS8vQkVHSU5fX1VQREFURV9QRVJTT05fREFUQScsXG4gICAgICBhY3Rpb25UeXBlOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgIHBlcnNvbklkOiAxMTFcbiAgICB9O1xuICAgICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSh7XG4gICAgICBkZXNjcmlwdG9ySWQ6ICdVUERBVEVfUEVSU09OX0RBVEEnLFxuICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnXSxcbiAgICAgIG9wZXJhdGlvblR5cGU6ICdXUklURSdcbiAgICB9KTtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KShzdGF0ZSwgYWN0aW9uKSkudG8uaGF2ZS5hbGwua2V5cygnVVBEQVRFX1BFUlNPTl9EQVRBXzExMScpO1xuICAgICgwLCBfY2hhaS5leHBlY3QpKCgwLCBfYXN5bmNPcGVyYXRpb25SZWR1Y2VyLmRlZmF1bHQpKHN0YXRlLCBhY3Rpb24pKS50by5tYXRjaFNuYXBzaG90KCd3ZWxsIGZvcm1lZCBzdGF0ZSBmb3IgYmVndW4gd3JpdGUgYXN5bmMgb3BlcmF0aW9uJyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGhhbmRsZSBSRVNPTFZFX0FTWU5DX09QRVJBVElPTiBmb3Igd3JpdGUgYWN0aW9uJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciBhY3Rpb24gPSB7XG4gICAgICBkZXNjcmlwdG9ySWQ6ICdVUERBVEVfUEVSU09OX0RBVEEnLFxuICAgICAgb3BlcmF0aW9uU3RlcDogJ1JFU09MVkVfQVNZTkNfT1BFUkFUSU9OJyxcbiAgICAgIHR5cGU6ICdBT00vL1JFU09MVkVfX1VQREFURV9QRVJTT05fREFUQScsXG4gICAgICBhY3Rpb25UeXBlOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgIHBlcnNvbklkOiAxMTFcbiAgICB9O1xuICAgICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSh7XG4gICAgICBkZXNjcmlwdG9ySWQ6ICdVUERBVEVfUEVSU09OX0RBVEEnLFxuICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnXSxcbiAgICAgIG9wZXJhdGlvblR5cGU6ICdXUklURSdcbiAgICB9KTtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KShzdGF0ZSwgYWN0aW9uKSkudG8uaGF2ZS5hbGwua2V5cygnVVBEQVRFX1BFUlNPTl9EQVRBXzExMScpO1xuICAgICgwLCBfY2hhaS5leHBlY3QpKCgwLCBfYXN5bmNPcGVyYXRpb25SZWR1Y2VyLmRlZmF1bHQpKHN0YXRlLCBhY3Rpb24pKS50by5tYXRjaFNuYXBzaG90KCd3ZWxsIGZvcm1lZCBzdGF0ZSBmb3IgcmVzb2x2ZWQgd3JpdGUgYXN5bmMgb3BlcmF0aW9uJyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGhhbmRsZSBSRUpFQ1RfQVNZTkNfT1BFUkFUSU9OIGZvciB3cml0ZSBhY3Rpb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGFjdGlvbiA9IHtcbiAgICAgIGRlc2NyaXB0b3JJZDogJ1VQREFURV9QRVJTT05fREFUQScsXG4gICAgICBvcGVyYXRpb25TdGVwOiAnUkVKRUNUX0FTWU5DX09QRVJBVElPTicsXG4gICAgICB0eXBlOiAnQU9NLy9SRUpFQ1RfX1VQREFURV9QRVJTT05fREFUQScsXG4gICAgICBhY3Rpb25UeXBlOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgIHBlcnNvbklkOiAxMTFcbiAgICB9O1xuICAgICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSh7XG4gICAgICBkZXNjcmlwdG9ySWQ6ICdVUERBVEVfUEVSU09OX0RBVEEnLFxuICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnXSxcbiAgICAgIG9wZXJhdGlvblR5cGU6ICdXUklURSdcbiAgICB9KTtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KShzdGF0ZSwgYWN0aW9uKSkudG8uaGF2ZS5hbGwua2V5cygnVVBEQVRFX1BFUlNPTl9EQVRBXzExMScpO1xuICAgICgwLCBfY2hhaS5leHBlY3QpKCgwLCBfYXN5bmNPcGVyYXRpb25SZWR1Y2VyLmRlZmF1bHQpKHN0YXRlLCBhY3Rpb24pKS50by5tYXRjaFNuYXBzaG90KCd3ZWxsIGZvcm1lZCBzdGF0ZSBmb3IgcmVqZWN0ZWQgcmVhZCBhc3luYyBvcGVyYXRpb24nKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgaGFuZGxlIEJFR0lOX0FTWU5DX09QRVJBVElPTiBmb3IgcmVhZCBhY3Rpb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGFjdGlvbiA9IHtcbiAgICAgIGRlc2NyaXB0b3JJZDogJ0ZFVENIX1BFUlNPTl9EQVRBJyxcbiAgICAgIG9wZXJhdGlvblN0ZXA6ICdCRUdJTl9BU1lOQ19PUEVSQVRJT04nLFxuICAgICAgdHlwZTogJ0FPTS8vQkVHSU5fX0ZFVENIX1BFUlNPTl9EQVRBJyxcbiAgICAgIGFjdGlvblR5cGU6ICdGRVRDSF9QRVJTT05fREFUQScsXG4gICAgICBwZXJzb25JZDogMTExXG4gICAgfTtcbiAgICAoMCwgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLnJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycykoe1xuICAgICAgZGVzY3JpcHRvcklkOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnXSxcbiAgICAgIG9wZXJhdGlvblR5cGU6ICdSRUFEJ1xuICAgIH0pO1xuICAgICgwLCBfY2hhaS5leHBlY3QpKCgwLCBfYXN5bmNPcGVyYXRpb25SZWR1Y2VyLmRlZmF1bHQpKHN0YXRlLCBhY3Rpb24pKS50by5oYXZlLmFsbC5rZXlzKCdGRVRDSF9QRVJTT05fREFUQV8xMTEnKTtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KShzdGF0ZSwgYWN0aW9uKSkudG8ubWF0Y2hTbmFwc2hvdCgnd2VsbCBmb3JtZWQgc3RhdGUgZm9yIGJlZ3VuIHJlYWQgYXN5bmMgb3BlcmF0aW9uJyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGhhbmRsZSBSRVNPTFZFX0FTWU5DX09QRVJBVElPTiBmb3IgcmVhZCBhY3Rpb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGFjdGlvbiA9IHtcbiAgICAgIGRlc2NyaXB0b3JJZDogJ0ZFVENIX1BFUlNPTl9EQVRBJyxcbiAgICAgIG9wZXJhdGlvblN0ZXA6ICdSRVNPTFZFX0FTWU5DX09QRVJBVElPTicsXG4gICAgICB0eXBlOiAnQU9NLy9SRVNPTFZFX19GRVRDSF9QRVJTT05fREFUQScsXG4gICAgICBhY3Rpb25UeXBlOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgcGVyc29uSWQ6IDExMVxuICAgIH07XG4gICAgKDAsIF9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscy5yZWdpc3RlckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMpKHtcbiAgICAgIGRlc2NyaXB0b3JJZDogJ0ZFVENIX1BFUlNPTl9EQVRBJyxcbiAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJ10sXG4gICAgICBvcGVyYXRpb25UeXBlOiAnUkVBRCdcbiAgICB9KTtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KShzdGF0ZSwgYWN0aW9uKSkudG8uaGF2ZS5hbGwua2V5cygnRkVUQ0hfUEVSU09OX0RBVEFfMTExJyk7XG4gICAgKDAsIF9jaGFpLmV4cGVjdCkoKDAsIF9hc3luY09wZXJhdGlvblJlZHVjZXIuZGVmYXVsdCkoc3RhdGUsIGFjdGlvbikpLnRvLm1hdGNoU25hcHNob3QoJ3dlbGwgZm9ybWVkIHN0YXRlIGZvciByZXNvbHZlZCByZWFkIGFzeW5jIG9wZXJhdGlvbicpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBoYW5kbGUgUkVKRUNUX0FTWU5DX09QRVJBVElPTiBmb3Igd3JpdGUgYWN0aW9uJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciBhY3Rpb24gPSB7XG4gICAgICBkZXNjcmlwdG9ySWQ6ICdGRVRDSF9QRVJTT05fREFUQScsXG4gICAgICBvcGVyYXRpb25TdGVwOiAnUkVKRUNUX0FTWU5DX09QRVJBVElPTicsXG4gICAgICB0eXBlOiAnQU9NLy9SRUpFQ1RfX0ZFVENIX1BFUlNPTl9EQVRBJyxcbiAgICAgIGFjdGlvblR5cGU6ICdGRVRDSF9QRVJTT05fREFUQScsXG4gICAgICBwZXJzb25JZDogMTExXG4gICAgfTtcbiAgICAoMCwgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLnJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycykoe1xuICAgICAgZGVzY3JpcHRvcklkOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnXSxcbiAgICAgIG9wZXJhdGlvblR5cGU6ICdXUklURSdcbiAgICB9KTtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KShzdGF0ZSwgYWN0aW9uKSkudG8uaGF2ZS5hbGwua2V5cygnRkVUQ0hfUEVSU09OX0RBVEFfMTExJyk7XG4gICAgKDAsIF9jaGFpLmV4cGVjdCkoKDAsIF9hc3luY09wZXJhdGlvblJlZHVjZXIuZGVmYXVsdCkoc3RhdGUsIGFjdGlvbikpLnRvLm1hdGNoU25hcHNob3QoJ3dlbGwgZm9ybWVkIHN0YXRlIGZvciByZWplY3RlZCB3cml0ZSBhc3luYyBvcGVyYXRpb24nKTtcbiAgfSk7XG59KTsiXX0=