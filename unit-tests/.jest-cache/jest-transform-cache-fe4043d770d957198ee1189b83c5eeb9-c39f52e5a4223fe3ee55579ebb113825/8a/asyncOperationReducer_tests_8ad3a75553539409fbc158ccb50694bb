b1058f54b2adda1a169c7c0c6bccaaf0
"use strict";

require("core-js/modules/web.dom.iterable");

var _chai = require("chai");

var _asyncOperationReducer = _interopRequireDefault(require("../asyncOperationReducer"));

var _asyncOperationManagerUtils = require("../../asyncOperationManagerUtils");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/* eslint-env jest */
describe('asyncOperationReducer', () => {
  let state;
  beforeEach(() => {
    state = {};
    (0, _asyncOperationManagerUtils.clearRegisteredAsyncDescriptors)();
    const dateNowStub = jest.fn(() => 1530518207007);
    global.Date.now = dateNowStub;
  });
  it('should return the initial state', () => {
    (0, _chai.expect)((0, _asyncOperationReducer.default)(undefined, {})).to.deep.equal(state);
  });
  it('should handle BEGIN_ASYNC_OPERATION for write action', () => {
    const action = {
      descriptorId: 'UPDATE_PERSON_DATA',
      operationStep: 'BEGIN_ASYNC_OPERATION',
      type: 'AOM//BEGIN__UPDATE_PERSON_DATA',
      actionType: 'UPDATE_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'UPDATE_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'WRITE'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('UPDATE_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for begun write async operation');
  });
  it('should handle RESOLVE_ASYNC_OPERATION for write action', () => {
    const action = {
      descriptorId: 'UPDATE_PERSON_DATA',
      operationStep: 'RESOLVE_ASYNC_OPERATION',
      type: 'AOM//RESOLVE__UPDATE_PERSON_DATA',
      actionType: 'UPDATE_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'UPDATE_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'WRITE'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('UPDATE_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for resolved write async operation');
  });
  it('should handle REJECT_ASYNC_OPERATION for write action', () => {
    const action = {
      descriptorId: 'UPDATE_PERSON_DATA',
      operationStep: 'REJECT_ASYNC_OPERATION',
      type: 'AOM//REJECT__UPDATE_PERSON_DATA',
      actionType: 'UPDATE_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'UPDATE_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'WRITE'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('UPDATE_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for rejected read async operation');
  });
  it('should handle BEGIN_ASYNC_OPERATION for read action', () => {
    const action = {
      descriptorId: 'FETCH_PERSON_DATA',
      operationStep: 'BEGIN_ASYNC_OPERATION',
      type: 'AOM//BEGIN__FETCH_PERSON_DATA',
      actionType: 'FETCH_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'FETCH_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'READ'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('FETCH_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for begun read async operation');
  });
  it('should handle RESOLVE_ASYNC_OPERATION for read action', () => {
    const action = {
      descriptorId: 'FETCH_PERSON_DATA',
      operationStep: 'RESOLVE_ASYNC_OPERATION',
      type: 'AOM//RESOLVE__FETCH_PERSON_DATA',
      actionType: 'FETCH_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'FETCH_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'READ'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('FETCH_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for resolved read async operation');
  });
  it('should handle REJECT_ASYNC_OPERATION for write action', () => {
    const action = {
      descriptorId: 'FETCH_PERSON_DATA',
      operationStep: 'REJECT_ASYNC_OPERATION',
      type: 'AOM//REJECT__FETCH_PERSON_DATA',
      actionType: 'FETCH_PERSON_DATA',
      personId: 111
    };
    (0, _asyncOperationManagerUtils.registerAsyncOperationDescriptors)({
      descriptorId: 'FETCH_PERSON_DATA',
      requiredParams: ['personId'],
      operationType: 'WRITE'
    });
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.have.all.keys('FETCH_PERSON_DATA_111');
    (0, _chai.expect)((0, _asyncOperationReducer.default)(state, action)).to.matchSnapshot('well formed state for rejected write async operation');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jT3BlcmF0aW9uUmVkdWNlcl90ZXN0cy5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiX2NoYWkiLCJfYXN5bmNPcGVyYXRpb25SZWR1Y2VyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscyIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiZGVzY3JpYmUiLCJzdGF0ZSIsImJlZm9yZUVhY2giLCJjbGVhclJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzIiwiZGF0ZU5vd1N0dWIiLCJqZXN0IiwiZm4iLCJnbG9iYWwiLCJEYXRlIiwibm93IiwiaXQiLCJleHBlY3QiLCJ1bmRlZmluZWQiLCJ0byIsImRlZXAiLCJlcXVhbCIsImFjdGlvbiIsImRlc2NyaXB0b3JJZCIsIm9wZXJhdGlvblN0ZXAiLCJ0eXBlIiwiYWN0aW9uVHlwZSIsInBlcnNvbklkIiwicmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzIiwicmVxdWlyZWRQYXJhbXMiLCJvcGVyYXRpb25UeXBlIiwiaGF2ZSIsImFsbCIsImtleXMiLCJtYXRjaFNuYXBzaG90Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsUUFBUSxrQ0FBUjs7QUFFQSxJQUFJQyxRQUFRRCxRQUFRLE1BQVIsQ0FBWjs7QUFFQSxJQUFJRSx5QkFBeUJDLHVCQUF1QkgsUUFBUSwwQkFBUixDQUF2QixDQUE3Qjs7QUFFQSxJQUFJSSw4QkFBOEJKLFFBQVEsa0NBQVIsQ0FBbEM7O0FBRUEsU0FBU0csc0JBQVQsQ0FBZ0NFLEdBQWhDLEVBQXFDO0FBQUUsU0FBT0EsT0FBT0EsSUFBSUMsVUFBWCxHQUF3QkQsR0FBeEIsR0FBOEIsRUFBRUUsU0FBU0YsR0FBWCxFQUFyQztBQUF3RDs7QUFFL0Y7QUFDQUcsU0FBUyx1QkFBVCxFQUFrQyxNQUFNO0FBQ3RDLE1BQUlDLEtBQUo7QUFDQUMsYUFBVyxNQUFNO0FBQ2ZELFlBQVEsRUFBUjtBQUNBLEtBQUMsR0FBR0ws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dUYsc0RBQXZGO0FBQ0QsR0FmRDtBQWdCRCxDQTNHRCIsImZpbGUiOiJhc3luY09wZXJhdGlvblJlZHVjZXJfdGVzdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxucmVxdWlyZShcImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlXCIpO1xuXG52YXIgX2NoYWkgPSByZXF1aXJlKFwiY2hhaVwiKTtcblxudmFyIF9hc3luY09wZXJhdGlvblJlZHVjZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9hc3luY09wZXJhdGlvblJlZHVjZXJcIikpO1xuXG52YXIgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzID0gcmVxdWlyZShcIi4uLy4uL2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzXCIpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG4vKiBlc2xpbnQtZW52IGplc3QgKi9cbmRlc2NyaWJlKCdhc3luY09wZXJhdGlvblJlZHVjZXInLCAoKSA9PiB7XG4gIGxldCBzdGF0ZTtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgc3RhdGUgPSB7fTtcbiAgICAoMCwgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLmNsZWFyUmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMpKCk7XG4gICAgY29uc3QgZGF0ZU5vd1N0dWIgPSBqZXN0LmZuKCgpID0+IDE1MzA1MTgyMDcwMDcpO1xuICAgIGdsb2JhbC5EYXRlLm5vdyA9IGRhdGVOb3dTdHViO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUnLCAoKSA9PiB7XG4gICAgKDAsIF9jaGFpLmV4cGVjdCkoKDAsIF9hc3luY09wZXJhdGlvblJlZHVjZXIuZGVmYXVsdCkodW5kZWZpbmVkLCB7fSkpLnRvLmRlZXAuZXF1YWwoc3RhdGUpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBoYW5kbGUgQkVHSU5fQVNZTkNfT1BFUkFUSU9OIGZvciB3cml0ZSBhY3Rpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgYWN0aW9uID0ge1xuICAgICAgZGVzY3JpcHRvcklkOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgIG9wZXJhdGlvblN0ZXA6ICdCRUdJTl9BU1lOQ19PUEVSQVRJT04nLFxuICAgICAgdHlwZTogJ0FPTS8vQkVHSU5fX1VQREFURV9QRVJTT05fREFUQScsXG4gICAgICBhY3Rpb25UeXBlOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgIHBlcnNvbklkOiAxMTFcbiAgICB9O1xuICAgICgwLCBfYXN5bmNPcGVyYXRpb25NYW5hZ2VyVXRpbHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSh7XG4gICAgICBkZXNjcmlwdG9ySWQ6ICdVUERBVEVfUEVSU09OX0RBVEEnLFxuICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnXSxcbiAgICAgIG9wZXJhdGlvblR5cGU6ICdXUklURSdcbiAgICB9KTtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KShzdGF0ZSwgYWN0aW9uKSkudG8uaGF2ZS5hbGwua2V5cygnVVBEQVRFX1BFUlNPTl9EQVRBXzExMScpO1xuICAgICgwLCBfY2hhaS5leHBlY3QpKCgwLCBfYXN5bmNPcGVyYXRpb25SZWR1Y2VyLmRlZmF1bHQpKHN0YXRlLCBhY3Rpb24pKS50by5tYXRjaFNuYXBzaG90KCd3ZWxsIGZvcm1lZCBzdGF0ZSBmb3IgYmVndW4gd3JpdGUgYXN5bmMgb3BlcmF0aW9uJyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGhhbmRsZSBSRVNPTFZFX0FTWU5DX09QRVJBVElPTiBmb3Igd3JpdGUgYWN0aW9uJywgKCkgPT4ge1xuICAgIGNvbnN0IGFjdGlvbiA9IHtcbiAgICAgIGRlc2NyaXB0b3JJZDogJ1VQREFURV9QRVJTT05fREFUQScsXG4gICAgICBvcGVyYXRpb25TdGVwOiAnUkVTT0xWRV9BU1lOQ19PUEVSQVRJT04nLFxuICAgICAgdHlwZTogJ0FPTS8vUkVTT0xWRV9fVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgIGFjdGlvblR5cGU6ICdVUERBVEVfUEVSU09OX0RBVEEnLFxuICAgICAgcGVyc29uSWQ6IDExMVxuICAgIH07XG4gICAgKDAsIF9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscy5yZWdpc3RlckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMpKHtcbiAgICAgIGRlc2NyaXB0b3JJZDogJ1VQREFURV9QRVJTT05fREFUQScsXG4gICAgICByZXF1aXJlZFBhcmFtczogWydwZXJzb25JZCddLFxuICAgICAgb3BlcmF0aW9uVHlwZTogJ1dSSVRFJ1xuICAgIH0pO1xuICAgICgwLCBfY2hhaS5leHBlY3QpKCgwLCBfYXN5bmNPcGVyYXRpb25SZWR1Y2VyLmRlZmF1bHQpKHN0YXRlLCBhY3Rpb24pKS50by5oYXZlLmFsbC5rZXlzKCdVUERBVEVfUEVSU09OX0RBVEFfMTExJyk7XG4gICAgKDAsIF9jaGFpLmV4cGVjdCkoKDAsIF9hc3luY09wZXJhdGlvblJlZHVjZXIuZGVmYXVsdCkoc3RhdGUsIGFjdGlvbikpLnRvLm1hdGNoU25hcHNob3QoJ3dlbGwgZm9ybWVkIHN0YXRlIGZvciByZXNvbHZlZCB3cml0ZSBhc3luYyBvcGVyYXRpb24nKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgaGFuZGxlIFJFSkVDVF9BU1lOQ19PUEVSQVRJT04gZm9yIHdyaXRlIGFjdGlvbicsICgpID0+IHtcbiAgICBjb25zdCBhY3Rpb24gPSB7XG4gICAgICBkZXNjcmlwdG9ySWQ6ICdVUERBVEVfUEVSU09OX0RBVEEnLFxuICAgICAgb3BlcmF0aW9uU3RlcDogJ1JFSkVDVF9BU1lOQ19PUEVSQVRJT04nLFxuICAgICAgdHlwZTogJ0FPTS8vUkVKRUNUX19VUERBVEVfUEVSU09OX0RBVEEnLFxuICAgICAgYWN0aW9uVHlwZTogJ1VQREFURV9QRVJTT05fREFUQScsXG4gICAgICBwZXJzb25JZDogMTExXG4gICAgfTtcbiAgICAoMCwgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLnJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycykoe1xuICAgICAgZGVzY3JpcHRvcklkOiAnVVBEQVRFX1BFUlNPTl9EQVRBJyxcbiAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJ10sXG4gICAgICBvcGVyYXRpb25UeXBlOiAnV1JJVEUnXG4gICAgfSk7XG4gICAgKDAsIF9jaGFpLmV4cGVjdCkoKDAsIF9hc3luY09wZXJhdGlvblJlZHVjZXIuZGVmYXVsdCkoc3RhdGUsIGFjdGlvbikpLnRvLmhhdmUuYWxsLmtleXMoJ1VQREFURV9QRVJTT05fREFUQV8xMTEnKTtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KShzdGF0ZSwgYWN0aW9uKSkudG8ubWF0Y2hTbmFwc2hvdCgnd2VsbCBmb3JtZWQgc3RhdGUgZm9yIHJlamVjdGVkIHJlYWQgYXN5bmMgb3BlcmF0aW9uJyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGhhbmRsZSBCRUdJTl9BU1lOQ19PUEVSQVRJT04gZm9yIHJlYWQgYWN0aW9uJywgKCkgPT4ge1xuICAgIGNvbnN0IGFjdGlvbiA9IHtcbiAgICAgIGRlc2NyaXB0b3JJZDogJ0ZFVENIX1BFUlNPTl9EQVRBJyxcbiAgICAgIG9wZXJhdGlvblN0ZXA6ICdCRUdJTl9BU1lOQ19PUEVSQVRJT04nLFxuICAgICAgdHlwZTogJ0FPTS8vQkVHSU5fX0ZFVENIX1BFUlNPTl9EQVRBJyxcbiAgICAgIGFjdGlvblR5cGU6ICdGRVRDSF9QRVJTT05fREFUQScsXG4gICAgICBwZXJzb25JZDogMTExXG4gICAgfTtcbiAgICAoMCwgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLnJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycykoe1xuICAgICAgZGVzY3JpcHRvcklkOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnXSxcbiAgICAgIG9wZXJhdGlvblR5cGU6ICdSRUFEJ1xuICAgIH0pO1xuICAgICgwLCBfY2hhaS5leHBlY3QpKCgwLCBfYXN5bmNPcGVyYXRpb25SZWR1Y2VyLmRlZmF1bHQpKHN0YXRlLCBhY3Rpb24pKS50by5oYXZlLmFsbC5rZXlzKCdGRVRDSF9QRVJTT05fREFUQV8xMTEnKTtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KShzdGF0ZSwgYWN0aW9uKSkudG8ubWF0Y2hTbmFwc2hvdCgnd2VsbCBmb3JtZWQgc3RhdGUgZm9yIGJlZ3VuIHJlYWQgYXN5bmMgb3BlcmF0aW9uJyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGhhbmRsZSBSRVNPTFZFX0FTWU5DX09QRVJBVElPTiBmb3IgcmVhZCBhY3Rpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgYWN0aW9uID0ge1xuICAgICAgZGVzY3JpcHRvcklkOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgb3BlcmF0aW9uU3RlcDogJ1JFU09MVkVfQVNZTkNfT1BFUkFUSU9OJyxcbiAgICAgIHR5cGU6ICdBT00vL1JFU09MVkVfX0ZFVENIX1BFUlNPTl9EQVRBJyxcbiAgICAgIGFjdGlvblR5cGU6ICdGRVRDSF9QRVJTT05fREFUQScsXG4gICAgICBwZXJzb25JZDogMTExXG4gICAgfTtcbiAgICAoMCwgX2FzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLnJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycykoe1xuICAgICAgZGVzY3JpcHRvcklkOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnXSxcbiAgICAgIG9wZXJhdGlvblR5cGU6ICdSRUFEJ1xuICAgIH0pO1xuICAgICgwLCBfY2hhaS5leHBlY3QpKCgwLCBfYXN5bmNPcGVyYXRpb25SZWR1Y2VyLmRlZmF1bHQpKHN0YXRlLCBhY3Rpb24pKS50by5oYXZlLmFsbC5rZXlzKCdGRVRDSF9QRVJTT05fREFUQV8xMTEnKTtcbiAgICAoMCwgX2NoYWkuZXhwZWN0KSgoMCwgX2FzeW5jT3BlcmF0aW9uUmVkdWNlci5kZWZhdWx0KShzdGF0ZSwgYWN0aW9uKSkudG8ubWF0Y2hTbmFwc2hvdCgnd2VsbCBmb3JtZWQgc3RhdGUgZm9yIHJlc29sdmVkIHJlYWQgYXN5bmMgb3BlcmF0aW9uJyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGhhbmRsZSBSRUpFQ1RfQVNZTkNfT1BFUkFUSU9OIGZvciB3cml0ZSBhY3Rpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgYWN0aW9uID0ge1xuICAgICAgZGVzY3JpcHRvcklkOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgb3BlcmF0aW9uU3RlcDogJ1JFSkVDVF9BU1lOQ19PUEVSQVRJT04nLFxuICAgICAgdHlwZTogJ0FPTS8vUkVKRUNUX19GRVRDSF9QRVJTT05fREFUQScsXG4gICAgICBhY3Rpb25UeXBlOiAnRkVUQ0hfUEVSU09OX0RBVEEnLFxuICAgICAgcGVyc29uSWQ6IDExMVxuICAgIH07XG4gICAgKDAsIF9hc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscy5yZWdpc3RlckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMpKHtcbiAgICAgIGRlc2NyaXB0b3JJZDogJ0ZFVENIX1BFUlNPTl9EQVRBJyxcbiAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJ10sXG4gICAgICBvcGVyYXRpb25UeXBlOiAnV1JJVEUnXG4gICAgfSk7XG4gICAgKDAsIF9jaGFpLmV4cGVjdCkoKDAsIF9hc3luY09wZXJhdGlvblJlZHVjZXIuZGVmYXVsdCkoc3RhdGUsIGFjdGlvbikpLnRvLmhhdmUuYWxsLmtleXMoJ0ZFVENIX1BFUlNPTl9EQVRBXzExMScpO1xuICAgICgwLCBfY2hhaS5leHBlY3QpKCgwLCBfYXN5bmNPcGVyYXRpb25SZWR1Y2VyLmRlZmF1bHQpKHN0YXRlLCBhY3Rpb24pKS50by5tYXRjaFNuYXBzaG90KCd3ZWxsIGZvcm1lZCBzdGF0ZSBmb3IgcmVqZWN0ZWQgd3JpdGUgYXN5bmMgb3BlcmF0aW9uJyk7XG4gIH0pO1xufSk7Il19