05fc241601957e321e6468c50f7c520f
"use strict";

var _chai = require("chai");

var _sinon = _interopRequireDefault(require("sinon"));

var _config = _interopRequireDefault(require("../config"));

var _helpers = require("../helpers");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/* eslint-env jest */
describe('helpers', () => {
  beforeEach(() => {
    _config.default.setConfig({
      logger: {
        exceptionsCallback: _sinon.default.spy()
      }
    });
  });
  describe('generateAsyncOperationKey', () => {
    it('should create an asyncOperation key with no params', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData');
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData');
    });
    it('should create an asyncOperation key with one param', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_111');
    });
    it('should create an asyncOperation key with multiple params', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        teamId: 222,
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_222_111');
    });
    it('should throw an exception if a label is not provided', () => {
      const _asyncOperationManage = _config.default.getConfig(),
            logger = _asyncOperationManage.logger;

      (0, _helpers.generateAsyncOperationKey)();
      (0, _helpers.generateAsyncOperationKey)('');
      (0, _helpers.generateAsyncOperationKey)(undefined);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
    it('should throw an exception if a label is not a string', () => {
      const _asyncOperationManage2 = _config.default.getConfig(),
            logger = _asyncOperationManage2.logger;

      (0, _helpers.generateAsyncOperationKey)({});
      (0, _helpers.generateAsyncOperationKey)([]);
      (0, _helpers.generateAsyncOperationKey)(2);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
  });
  describe('getAndValidateParams', () => {
    beforeEach(() => {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should validate and successfully return correct asyncOperation params', () => {
      const params = {
        personId: 2,
        teamId: 10,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      const asyncOperationParams = (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(asyncOperationParams).to.deep.equal({
        personId: 2,
        teamId: 10
      });
    });
    it('should validate and fail on an undefined param', () => {
      const _asyncOperationManage3 = _config.default.getConfig(),
            logger = _asyncOperationManage3.logger;

      const params = {
        personId: undefined,
        teamId: 10,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
    it('should validate and fail on a missing param', () => {
      const _asyncOperationManage4 = _config.default.getConfig(),
            logger = _asyncOperationManage4.logger;

      const params = {
        personId: 2,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
  });
  describe('makeConstantsObject', () => {
    beforeEach(() => {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should make a constants object out of an array of string values', () => {
      const fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(fruits).to.deep.equal({
        APPLE: 'APPLE',
        BANANA: 'BANANA'
      });
    });
    it('should make a constants object that is immutable', () => {
      const fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(Object.isExtensible(fruits)).to.be.false;
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlcnNfdGVzdC5qcyJdLCJuYW1lcyI6WyJfY2hhaSIsInJlcXVpcmUiLCJfc2lub24iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2NvbmZpZyIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJzZXRDb25maWciLCJsb2dnZXIiLCJleGNlcHRpb25zQ2FsbGJhY2siLCJzcHkiLCJpdCIsImFzeW5jT3BlcmF0aW9uS2V5IiwiZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSIsImV4cGVjdCIsInRvIiwiZXF1YWwiLCJwZXJzb25JZCIsInRlYW1JZCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZSIsImdldENvbmZpZyIsInVuZGVmaW5lZCIsImNhbGxlZCIsImNhbGxDb3VudCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTIiLCJwYXJhbXMiLCJuYW1lIiwiYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwicmVxdWlyZWRQYXJhbXMiLCJhc3luY09wZXJhdGlvblBhcmFtcyIsImdldEFuZFZhbGlkYXRlUGFyYW1zIiwiZGVlcCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTMiLCJfYXN5bmNPcGVyYXRpb25NYW5hZ2U0IiwiZnJ1aXRzIiwibWFrZUNvbnN0YW50c09iamVjdCIsIkFQUExFIiwiQkFOQU5BIiwiT2JqZWN0IiwiaXNFeHRlbnNpYmxlIiwiYmUiLCJmYWxzZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsUUFBUUMsUUFBUSxNQUFSLENBQVo7O0FBRUEsSUFBSUMsU0FBU0MsdUJBQXVCRixRQUFRLE9BQVIsQ0FBdkIsQ0FBYjs7QUFFQSxJQUFJRyxVQUFVRCx1QkFBdUJGLFFBQVEsV0FBUixDQUF2QixDQUFkOztBQUVBLElBQUlJLFdBQVdKLFFBQVEsWUFBUixDQUFmOztBQUVBLFNBQVNFLHNCQUFULENBQWdDRyxHQUFoQyxFQUFxQztBQUFFLFNBQU9BLE9BQU9BLElBQUlD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RUFBa0MsQ0FBQyxPQUFELEVBQVUsUUFBVixDQUFsQyxDQUFmO0FBQ0EsT0FBQyxHQUFHdkMsTUFBTWtCLE1BQVYsRUFBa0J3QixPQUFPQyxZQUFQLENBQW9CTCxNQUFwQixDQUFsQixFQUErQ25CLEVBQS9DLENBQWtEeUIsRUFBbEQsQ0FBcURDLEtBQXJEO0FBQ0QsS0FIRDtBQUlELEdBbkJEO0FBb0JELENBeEhEIiwiZmlsZSI6ImhlbHBlcnNfdGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG52YXIgX2NoYWkgPSByZXF1aXJlKFwiY2hhaVwiKTtcblxudmFyIF9zaW5vbiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcInNpbm9uXCIpKTtcblxudmFyIF9jb25maWcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuXG52YXIgX2hlbHBlcnMgPSByZXF1aXJlKFwiLi4vaGVscGVyc1wiKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuLyogZXNsaW50LWVudiBqZXN0ICovXG5kZXNjcmliZSgnaGVscGVycycsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgX2NvbmZpZy5kZWZhdWx0LnNldENvbmZpZyh7XG4gICAgICBsb2dnZXI6IHtcbiAgICAgICAgZXhjZXB0aW9uc0NhbGxiYWNrOiBfc2lub24uZGVmYXVsdC5zcHkoKVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2dlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW4gYXN5bmNPcGVyYXRpb24ga2V5IHdpdGggbm8gcGFyYW1zJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25LZXkgPSAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoJ3VwZGF0ZVBlcnNvbkRhdGEnKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGFzeW5jT3BlcmF0aW9uS2V5KS50by5lcXVhbCgndXBkYXRlUGVyc29uRGF0YScpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGFuIGFzeW5jT3BlcmF0aW9uIGtleSB3aXRoIG9uZSBwYXJhbScsICgpID0+IHtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uS2V5ID0gKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCd1cGRhdGVQZXJzb25EYXRhJywge1xuICAgICAgICBwZXJzb25JZDogMTExXG4gICAgICB9KTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGFzeW5jT3BlcmF0aW9uS2V5KS50by5lcXVhbCgndXBkYXRlUGVyc29uRGF0YV8xMTEnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbiBhc3luY09wZXJhdGlvbiBrZXkgd2l0aCBtdWx0aXBsZSBwYXJhbXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvbktleSA9ICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgndXBkYXRlUGVyc29uRGF0YScsIHtcbiAgICAgICAgdGVhbUlkOiAyMjIsXG4gICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgIH0pO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoYXN5bmNPcGVyYXRpb25LZXkpLnRvLmVxdWFsKCd1cGRhdGVQZXJzb25EYXRhXzIyMl8xMTEnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBhIGxhYmVsIGlzIG5vdCBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IF9hc3luY09wZXJhdGlvbk1hbmFnZSA9IF9jb25maWcuZGVmYXVsdC5nZXRDb25maWcoKSxcbiAgICAgICAgICAgIGxvZ2dlciA9IF9hc3luY09wZXJhdGlvbk1hbmFnZS5sb2dnZXI7XG5cbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgpO1xuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCcnKTtcbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSh1bmRlZmluZWQpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsQ291bnQpLnRvLmVxdWFsKDMpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGEgbGFiZWwgaXMgbm90IGEgc3RyaW5nJywgKCkgPT4ge1xuICAgICAgY29uc3QgX2FzeW5jT3BlcmF0aW9uTWFuYWdlMiA9IF9jb25maWcuZGVmYXVsdC5nZXRDb25maWcoKSxcbiAgICAgICAgICAgIGxvZ2dlciA9IF9hc3luY09wZXJhdGlvbk1hbmFnZTIubG9nZ2VyO1xuXG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoe30pO1xuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKFtdKTtcbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgyKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGxvZ2dlci5leGNlcHRpb25zQ2FsbGJhY2suY2FsbGVkKS50by5lcXVhbCh0cnVlKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGxvZ2dlci5leGNlcHRpb25zQ2FsbGJhY2suY2FsbENvdW50KS50by5lcXVhbCgzKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdnZXRBbmRWYWxpZGF0ZVBhcmFtcycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIF9jb25maWcuZGVmYXVsdC5zZXRDb25maWcoe1xuICAgICAgICBsb2dnZXI6IHtcbiAgICAgICAgICBleGNlcHRpb25zQ2FsbGJhY2s6IF9zaW5vbi5kZWZhdWx0LnNweSgpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYW5kIHN1Y2Nlc3NmdWxseSByZXR1cm4gY29ycmVjdCBhc3luY09wZXJhdGlvbiBwYXJhbXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgIHBlcnNvbklkOiAyLFxuICAgICAgICB0ZWFtSWQ6IDEwLFxuICAgICAgICBuYW1lOiAnRGFyaWVuJ1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IHtcbiAgICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnLCAndGVhbUlkJ11cbiAgICAgIH07XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvblBhcmFtcyA9ICgwLCBfaGVscGVycy5nZXRBbmRWYWxpZGF0ZVBhcmFtcykocGFyYW1zLCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoYXN5bmNPcGVyYXRpb25QYXJhbXMpLnRvLmRlZXAuZXF1YWwoe1xuICAgICAgICBwZXJzb25JZDogMixcbiAgICAgICAgdGVhbUlkOiAxMFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhbmQgZmFpbCBvbiBhbiB1bmRlZmluZWQgcGFyYW0nLCAoKSA9PiB7XG4gICAgICBjb25zdCBfYXN5bmNPcGVyYXRpb25NYW5hZ2UzID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpLFxuICAgICAgICAgICAgbG9nZ2VyID0gX2FzeW5jT3BlcmF0aW9uTWFuYWdlMy5sb2dnZXI7XG5cbiAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgcGVyc29uSWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgdGVhbUlkOiAxMCxcbiAgICAgICAgbmFtZTogJ0RhcmllbidcbiAgICAgIH07XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSB7XG4gICAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJywgJ3RlYW1JZCddXG4gICAgICB9O1xuICAgICAgKDAsIF9oZWxwZXJzLmdldEFuZFZhbGlkYXRlUGFyYW1zKShwYXJhbXMsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcik7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhbmQgZmFpbCBvbiBhIG1pc3NpbmcgcGFyYW0nLCAoKSA9PiB7XG4gICAgICBjb25zdCBfYXN5bmNPcGVyYXRpb25NYW5hZ2U0ID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpLFxuICAgICAgICAgICAgbG9nZ2VyID0gX2FzeW5jT3BlcmF0aW9uTWFuYWdlNC5sb2dnZXI7XG5cbiAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgcGVyc29uSWQ6IDIsXG4gICAgICAgIG5hbWU6ICdEYXJpZW4nXG4gICAgICB9O1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yID0ge1xuICAgICAgICByZXF1aXJlZFBhcmFtczogWydwZXJzb25JZCcsICd0ZWFtSWQnXVxuICAgICAgfTtcbiAgICAgICgwLCBfaGVscGVycy5nZXRBbmRWYWxpZGF0ZVBhcmFtcykocGFyYW1zLCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ21ha2VDb25zdGFudHNPYmplY3QnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBfY29uZmlnLmRlZmF1bHQuc2V0Q29uZmlnKHtcbiAgICAgICAgbG9nZ2VyOiB7XG4gICAgICAgICAgZXhjZXB0aW9uc0NhbGxiYWNrOiBfc2lub24uZGVmYXVsdC5zcHkoKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG1ha2UgYSBjb25zdGFudHMgb2JqZWN0IG91dCBvZiBhbiBhcnJheSBvZiBzdHJpbmcgdmFsdWVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZnJ1aXRzID0gKDAsIF9oZWxwZXJzLm1ha2VDb25zdGFudHNPYmplY3QpKFsnQVBQTEUnLCAnQkFOQU5BJ10pO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoZnJ1aXRzKS50by5kZWVwLmVxdWFsKHtcbiAgICAgICAgQVBQTEU6ICdBUFBMRScsXG4gICAgICAgIEJBTkFOQTogJ0JBTkFOQSdcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbWFrZSBhIGNvbnN0YW50cyBvYmplY3QgdGhhdCBpcyBpbW11dGFibGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmcnVpdHMgPSAoMCwgX2hlbHBlcnMubWFrZUNvbnN0YW50c09iamVjdCkoWydBUFBMRScsICdCQU5BTkEnXSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShPYmplY3QuaXNFeHRlbnNpYmxlKGZydWl0cykpLnRvLmJlLmZhbHNlO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdfQ==