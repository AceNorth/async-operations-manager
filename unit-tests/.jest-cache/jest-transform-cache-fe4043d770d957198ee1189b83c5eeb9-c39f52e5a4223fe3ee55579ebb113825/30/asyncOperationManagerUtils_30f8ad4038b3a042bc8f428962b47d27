1ab20b6bca345647a0460dc27aaac701
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getAsyncOperationInfo = exports.getStateForOperationAfterStep = exports.getAsyncOperationDescriptor = exports.registerAsyncOperationDescriptors = exports.getAsyncOperation = exports.clearRegisteredAsyncDescriptors = exports.getRegisteredAsyncDescriptors = void 0;

var _lodash = require("lodash");

var _asyncOperationStateUtils = _interopRequireDefault(require("./asyncOperationStateUtils"));

var _config = _interopRequireDefault(require("./config"));

var _asyncOperationDescriptorRegistry = require("./asyncOperationDescriptorRegistry");

var _asyncOperationUtils = require("./asyncOperationUtils");

var _helpers = require("./helpers");

var _constants = require("./constants");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

// TODO: JSDocify every function
// 
// This file contains the 'switchboard' logic to coordinate the various
// lower-level functions that update state. These functions are exposed
// to the consumer of the library.
//
const getRegisteredAsyncDescriptors = _asyncOperationDescriptorRegistry.asyncOperationDescriptorRegistry.getAsyncOperationDescriptors;
exports.getRegisteredAsyncDescriptors = getRegisteredAsyncDescriptors;
const clearRegisteredAsyncDescriptors = _asyncOperationDescriptorRegistry.asyncOperationDescriptorRegistry.clearAsyncOperationDescriptors;
exports.clearRegisteredAsyncDescriptors = clearRegisteredAsyncDescriptors;

const getAsyncOperationDescriptor = descriptorId => {
  const asyncOperationDescriptors = _asyncOperationDescriptorRegistry.asyncOperationDescriptorRegistry.getAsyncOperationDescriptors();

  return _asyncOperationStateUtils.default.getAsyncOperationDescriptor(asyncOperationDescriptors, descriptorId);
};

exports.getAsyncOperationDescriptor = getAsyncOperationDescriptor;

const getAsyncOperationInfo = (descriptorId, params) => {
  const asyncOperationDescriptor = getAsyncOperationDescriptor(descriptorId);
  const asyncOperationParams = (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
  const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)(descriptorId, asyncOperationParams);
  const otherFields = (0, _lodash.omit)(params, [...asyncOperationDescriptor.requiredParams]);
  return {
    asyncOperationDescriptor,
    asyncOperationParams,
    asyncOperationKey,
    otherFields
  };
};

exports.getAsyncOperationInfo = getAsyncOperationInfo;

const registerAsyncOperationDescriptors = function registerAsyncOperationDescriptors(asyncOperationDescriptors) {
  let newAsyncOperationDescriptors;

  const existingAsyncOperationDescriptors = _asyncOperationDescriptorRegistry.asyncOperationDescriptorRegistry.getAsyncOperationDescriptors();

  const config = _config.default.getConfig();

  for (var _len = arguments.length, otherDescriptors = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    otherDescriptors[_key - 1] = arguments[_key];
  }

  if (!(0, _lodash.isEmpty)(otherDescriptors)) {
    config.logger.exceptionsCallback(`
      You provided more than one argument to registerAsyncOperationDescriptors.
      You likely forgot to put multiple descriptors within an array`, new Error());
  } // handle array or single object arguments


  if ((0, _lodash.isArray)(asyncOperationDescriptors)) {
    newAsyncOperationDescriptors = (0, _lodash.reduce)(asyncOperationDescriptors, (acc, asyncOperationDescriptor) => {
      return _asyncOperationStateUtils.default.updateAsyncOperationDescriptor(acc, asyncOperationDescriptor);
    }, existingAsyncOperationDescriptors);
  } else {
    newAsyncOperationDescriptors = _asyncOperationStateUtils.default.updateAsyncOperationDescriptor(existingAsyncOperationDescriptors, asyncOperationDescriptors);
  }

  _asyncOperationDescriptorRegistry.asyncOperationDescriptorRegistry.setAsyncOperationDescriptors(newAsyncOperationDescriptors);

  return newAsyncOperationDescriptors;
}; // TODO: heavy unit testing needed!


exports.registerAsyncOperationDescriptors = registerAsyncOperationDescriptors;

const getAsyncOperation = (state, descriptorId, params, otherFields) => {
  const _getAsyncOperationInf = getAsyncOperationInfo(descriptorId, params),
        asyncOperationDescriptor = _getAsyncOperationInf.asyncOperationDescriptor,
        asyncOperationParams = _getAsyncOperationInf.asyncOperationParams,
        asyncOperationKey = _getAsyncOperationInf.asyncOperationKey;

  const registeredAsyncOperationDescriptors = getRegisteredAsyncDescriptors();
  return _asyncOperationStateUtils.default.getAsyncOperation(state, registeredAsyncOperationDescriptors, asyncOperationKey, asyncOperationDescriptor, asyncOperationParams, otherFields);
}; // switchboard for resolving the Read operation steps


exports.getAsyncOperation = getAsyncOperation;
const readStepLookup = {
  [_constants.ASYNC_OPERATION_STEPS.BEGIN_ASYNC_OPERATION]: (asyncOperation, asyncOperationParams, otherFields) => (0, _asyncOperationUtils.beginReadAsyncOperation)(asyncOperation, asyncOperationParams, otherFields),
  [_constants.ASYNC_OPERATION_STEPS.RESOLVE_ASYNC_OPERATION]: (asyncOperation, asyncOperationParams, otherFields) => (0, _asyncOperationUtils.resolveReadAsyncOperation)(asyncOperation, asyncOperationParams, otherFields),
  [_constants.ASYNC_OPERATION_STEPS.REJECT_ASYNC_OPERATION]: (asyncOperation, asyncOperationParams, otherFields) => (0, _asyncOperationUtils.rejectReadAsyncOperation)(asyncOperation, asyncOperationParams, otherFields)
}; // switchboard for resolving Write operation steps

const writeStepLookup = {
  [_constants.ASYNC_OPERATION_STEPS.BEGIN_ASYNC_OPERATION]: (asyncOperation, asyncOperationParams, otherFields) => (0, _asyncOperationUtils.beginWriteAsyncOperation)(asyncOperation, asyncOperationParams, otherFields),
  [_constants.ASYNC_OPERATION_STEPS.RESOLVE_ASYNC_OPERATION]: (asyncOperation, asyncOperationParams, otherFields) => (0, _asyncOperationUtils.resolveWriteAsyncOperation)(asyncOperation, asyncOperationParams, otherFields),
  [_constants.ASYNC_OPERATION_STEPS.REJECT_ASYNC_OPERATION]: (asyncOperation, asyncOperationParams, otherFields) => (0, _asyncOperationUtils.rejectWriteAsyncOperation)(asyncOperation, asyncOperationParams, otherFields)
}; // first switchboard to transform an async operation

const transformTypeLookup = {
  [_constants.ASYNC_OPERATION_TYPES.READ]: (asyncOperation, asyncOperationStep, asyncOperationParams, otherFields) => readStepLookup[asyncOperationStep](asyncOperation, asyncOperationParams, otherFields),
  [_constants.ASYNC_OPERATION_TYPES.WRITE]: (asyncOperation, asyncOperationStep, asyncOperationParams, otherFields) => writeStepLookup[asyncOperationStep](asyncOperation, asyncOperationParams, otherFields)
}; // this function is called in the reducer (in redux integration)

const getStateForOperationAfterStep = (state, asyncOperationStep, descriptorId, params) => {
  let newState = state;

  const _getAsyncOperationInf2 = getAsyncOperationInfo(descriptorId, params),
        asyncOperationDescriptor = _getAsyncOperationInf2.asyncOperationDescriptor,
        asyncOperationParams = _getAsyncOperationInf2.asyncOperationParams,
        asyncOperationKey = _getAsyncOperationInf2.asyncOperationKey,
        otherFields = _getAsyncOperationInf2.otherFields;

  const asyncOperationToTranform = getAsyncOperation(state, descriptorId, asyncOperationParams, otherFields);
  const newAsyncOperation = transformTypeLookup[asyncOperationDescriptor.operationType](asyncOperationToTranform, asyncOperationStep, asyncOperationParams, otherFields);
  newState = _asyncOperationStateUtils.default.updateAsyncOperation(state, asyncOperationKey, newAsyncOperation, asyncOperationDescriptor);
  return newState;
};

exports.getStateForOperationAfterStep = getStateForOperationAfterStep;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZ2V0QXN5bmNPcGVyYXRpb25JbmZvIiwiZ2V0U3RhdGVGb3JPcGVyYXRpb25BZnRlclN0ZXAiLCJnZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IiLCJyZWdpc3RlckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMiLCJnZXRBc3luY09wZXJhdGlvbiIsImNsZWFyUmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMiLCJnZXRSZWdpc3RlcmVkQXN5bmNEZXNjcmlwdG9ycyIsIl9sb2Rhc2giLCJyZXF1aXJlIiwiX2FzeW5jT3BlcmF0aW9uU3RhdGVVdGlscyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfY29uZmlnIiwiX2FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5IiwiX2FzeW5jT3BlcmF0aW9uVXRpbHMiLCJfaGVscGVycyIsIl9jb25zdGFudHMiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5IiwiZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyIsImNsZWFyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyIsImRlc2NyaXB0b3JJZCIsImFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMiLCJwYXJhbXMiLCJhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IiLCJhc3luY09wZXJhdGlvblBhcmFtcyIsImdldEFuZFZhbGlkYXRlUGFyYW1zIiwiYXN5bmNPcGVyYXRpb25LZXkiLCJnZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5Iiwib3RoZXJGaWVsZHMiLCJvbWl0IiwicmVxdWlyZWRQYXJhbXMiLCJuZXdBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzIiwiZXhpc3RpbmdBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzIiwiY29uZmlnIiwiZ2V0Q29uZmlnIiwiX2xlbiIsImFyZ3VtZW50cyIsImxlbmd0aCIsIm90aGVyRGVzY3JpcHRvcnMiLCJBcnJheSIsIl9rZXkiLCJpc0VtcHR5IiwibG9nZ2VyIiwiZXhjZXB0aW9uc0NhbGxiYWNrIiwiRXJyb3IiLCJpc0FycmF5IiwicmVkdWNlIiwiYWNjIiwidXBkYXRlQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwic2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyIsInN0YXRlIiwiX2dldEFzeW5jT3BlcmF0aW9uSW5mIiwicmVnaXN0ZXJlZEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMiLCJyZWFkU3RlcExvb2t1cCIsIkFTWU5DX09QRVJBVElPTl9TVEVQUyIsIkJFR0lOX0FTWU5DX09QRVJBVElPTiIsImFzeW5jT3BlcmF0aW9uIiwiYmVnaW5SZWFkQXN5bmNPcGVyYXRpb24iLCJSRVNPTFZFX0FTWU5DX09QRVJBVElPTiIsInJlc29sdmVSZWFkQXN5bmNPcGVyYXRpb24iLCJSRUpFQ1RfQVNZTkNfT1BFUkFUSU9OIiwicmVqZWN0UmVhZEFzeW5jT3BlcmF0aW9uIiwid3JpdGVTdGVwTG9va3VwIiwiYmVnaW5Xcml0ZUFzeW5jT3BlcmF0aW9uIiwicmVzb2x2ZVdyaXRlQXN5bmNPcGVyYXRpb24iLCJyZWplY3RXcml0ZUFzeW5jT3BlcmF0aW9uIiwidHJhbnNmb3JtVHlwZUxvb2t1cCIsIkFTWU5DX09QRVJBVElPTl9UWVBFUyIsIlJFQUQiLCJhc3luY09wZXJhdGlvblN0ZXAiLCJXUklURSIsIm5ld1N0YXRlIiwiX2dldEFzeW5jT3BlcmF0aW9uSW5mMiIsImFzeW5jT3BlcmF0aW9uVG9UcmFuZm9ybSIsIm5ld0FzeW5jT3BlcmF0aW9uIiwib3BlcmF0aW9uVHlwZSIsInVwZGF0ZUFzeW5jT3BlcmF0aW9uIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsT0FBT0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLFNBQU87QUFEb0MsQ0FBN0M7QUFHQUQsUUFB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b0JBQW9COEMsdUJBQXVCOUMsaUJBSGpEO0FBQUEsUUFJTUUsY0FBYzRDLHVCQUF1QjVDLFdBSjNDOztBQU1BLFFBQU02QywyQkFBMkJ2RSxrQkFBa0JnRCxLQUFsQixFQUF5QjlCLFlBQXpCLEVBQXVDSSxvQkFBdkMsRUFBNkRJLFdBQTdELENBQWpDO0FBQ0EsUUFBTThDLG9CQUFvQlIsb0JBQW9CM0MseUJBQXlCb0QsYUFBN0MsRUFBNERGLHdCQUE1RCxFQUFzRkosa0JBQXRGLEVBQTBHN0Msb0JBQTFHLEVBQWdJSSxXQUFoSSxDQUExQjtBQUNBMkMsYUFBV2hFLDBCQUEwQlMsT0FBMUIsQ0FBa0M0RCxvQkFBbEMsQ0FBdUQxQixLQUF2RCxFQUE4RHhCLGlCQUE5RCxFQUFpRmdELGlCQUFqRixFQUFvR25ELHdCQUFwRyxDQUFYO0FBQ0EsU0FBT2dELFFBQVA7QUFDRCxDQWJEOztBQWVBM0UsUUFBUUcsNkJBQVIsR0FBd0NBLDZCQUF4QyIsImZpbGUiOiJhc3luY09wZXJhdGlvbk1hbmFnZXJVdGlscy5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5nZXRBc3luY09wZXJhdGlvbkluZm8gPSBleHBvcnRzLmdldFN0YXRlRm9yT3BlcmF0aW9uQWZ0ZXJTdGVwID0gZXhwb3J0cy5nZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSBleHBvcnRzLnJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyA9IGV4cG9ydHMuZ2V0QXN5bmNPcGVyYXRpb24gPSBleHBvcnRzLmNsZWFyUmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMgPSBleHBvcnRzLmdldFJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzID0gdm9pZCAwO1xuXG52YXIgX2xvZGFzaCA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG5cbnZhciBfYXN5bmNPcGVyYXRpb25TdGF0ZVV0aWxzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9hc3luY09wZXJhdGlvblN0YXRlVXRpbHNcIikpO1xuXG52YXIgX2NvbmZpZyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vY29uZmlnXCIpKTtcblxudmFyIF9hc3luY09wZXJhdGlvbkRlc2NyaXB0b3JSZWdpc3RyeSA9IHJlcXVpcmUoXCIuL2FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5XCIpO1xuXG52YXIgX2FzeW5jT3BlcmF0aW9uVXRpbHMgPSByZXF1aXJlKFwiLi9hc3luY09wZXJhdGlvblV0aWxzXCIpO1xuXG52YXIgX2hlbHBlcnMgPSByZXF1aXJlKFwiLi9oZWxwZXJzXCIpO1xuXG52YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuLy8gVE9ETzogSlNEb2NpZnkgZXZlcnkgZnVuY3Rpb25cbi8vIFxuLy8gVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSAnc3dpdGNoYm9hcmQnIGxvZ2ljIHRvIGNvb3JkaW5hdGUgdGhlIHZhcmlvdXNcbi8vIGxvd2VyLWxldmVsIGZ1bmN0aW9ucyB0aGF0IHVwZGF0ZSBzdGF0ZS4gVGhlc2UgZnVuY3Rpb25zIGFyZSBleHBvc2VkXG4vLyB0byB0aGUgY29uc3VtZXIgb2YgdGhlIGxpYnJhcnkuXG4vL1xuY29uc3QgZ2V0UmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMgPSBfYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yUmVnaXN0cnkuYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yUmVnaXN0cnkuZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycztcbmV4cG9ydHMuZ2V0UmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMgPSBnZXRSZWdpc3RlcmVkQXN5bmNEZXNjcmlwdG9ycztcbmNvbnN0IGNsZWFyUmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMgPSBfYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yUmVnaXN0cnkuYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yUmVnaXN0cnkuY2xlYXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzO1xuZXhwb3J0cy5jbGVhclJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzID0gY2xlYXJSZWdpc3RlcmVkQXN5bmNEZXNjcmlwdG9ycztcblxuY29uc3QgZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yID0gZGVzY3JpcHRvcklkID0+IHtcbiAgY29uc3QgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyA9IF9hc3luY09wZXJhdGlvbkRlc2NyaXB0b3JSZWdpc3RyeS5hc3luY09wZXJhdGlvbkRlc2NyaXB0b3JSZWdpc3RyeS5nZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKCk7XG5cbiAgcmV0dXJuIF9hc3luY09wZXJhdGlvblN0YXRlVXRpbHMuZGVmYXVsdC5nZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IoYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycywgZGVzY3JpcHRvcklkKTtcbn07XG5cbmV4cG9ydHMuZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yID0gZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yO1xuXG5jb25zdCBnZXRBc3luY09wZXJhdGlvbkluZm8gPSAoZGVzY3JpcHRvcklkLCBwYXJhbXMpID0+IHtcbiAgY29uc3QgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yID0gZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKGRlc2NyaXB0b3JJZCk7XG4gIGNvbnN0IGFzeW5jT3BlcmF0aW9uUGFyYW1zID0gKDAsIF9oZWxwZXJzLmdldEFuZFZhbGlkYXRlUGFyYW1zKShwYXJhbXMsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcik7XG4gIGNvbnN0IGFzeW5jT3BlcmF0aW9uS2V5ID0gKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKGRlc2NyaXB0b3JJZCwgYXN5bmNPcGVyYXRpb25QYXJhbXMpO1xuICBjb25zdCBvdGhlckZpZWxkcyA9ICgwLCBfbG9kYXNoLm9taXQpKHBhcmFtcywgWy4uLmFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvci5yZXF1aXJlZFBhcmFtc10pO1xuICByZXR1cm4ge1xuICAgIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcixcbiAgICBhc3luY09wZXJhdGlvblBhcmFtcyxcbiAgICBhc3luY09wZXJhdGlvbktleSxcbiAgICBvdGhlckZpZWxkc1xuICB9O1xufTtcblxuZXhwb3J0cy5nZXRBc3luY09wZXJhdGlvbkluZm8gPSBnZXRBc3luY09wZXJhdGlvbkluZm87XG5cbmNvbnN0IHJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyA9IGZ1bmN0aW9uIHJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyhhc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSB7XG4gIGxldCBuZXdBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzO1xuXG4gIGNvbnN0IGV4aXN0aW5nQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyA9IF9hc3luY09wZXJhdGlvbkRlc2NyaXB0b3JSZWdpc3RyeS5hc3luY09wZXJhdGlvbkRlc2NyaXB0b3JSZWdpc3RyeS5nZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKCk7XG5cbiAgY29uc3QgY29uZmlnID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpO1xuXG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBvdGhlckRlc2NyaXB0b3JzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBvdGhlckRlc2NyaXB0b3JzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIGlmICghKDAsIF9sb2Rhc2guaXNFbXB0eSkob3RoZXJEZXNjcmlwdG9ycykpIHtcbiAgICBjb25maWcubG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjayhgXG4gICAgICBZb3UgcHJvdmlkZWQgbW9yZSB0aGFuIG9uZSBhcmd1bWVudCB0byByZWdpc3RlckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMuXG4gICAgICBZb3UgbGlrZWx5IGZvcmdvdCB0byBwdXQgbXVsdGlwbGUgZGVzY3JpcHRvcnMgd2l0aGluIGFuIGFycmF5YCwgbmV3IEVycm9yKCkpO1xuICB9IC8vIGhhbmRsZSBhcnJheSBvciBzaW5nbGUgb2JqZWN0IGFyZ3VtZW50c1xuXG5cbiAgaWYgKCgwLCBfbG9kYXNoLmlzQXJyYXkpKGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMpKSB7XG4gICAgbmV3QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyA9ICgwLCBfbG9kYXNoLnJlZHVjZSkoYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycywgKGFjYywgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKSA9PiB7XG4gICAgICByZXR1cm4gX2FzeW5jT3BlcmF0aW9uU3RhdGVVdGlscy5kZWZhdWx0LnVwZGF0ZUFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcihhY2MsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcik7XG4gICAgfSwgZXhpc3RpbmdBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKTtcbiAgfSBlbHNlIHtcbiAgICBuZXdBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzID0gX2FzeW5jT3BlcmF0aW9uU3RhdGVVdGlscy5kZWZhdWx0LnVwZGF0ZUFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcihleGlzdGluZ0FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMpO1xuICB9XG5cbiAgX2FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5LmFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5LnNldEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMobmV3QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyk7XG5cbiAgcmV0dXJuIG5ld0FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnM7XG59OyAvLyBUT0RPOiBoZWF2eSB1bml0IHRlc3RpbmcgbmVlZGVkIVxuXG5cbmV4cG9ydHMucmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzID0gcmVnaXN0ZXJBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzO1xuXG5jb25zdCBnZXRBc3luY09wZXJhdGlvbiA9IChzdGF0ZSwgZGVzY3JpcHRvcklkLCBwYXJhbXMsIG90aGVyRmllbGRzKSA9PiB7XG4gIGNvbnN0IF9nZXRBc3luY09wZXJhdGlvbkluZiA9IGdldEFzeW5jT3BlcmF0aW9uSW5mbyhkZXNjcmlwdG9ySWQsIHBhcmFtcyksXG4gICAgICAgIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IF9nZXRBc3luY09wZXJhdGlvbkluZi5hc3luY09wZXJhdGlvbkRlc2NyaXB0b3IsXG4gICAgICAgIGFzeW5jT3BlcmF0aW9uUGFyYW1zID0gX2dldEFzeW5jT3BlcmF0aW9uSW5mLmFzeW5jT3BlcmF0aW9uUGFyYW1zLFxuICAgICAgICBhc3luY09wZXJhdGlvbktleSA9IF9nZXRBc3luY09wZXJhdGlvbkluZi5hc3luY09wZXJhdGlvbktleTtcblxuICBjb25zdCByZWdpc3RlcmVkQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyA9IGdldFJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzKCk7XG4gIHJldHVybiBfYXN5bmNPcGVyYXRpb25TdGF0ZVV0aWxzLmRlZmF1bHQuZ2V0QXN5bmNPcGVyYXRpb24oc3RhdGUsIHJlZ2lzdGVyZWRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzLCBhc3luY09wZXJhdGlvbktleSwgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpO1xufTsgLy8gc3dpdGNoYm9hcmQgZm9yIHJlc29sdmluZyB0aGUgUmVhZCBvcGVyYXRpb24gc3RlcHNcblxuXG5leHBvcnRzLmdldEFzeW5jT3BlcmF0aW9uID0gZ2V0QXN5bmNPcGVyYXRpb247XG5jb25zdCByZWFkU3RlcExvb2t1cCA9IHtcbiAgW19jb25zdGFudHMuQVNZTkNfT1BFUkFUSU9OX1NURVBTLkJFR0lOX0FTWU5DX09QRVJBVElPTl06IChhc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25QYXJhbXMsIG90aGVyRmllbGRzKSA9PiAoMCwgX2FzeW5jT3BlcmF0aW9uVXRpbHMuYmVnaW5SZWFkQXN5bmNPcGVyYXRpb24pKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpLFxuICBbX2NvbnN0YW50cy5BU1lOQ19PUEVSQVRJT05fU1RFUFMuUkVTT0xWRV9BU1lOQ19PUEVSQVRJT05dOiAoYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcykgPT4gKDAsIF9hc3luY09wZXJhdGlvblV0aWxzLnJlc29sdmVSZWFkQXN5bmNPcGVyYXRpb24pKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpLFxuICBbX2NvbnN0YW50cy5BU1lOQ19PUEVSQVRJT05fU1RFUFMuUkVKRUNUX0FTWU5DX09QRVJBVElPTl06IChhc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25QYXJhbXMsIG90aGVyRmllbGRzKSA9PiAoMCwgX2FzeW5jT3BlcmF0aW9uVXRpbHMucmVqZWN0UmVhZEFzeW5jT3BlcmF0aW9uKShhc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25QYXJhbXMsIG90aGVyRmllbGRzKVxufTsgLy8gc3dpdGNoYm9hcmQgZm9yIHJlc29sdmluZyBXcml0ZSBvcGVyYXRpb24gc3RlcHNcblxuY29uc3Qgd3JpdGVTdGVwTG9va3VwID0ge1xuICBbX2NvbnN0YW50cy5BU1lOQ19PUEVSQVRJT05fU1RFUFMuQkVHSU5fQVNZTkNfT1BFUkFUSU9OXTogKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpID0+ICgwLCBfYXN5bmNPcGVyYXRpb25VdGlscy5iZWdpbldyaXRlQXN5bmNPcGVyYXRpb24pKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpLFxuICBbX2NvbnN0YW50cy5BU1lOQ19PUEVSQVRJT05fU1RFUFMuUkVTT0xWRV9BU1lOQ19PUEVSQVRJT05dOiAoYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcykgPT4gKDAsIF9hc3luY09wZXJhdGlvblV0aWxzLnJlc29sdmVXcml0ZUFzeW5jT3BlcmF0aW9uKShhc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25QYXJhbXMsIG90aGVyRmllbGRzKSxcbiAgW19jb25zdGFudHMuQVNZTkNfT1BFUkFUSU9OX1NURVBTLlJFSkVDVF9BU1lOQ19PUEVSQVRJT05dOiAoYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcykgPT4gKDAsIF9hc3luY09wZXJhdGlvblV0aWxzLnJlamVjdFdyaXRlQXN5bmNPcGVyYXRpb24pKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpXG59OyAvLyBmaXJzdCBzd2l0Y2hib2FyZCB0byB0cmFuc2Zvcm0gYW4gYXN5bmMgb3BlcmF0aW9uXG5cbmNvbnN0IHRyYW5zZm9ybVR5cGVMb29rdXAgPSB7XG4gIFtfY29uc3RhbnRzLkFTWU5DX09QRVJBVElPTl9UWVBFUy5SRUFEXTogKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblN0ZXAsIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcykgPT4gcmVhZFN0ZXBMb29rdXBbYXN5bmNPcGVyYXRpb25TdGVwXShhc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25QYXJhbXMsIG90aGVyRmllbGRzKSxcbiAgW19jb25zdGFudHMuQVNZTkNfT1BFUkFUSU9OX1RZUEVTLldSSVRFXTogKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblN0ZXAsIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcykgPT4gd3JpdGVTdGVwTG9va3VwW2FzeW5jT3BlcmF0aW9uU3RlcF0oYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcylcbn07IC8vIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGluIHRoZSByZWR1Y2VyIChpbiByZWR1eCBpbnRlZ3JhdGlvbilcblxuY29uc3QgZ2V0U3RhdGVGb3JPcGVyYXRpb25BZnRlclN0ZXAgPSAoc3RhdGUsIGFzeW5jT3BlcmF0aW9uU3RlcCwgZGVzY3JpcHRvcklkLCBwYXJhbXMpID0+IHtcbiAgbGV0IG5ld1N0YXRlID0gc3RhdGU7XG5cbiAgY29uc3QgX2dldEFzeW5jT3BlcmF0aW9uSW5mMiA9IGdldEFzeW5jT3BlcmF0aW9uSW5mbyhkZXNjcmlwdG9ySWQsIHBhcmFtcyksXG4gICAgICAgIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IF9nZXRBc3luY09wZXJhdGlvbkluZjIuYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yLFxuICAgICAgICBhc3luY09wZXJhdGlvblBhcmFtcyA9IF9nZXRBc3luY09wZXJhdGlvbkluZjIuYXN5bmNPcGVyYXRpb25QYXJhbXMsXG4gICAgICAgIGFzeW5jT3BlcmF0aW9uS2V5ID0gX2dldEFzeW5jT3BlcmF0aW9uSW5mMi5hc3luY09wZXJhdGlvbktleSxcbiAgICAgICAgb3RoZXJGaWVsZHMgPSBfZ2V0QXN5bmNPcGVyYXRpb25JbmYyLm90aGVyRmllbGRzO1xuXG4gIGNvbnN0IGFzeW5jT3BlcmF0aW9uVG9UcmFuZm9ybSA9IGdldEFzeW5jT3BlcmF0aW9uKHN0YXRlLCBkZXNjcmlwdG9ySWQsIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcyk7XG4gIGNvbnN0IG5ld0FzeW5jT3BlcmF0aW9uID0gdHJhbnNmb3JtVHlwZUxvb2t1cFthc3luY09wZXJhdGlvbkRlc2NyaXB0b3Iub3BlcmF0aW9uVHlwZV0oYXN5bmNPcGVyYXRpb25Ub1RyYW5mb3JtLCBhc3luY09wZXJhdGlvblN0ZXAsIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcyk7XG4gIG5ld1N0YXRlID0gX2FzeW5jT3BlcmF0aW9uU3RhdGVVdGlscy5kZWZhdWx0LnVwZGF0ZUFzeW5jT3BlcmF0aW9uKHN0YXRlLCBhc3luY09wZXJhdGlvbktleSwgbmV3QXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcik7XG4gIHJldHVybiBuZXdTdGF0ZTtcbn07XG5cbmV4cG9ydHMuZ2V0U3RhdGVGb3JPcGVyYXRpb25BZnRlclN0ZXAgPSBnZXRTdGF0ZUZvck9wZXJhdGlvbkFmdGVyU3RlcDsiXX0=