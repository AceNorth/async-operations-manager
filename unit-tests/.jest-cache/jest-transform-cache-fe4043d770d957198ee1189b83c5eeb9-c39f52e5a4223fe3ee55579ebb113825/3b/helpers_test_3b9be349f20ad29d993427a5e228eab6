a2cd68347d02e204960d68b7f447339a
"use strict";

var _chai = require("chai");

var _sinon = _interopRequireDefault(require("sinon"));

var _config = _interopRequireDefault(require("../config"));

var _helpers = require("../helpers");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/* eslint-env jest */
describe('helpers', () => {
  beforeEach(() => {
    _config.default.setConfig({
      logger: {
        exceptionsCallback: _sinon.default.spy()
      }
    });
  });
  describe('generateAsyncOperationKey', () => {
    it('should create an asyncOperation key with no params', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData');
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData');
    });
    it('should create an asyncOperation key with one param', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_111');
    });
    it('should create an asyncOperation key with multiple params', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        teamId: 222,
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_222_111');
    });
    it('should throw an exception if a label is not provided', () => {
      const _asyncOperationManage = _config.default.getConfig(),
            logger = _asyncOperationManage.logger;

      (0, _helpers.generateAsyncOperationKey)();
      (0, _helpers.generateAsyncOperationKey)('');
      (0, _helpers.generateAsyncOperationKey)(undefined);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
    it('should throw an exception if a label is not a string', () => {
      const _asyncOperationManage2 = _config.default.getConfig(),
            logger = _asyncOperationManage2.logger;

      (0, _helpers.generateAsyncOperationKey)({});
      (0, _helpers.generateAsyncOperationKey)([]);
      (0, _helpers.generateAsyncOperationKey)(2);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
  });
  describe('getAndValidateParams', () => {
    beforeEach(() => {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should validate and successfully return correct asyncOperation params', () => {
      const params = {
        personId: 2,
        teamId: 10,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      const asyncOperationParams = (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(asyncOperationParams).to.deep.equal({
        personId: 2,
        teamId: 10
      });
    });
    it('should validate and fail on an undefined param', () => {
      const _asyncOperationManage3 = _config.default.getConfig(),
            logger = _asyncOperationManage3.logger;

      const params = {
        personId: undefined,
        teamId: 10,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
    it('should validate and fail on a missing param', () => {
      const _asyncOperationManage4 = _config.default.getConfig(),
            logger = _asyncOperationManage4.logger;

      const params = {
        personId: 2,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
  });
  describe('makeConstantsObject', () => {
    beforeEach(() => {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should make a constants object out of an array of string values', () => {
      const fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(fruits).to.deep.equal({
        APPLE: 'APPLE',
        BANANA: 'BANANA'
      });
    });
    it('should make a constants object that is immutable', () => {
      const fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      fruits.APPLE = 'PEAR';
      fruits.ORANGE = 'ORANGE';
      (0, _chai.expect)(fruits.isFrozen()).to.be.true;
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlcnNfdGVzdC5qcyJdLCJuYW1lcyI6WyJfY2hhaSIsInJlcXVpcmUiLCJfc2lub24iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2NvbmZpZyIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJzZXRDb25maWciLCJsb2dnZXIiLCJleGNlcHRpb25zQ2FsbGJhY2siLCJzcHkiLCJpdCIsImFzeW5jT3BlcmF0aW9uS2V5IiwiZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSIsImV4cGVjdCIsInRvIiwiZXF1YWwiLCJwZXJzb25JZCIsInRlYW1JZCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZSIsImdldENvbmZpZyIsInVuZGVmaW5lZCIsImNhbGxlZCIsImNhbGxDb3VudCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTIiLCJwYXJhbXMiLCJuYW1lIiwiYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwicmVxdWlyZWRQYXJhbXMiLCJhc3luY09wZXJhdGlvblBhcmFtcyIsImdldEFuZFZhbGlkYXRlUGFyYW1zIiwiZGVlcCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTMiLCJfYXN5bmNPcGVyYXRpb25NYW5hZ2U0IiwiZnJ1aXRzIiwibWFrZUNvbnN0YW50c09iamVjdCIsIkFQUExFIiwiQkFOQU5BIiwiT1JBTkdFIiwiaXNGcm96ZW4iLCJiZSIsInRydWUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQUlBLFFBQVFDLFFBQVEsTUFBUixDQUFaOztBQUVBLElBQUlDLFNBQVNDLHVCQUF1QkYsUUFBUSxPQUFSLENBQXZCLENBQWI7O0FBRUEsSUFBSUcsVUFBVUQsdUJBQXVCRixRQUFRLFdBQVIsQ0FBdkIsQ0FBZDs7QUFFQSxJQUFJSSxXQUFXSixRQUFRLFlBQVIsQ0FBZjs7QUFFQSxTQUFTRSxzQkFBVCxDQUFnQ0csR0FBaEMsRUFBcUM7QUFBRSxTQUFPQSxPQUFPQSxJQUFJQyxVQUFY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LENBQUMsT0FBRCxFQUFVLFFBQVYsQ0FBbEMsQ0FBZjtBQUNBRCxhQUFPRSxLQUFQLEdBQWUsTUFBZjtBQUNBRixhQUFPSSxNQUFQLEdBQWdCLFFBQWhCO0FBQ0EsT0FBQyxHQUFHMUMsTUFBTWtCLE1BQVYsRUFBa0JvQixPQUFPSyxRQUFQLEVBQWxCLEVBQXFDeEIsRUFBckMsQ0FBd0N5QixFQUF4QyxDQUEyQ0MsSUFBM0M7QUFDRCxLQUxEO0FBTUQsR0FyQkQ7QUFzQkQsQ0ExSEQiLCJmaWxlIjoiaGVscGVyc190ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfY2hhaSA9IHJlcXVpcmUoXCJjaGFpXCIpO1xuXG52YXIgX3Npbm9uID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwic2lub25cIikpO1xuXG52YXIgX2NvbmZpZyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uL2NvbmZpZ1wiKSk7XG5cbnZhciBfaGVscGVycyA9IHJlcXVpcmUoXCIuLi9oZWxwZXJzXCIpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG4vKiBlc2xpbnQtZW52IGplc3QgKi9cbmRlc2NyaWJlKCdoZWxwZXJzJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBfY29uZmlnLmRlZmF1bHQuc2V0Q29uZmlnKHtcbiAgICAgIGxvZ2dlcjoge1xuICAgICAgICBleGNlcHRpb25zQ2FsbGJhY2s6IF9zaW5vbi5kZWZhdWx0LnNweSgpXG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbiBhc3luY09wZXJhdGlvbiBrZXkgd2l0aCBubyBwYXJhbXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvbktleSA9ICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgndXBkYXRlUGVyc29uRGF0YScpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoYXN5bmNPcGVyYXRpb25LZXkpLnRvLmVxdWFsKCd1cGRhdGVQZXJzb25EYXRhJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW4gYXN5bmNPcGVyYXRpb24ga2V5IHdpdGggb25lIHBhcmFtJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25LZXkgPSAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoJ3VwZGF0ZVBlcnNvbkRhdGEnLCB7XG4gICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgIH0pO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoYXN5bmNPcGVyYXRpb25LZXkpLnRvLmVxdWFsKCd1cGRhdGVQZXJzb25EYXRhXzExMScpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGFuIGFzeW5jT3BlcmF0aW9uIGtleSB3aXRoIG11bHRpcGxlIHBhcmFtcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uS2V5ID0gKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCd1cGRhdGVQZXJzb25EYXRhJywge1xuICAgICAgICB0ZWFtSWQ6IDIyMixcbiAgICAgICAgcGVyc29uSWQ6IDExMVxuICAgICAgfSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShhc3luY09wZXJhdGlvbktleSkudG8uZXF1YWwoJ3VwZGF0ZVBlcnNvbkRhdGFfMjIyXzExMScpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGEgbGFiZWwgaXMgbm90IHByb3ZpZGVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgX2FzeW5jT3BlcmF0aW9uTWFuYWdlID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpLFxuICAgICAgICAgICAgbG9nZ2VyID0gX2FzeW5jT3BlcmF0aW9uTWFuYWdlLmxvZ2dlcjtcblxuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCk7XG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoJycpO1xuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKHVuZGVmaW5lZCk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxDb3VudCkudG8uZXF1YWwoMyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBleGNlcHRpb24gaWYgYSBsYWJlbCBpcyBub3QgYSBzdHJpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBfYXN5bmNPcGVyYXRpb25NYW5hZ2UyID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpLFxuICAgICAgICAgICAgbG9nZ2VyID0gX2FzeW5jT3BlcmF0aW9uTWFuYWdlMi5sb2dnZXI7XG5cbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSh7fSk7XG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoW10pO1xuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKDIpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsQ291bnQpLnRvLmVxdWFsKDMpO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2dldEFuZFZhbGlkYXRlUGFyYW1zJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgX2NvbmZpZy5kZWZhdWx0LnNldENvbmZpZyh7XG4gICAgICAgIGxvZ2dlcjoge1xuICAgICAgICAgIGV4Y2VwdGlvbnNDYWxsYmFjazogX3Npbm9uLmRlZmF1bHQuc3B5KClcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhbmQgc3VjY2Vzc2Z1bGx5IHJldHVybiBjb3JyZWN0IGFzeW5jT3BlcmF0aW9uIHBhcmFtcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgcGVyc29uSWQ6IDIsXG4gICAgICAgIHRlYW1JZDogMTAsXG4gICAgICAgIG5hbWU6ICdEYXJpZW4nXG4gICAgICB9O1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yID0ge1xuICAgICAgICByZXF1aXJlZFBhcmFtczogWydwZXJzb25JZCcsICd0ZWFtSWQnXVxuICAgICAgfTtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uUGFyYW1zID0gKDAsIF9oZWxwZXJzLmdldEFuZFZhbGlkYXRlUGFyYW1zKShwYXJhbXMsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcik7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShhc3luY09wZXJhdGlvblBhcmFtcykudG8uZGVlcC5lcXVhbCh7XG4gICAgICAgIHBlcnNvbklkOiAyLFxuICAgICAgICB0ZWFtSWQ6IDEwXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFuZCBmYWlsIG9uIGFuIHVuZGVmaW5lZCBwYXJhbScsICgpID0+IHtcbiAgICAgIGNvbnN0IF9hc3luY09wZXJhdGlvbk1hbmFnZTMgPSBfY29uZmlnLmRlZmF1bHQuZ2V0Q29uZmlnKCksXG4gICAgICAgICAgICBsb2dnZXIgPSBfYXN5bmNPcGVyYXRpb25NYW5hZ2UzLmxvZ2dlcjtcblxuICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICBwZXJzb25JZDogdW5kZWZpbmVkLFxuICAgICAgICB0ZWFtSWQ6IDEwLFxuICAgICAgICBuYW1lOiAnRGFyaWVuJ1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IHtcbiAgICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnLCAndGVhbUlkJ11cbiAgICAgIH07XG4gICAgICAoMCwgX2hlbHBlcnMuZ2V0QW5kVmFsaWRhdGVQYXJhbXMpKHBhcmFtcywgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGxvZ2dlci5leGNlcHRpb25zQ2FsbGJhY2suY2FsbGVkKS50by5lcXVhbCh0cnVlKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFuZCBmYWlsIG9uIGEgbWlzc2luZyBwYXJhbScsICgpID0+IHtcbiAgICAgIGNvbnN0IF9hc3luY09wZXJhdGlvbk1hbmFnZTQgPSBfY29uZmlnLmRlZmF1bHQuZ2V0Q29uZmlnKCksXG4gICAgICAgICAgICBsb2dnZXIgPSBfYXN5bmNPcGVyYXRpb25NYW5hZ2U0LmxvZ2dlcjtcblxuICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICBwZXJzb25JZDogMixcbiAgICAgICAgbmFtZTogJ0RhcmllbidcbiAgICAgIH07XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSB7XG4gICAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJywgJ3RlYW1JZCddXG4gICAgICB9O1xuICAgICAgKDAsIF9oZWxwZXJzLmdldEFuZFZhbGlkYXRlUGFyYW1zKShwYXJhbXMsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcik7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnbWFrZUNvbnN0YW50c09iamVjdCcsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIF9jb25maWcuZGVmYXVsdC5zZXRDb25maWcoe1xuICAgICAgICBsb2dnZXI6IHtcbiAgICAgICAgICBleGNlcHRpb25zQ2FsbGJhY2s6IF9zaW5vbi5kZWZhdWx0LnNweSgpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbWFrZSBhIGNvbnN0YW50cyBvYmplY3Qgb3V0IG9mIGFuIGFycmF5IG9mIHN0cmluZyB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmcnVpdHMgPSAoMCwgX2hlbHBlcnMubWFrZUNvbnN0YW50c09iamVjdCkoWydBUFBMRScsICdCQU5BTkEnXSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShmcnVpdHMpLnRvLmRlZXAuZXF1YWwoe1xuICAgICAgICBBUFBMRTogJ0FQUExFJyxcbiAgICAgICAgQkFOQU5BOiAnQkFOQU5BJ1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBtYWtlIGEgY29uc3RhbnRzIG9iamVjdCB0aGF0IGlzIGltbXV0YWJsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGZydWl0cyA9ICgwLCBfaGVscGVycy5tYWtlQ29uc3RhbnRzT2JqZWN0KShbJ0FQUExFJywgJ0JBTkFOQSddKTtcbiAgICAgIGZydWl0cy5BUFBMRSA9ICdQRUFSJztcbiAgICAgIGZydWl0cy5PUkFOR0UgPSAnT1JBTkdFJztcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGZydWl0cy5pc0Zyb3plbigpKS50by5iZS50cnVlO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdfQ==