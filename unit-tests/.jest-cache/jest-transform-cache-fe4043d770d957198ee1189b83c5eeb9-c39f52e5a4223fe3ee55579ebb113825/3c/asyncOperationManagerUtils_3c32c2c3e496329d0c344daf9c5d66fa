f444f5b7dbc5c1fbd360aec0a1e4efbf
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getAsyncOperationInfo = exports.getStateForOperationAfterStep = exports.getAsyncOperationDescriptor = exports.registerAsyncOperationDescriptors = exports.getAsyncOperation = exports.clearRegisteredAsyncDescriptors = exports.getRegisteredAsyncDescriptors = void 0;

var _lodash = require("lodash");

var _asyncOperationStateUtils = _interopRequireDefault(require("./asyncOperationStateUtils"));

var _config = _interopRequireDefault(require("./config"));

var _asyncOperationDescriptorRegistry = require("./asyncOperationDescriptorRegistry");

var _asyncOperationUtils = require("./asyncOperationUtils");

var _helpers = require("./helpers");

var _constants = require("./constants");

var _readStepLookup, _writeStepLookup, _transformTypeLookup;

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function _toConsumableArray(arr) {
  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();
}

function _nonIterableSpread() {
  throw new TypeError("Invalid attempt to spread non-iterable instance");
}

function _iterableToArray(iter) {
  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter);
}

function _arrayWithoutHoles(arr) {
  if (Array.isArray(arr)) {
    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {
      arr2[i] = arr[i];
    }

    return arr2;
  }
}

var getRegisteredAsyncDescriptors = _asyncOperationDescriptorRegistry.asyncOperationDescriptorRegistry.getAsyncOperationDescriptors;
exports.getRegisteredAsyncDescriptors = getRegisteredAsyncDescriptors;
var clearRegisteredAsyncDescriptors = _asyncOperationDescriptorRegistry.asyncOperationDescriptorRegistry.clearAsyncOperationDescriptors;
exports.clearRegisteredAsyncDescriptors = clearRegisteredAsyncDescriptors;

var getAsyncOperationDescriptor = function getAsyncOperationDescriptor(descriptorId) {
  var asyncOperationDescriptors = _asyncOperationDescriptorRegistry.asyncOperationDescriptorRegistry.getAsyncOperationDescriptors();

  return _asyncOperationStateUtils.default.getAsyncOperationDescriptor(asyncOperationDescriptors, descriptorId);
};

exports.getAsyncOperationDescriptor = getAsyncOperationDescriptor;

var getAsyncOperationInfo = function getAsyncOperationInfo(descriptorId, params) {
  var asyncOperationDescriptor = getAsyncOperationDescriptor(descriptorId);
  var asyncOperationParams = (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
  var asyncOperationKey = (0, _helpers.generateAsyncOperationKey)(descriptorId, asyncOperationParams);
  var otherFields = (0, _lodash.omit)(params, _toConsumableArray(asyncOperationDescriptor.requiredParams));
  return {
    asyncOperationDescriptor: asyncOperationDescriptor,
    asyncOperationParams: asyncOperationParams,
    asyncOperationKey: asyncOperationKey,
    otherFields: otherFields
  };
};

exports.getAsyncOperationInfo = getAsyncOperationInfo;

var registerAsyncOperationDescriptors = function registerAsyncOperationDescriptors(asyncOperationDescriptors) {
  var newAsyncOperationDescriptors;

  var existingAsyncOperationDescriptors = _asyncOperationDescriptorRegistry.asyncOperationDescriptorRegistry.getAsyncOperationDescriptors();

  var config = _config.default.getConfig();

  for (var _len = arguments.length, otherDescriptors = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    otherDescriptors[_key - 1] = arguments[_key];
  }

  if (!(0, _lodash.isEmpty)(otherDescriptors)) {
    config.logger.exceptionsCallback("\n      You provided more than one argument to registerAsyncOperationDescriptors.\n      You likely forgot to put multiple descriptors within an array", new Error());
  } // handle array or single object arguments


  if ((0, _lodash.isArray)(asyncOperationDescriptors)) {
    newAsyncOperationDescriptors = (0, _lodash.reduce)(asyncOperationDescriptors, function (acc, asyncOperationDescriptor) {
      return _asyncOperationStateUtils.default.updateAsyncOperationDescriptor(acc, asyncOperationDescriptor);
    }, existingAsyncOperationDescriptors);
  } else {
    newAsyncOperationDescriptors = _asyncOperationStateUtils.default.updateAsyncOperationDescriptor(existingAsyncOperationDescriptors, asyncOperationDescriptors);
  }

  _asyncOperationDescriptorRegistry.asyncOperationDescriptorRegistry.setAsyncOperationDescriptors(newAsyncOperationDescriptors);

  return newAsyncOperationDescriptors;
}; // TODO: heavy unit testing needed!


exports.registerAsyncOperationDescriptors = registerAsyncOperationDescriptors;

var getAsyncOperation = function getAsyncOperation(state, descriptorId, params, otherFields) {
  var _getAsyncOperationInf = getAsyncOperationInfo(descriptorId, params),
      asyncOperationDescriptor = _getAsyncOperationInf.asyncOperationDescriptor,
      asyncOperationParams = _getAsyncOperationInf.asyncOperationParams,
      asyncOperationKey = _getAsyncOperationInf.asyncOperationKey;

  var registeredAsyncOperationDescriptors = getRegisteredAsyncDescriptors();
  return _asyncOperationStateUtils.default.getAsyncOperation(state, registeredAsyncOperationDescriptors, asyncOperationKey, asyncOperationDescriptor, asyncOperationParams, otherFields);
}; // switchboard for resolving the Read operation steps


exports.getAsyncOperation = getAsyncOperation;
var readStepLookup = (_readStepLookup = {}, _defineProperty(_readStepLookup, _constants.ASYNC_OPERATION_STEPS.BEGIN_ASYNC_OPERATION, function (asyncOperation, asyncOperationParams, otherFields) {
  return (0, _asyncOperationUtils.beginReadAsyncOperation)(asyncOperation, asyncOperationParams, otherFields);
}), _defineProperty(_readStepLookup, _constants.ASYNC_OPERATION_STEPS.RESOLVE_ASYNC_OPERATION, function (asyncOperation, asyncOperationParams, otherFields) {
  return (0, _asyncOperationUtils.resolveReadAsyncOperation)(asyncOperation, asyncOperationParams, otherFields);
}), _defineProperty(_readStepLookup, _constants.ASYNC_OPERATION_STEPS.REJECT_ASYNC_OPERATION, function (asyncOperation, asyncOperationParams, otherFields) {
  return (0, _asyncOperationUtils.rejectReadAsyncOperation)(asyncOperation, asyncOperationParams, otherFields);
}), _readStepLookup); // switchboard for resolving Write operation steps

var writeStepLookup = (_writeStepLookup = {}, _defineProperty(_writeStepLookup, _constants.ASYNC_OPERATION_STEPS.BEGIN_ASYNC_OPERATION, function (asyncOperation, asyncOperationParams, otherFields) {
  return (0, _asyncOperationUtils.beginWriteAsyncOperation)(asyncOperation, asyncOperationParams, otherFields);
}), _defineProperty(_writeStepLookup, _constants.ASYNC_OPERATION_STEPS.RESOLVE_ASYNC_OPERATION, function (asyncOperation, asyncOperationParams, otherFields) {
  return (0, _asyncOperationUtils.resolveWriteAsyncOperation)(asyncOperation, asyncOperationParams, otherFields);
}), _defineProperty(_writeStepLookup, _constants.ASYNC_OPERATION_STEPS.REJECT_ASYNC_OPERATION, function (asyncOperation, asyncOperationParams, otherFields) {
  return (0, _asyncOperationUtils.rejectWriteAsyncOperation)(asyncOperation, asyncOperationParams, otherFields);
}), _writeStepLookup); // first switchboard to transform an async operation

var transformTypeLookup = (_transformTypeLookup = {}, _defineProperty(_transformTypeLookup, _constants.ASYNC_OPERATION_TYPES.READ, function (asyncOperation, asyncOperationStep, asyncOperationParams, otherFields) {
  return readStepLookup[asyncOperationStep](asyncOperation, asyncOperationParams, otherFields);
}), _defineProperty(_transformTypeLookup, _constants.ASYNC_OPERATION_TYPES.WRITE, function (asyncOperation, asyncOperationStep, asyncOperationParams, otherFields) {
  return writeStepLookup[asyncOperationStep](asyncOperation, asyncOperationParams, otherFields);
}), _transformTypeLookup); // this function is called in the reducer (in redux integration)

var getStateForOperationAfterStep = function getStateForOperationAfterStep(state, asyncOperationStep, descriptorId, params) {
  var newState = state;

  var _getAsyncOperationInf2 = getAsyncOperationInfo(descriptorId, params),
      asyncOperationDescriptor = _getAsyncOperationInf2.asyncOperationDescriptor,
      asyncOperationParams = _getAsyncOperationInf2.asyncOperationParams,
      asyncOperationKey = _getAsyncOperationInf2.asyncOperationKey,
      otherFields = _getAsyncOperationInf2.otherFields;

  var asyncOperationToTranform = getAsyncOperation(state, descriptorId, asyncOperationParams, otherFields);
  var newAsyncOperation = transformTypeLookup[asyncOperationDescriptor.operationType](asyncOperationToTranform, asyncOperationStep, asyncOperationParams, otherFields);
  newState = _asyncOperationStateUtils.default.updateAsyncOperation(state, asyncOperationKey, newAsyncOperation, asyncOperationDescriptor);
  return newState;
};

exports.getStateForOperationAfterStep = getStateForOperationAfterStep;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jT3BlcmF0aW9uTWFuYWdlclV0aWxzLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZ2V0QXN5bmNPcGVyYXRpb25JbmZvIiwiZ2V0U3RhdGVGb3JPcGVyYXRpb25BZnRlclN0ZXAiLCJnZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IiLCJyZWdpc3RlckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMiLCJnZXRBc3luY09wZXJhdGlvbiIsImNsZWFyUmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMiLCJnZXRSZWdpc3RlcmVkQXN5bmNEZXNjcmlwdG9ycyIsIl9sb2Rhc2giLCJyZXF1aXJlIiwiX2FzeW5jT3BlcmF0aW9uU3RhdGVVdGlscyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfY29uZmlnIiwiX2FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5IiwiX2FzeW5jT3BlcmF0aW9uVXRpbHMiLCJfaGVscGVycyIsIl9jb25zdGFudHMiLCJfcmVhZFN0ZXBMb29rdXAiLCJfd3JpdGVTdGVwTG9va3VwIiwiX3RyYW5zZm9ybVR5cGVMb29rdXAiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9kZWZpbmVQcm9wZXJ0eSIsImtleSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIl90b0NvbnN1bWFibGVBcnJheSIsImFyciIsIl9hcnJheVdpdGhvdXRIb2xlcyIsIl9pdGVyYWJsZVRvQXJyYXkiLCJfbm9uSXRlcmFibGVTcHJlYWQiLCJUeXBlRXJyb3IiLCJpdGVyIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJwcm90b3R5cGUiLCJ0b1N0cmluZyIsImNhbGwiLCJBcnJheSIsImZyb20iLCJpc0FycmF5IiwiaSIsImFycjIiLCJsZW5ndGgiLCJhc3luY09wZXJhdGlvbkRlc2NyaXB0b3JSZWdpc3RyeSIsImdldEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMiLCJjbGVhckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMiLCJkZXNjcmlwdG9ySWQiLCJhc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzIiwicGFyYW1zIiwiYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwiYXN5bmNPcGVyYXRpb25QYXJhbXMiLCJnZXRBbmRWYWxpZGF0ZVBhcmFtcyIsImFzeW5jT3BlcmF0aW9uS2V5IiwiZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSIsIm90aGVyRmllbGRzIiwib21pdCIsInJlcXVpcmVkUGFyYW1zIiwibmV3QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyIsImV4aXN0aW5nQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyIsImNvbmZpZyIsImdldENvbmZpZyIsIl9sZW4iLCJhcmd1bWVudHMiLCJvdGhlckRlc2NyaXB0b3JzIiwiX2tleSIsImlzRW1wdHkiLCJsb2dnZXIiLCJleGNlcHRpb25zQ2FsbGJhY2siLCJFcnJvciIsInJlZHVjZSIsImFjYyIsInVwZGF0ZUFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciIsInNldEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMiLCJzdGF0ZSIsIl9nZXRBc3luY09wZXJhdGlvbkluZiIsInJlZ2lzdGVyZWRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzIiwicmVhZFN0ZXBMb29rdXAiLCJBU1lOQ19PUEVSQVRJT05fU1RFUFMiLCJCRUdJTl9BU1lOQ19PUEVSQVRJT04iLCJhc3luY09wZXJhdGlvbiIsImJlZ2luUmVhZEFzeW5jT3BlcmF0aW9uIiwiUkVTT0xWRV9BU1lOQ19PUEVSQVRJT04iLCJyZXNvbHZlUmVhZEFzeW5jT3BlcmF0aW9uIiwiUkVKRUNUX0FTWU5DX09QRVJBVElPTiIsInJlamVjdFJlYWRBc3luY09wZXJhdGlvbiIsIndyaXRlU3RlcExvb2t1cCIsImJlZ2luV3JpdGVBc3luY09wZXJhdGlvbiIsInJlc29sdmVXcml0ZUFzeW5jT3BlcmF0aW9uIiwicmVqZWN0V3JpdGVBc3luY09wZXJhdGlvbiIsInRyYW5zZm9ybVR5cGVMb29rdXAiLCJBU1lOQ19PUEVSQVRJT05fVFlQRVMiLCJSRUFEIiwiYXN5bmNPcGVyYXRpb25TdGVwIiwiV1JJVEUiLCJuZXdTdGF0ZSIsIl9nZXRBc3luY09wZXJhdGlvbkluZjIiLCJhc3luY09wZXJhdGlvblRvVHJhbmZvcm0iLCJuZXdBc3luY09wZXJhdGlvbiIsIm9wZXJhdGlvblR5cGUiLCJ1cGRhdGVBc3luY09wZXJhdGlvbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLHFCQUFSLEdBQWdDRixPQUFPLENBQUNHLDZCQUFSLEdBQXdDSCxPQUFPLENBQUNJLDJCQUFSLEdBQXNDSixPQUFPLENBQUNLLGlDQUFSLEdBQTRDTCxPQUFPLENBQUNNLGlCQUFSLEdBQTRCTixPQUFPLENBQUNPLCtCQUFSLEdBQTBDUCxPQUFPLENBQUNRLDZCQUFSLEdBQXdDLEtBQUssQ0FBN1E7O0FBRUEsSUFBSUMsT0FBTyxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFyQjs7QUFFQSxJQUFJQyx5QkFBeUIsR0FBR0Msc0JBQXNCLENBQUNGLE9BQU8sQ0FBQyw0QkFBRCxDQUFSLENBQXREOztBQUVBLElBQUlHLE9BQU8sR0FBR0Qsc0JBQXNCLENBQUNGLE9BQU8sQ0FBQyxVQUFELENBQVIsQ0FBcEM7O0FBRUEsSUFBSUksaUNBQWlDLEdBQUdKLE9BQU8sQ0FBQyxvQ0FBRCxDQUEvQzs7QUFFQSxJQUFJSyxvQkFBb0IsR0FBR0wsT0FBTyxDQUFDLHVCQUFELENBQWxDOztBQUVBLElBQUlNLFFBQVEsR0FBR04sT0FBTyxDQUFDLFdBQUQsQ0FBdEI7O0FBRUEsSUFBSU8sVUFBVSxHQUFHUCxPQUFPLENBQUMsYUFBRCxDQUF4Qjs7QUFFQSxJQUFJUSxlQUFKLEVBQXFCQyxnQkFBckIsRUFBdUNDLG9CQUF2Qzs7QUFFQSxTQUFTUixz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QixHQUFHMkMsc0JBQXNCLENBQUMzQyxpQkFIL0M7QUFBQSxNQUlJRSxXQUFXLEdBQUd5QyxzQkFBc0IsQ0FBQ3pDLFdBSnpDOztBQU1BLE1BQUkwQyx3QkFBd0IsR0FBRzlGLGlCQUFpQixDQUFDdUUsS0FBRCxFQUFRM0IsWUFBUixFQUFzQkksb0JBQXRCLEVBQTRDSSxXQUE1QyxDQUFoRDtBQUNBLE1BQUkyQyxpQkFBaUIsR0FBR1IsbUJBQW1CLENBQUN4Qyx3QkFBd0IsQ0FBQ2lELGFBQTFCLENBQW5CLENBQTRERix3QkFBNUQsRUFBc0ZKLGtCQUF0RixFQUEwRzFDLG9CQUExRyxFQUFnSUksV0FBaEksQ0FBeEI7QUFDQXdDLEVBQUFBLFFBQVEsR0FBR3ZGLHlCQUF5QixDQUFDWSxPQUExQixDQUFrQ2dGLG9CQUFsQyxDQUF1RDFCLEtBQXZELEVBQThEckIsaUJBQTlELEVBQWlGNkMsaUJBQWpGLEVBQW9HaEQsd0JBQXBHLENBQVg7QUFDQSxTQUFPNkMsUUFBUDtBQUNELENBYkQ7O0FBZUFsRyxPQUFPLENBQUNHLDZCQUFSLEdBQXdDQSw2QkFBeEMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZ2V0QXN5bmNPcGVyYXRpb25JbmZvID0gZXhwb3J0cy5nZXRTdGF0ZUZvck9wZXJhdGlvbkFmdGVyU3RlcCA9IGV4cG9ydHMuZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yID0gZXhwb3J0cy5yZWdpc3RlckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMgPSBleHBvcnRzLmdldEFzeW5jT3BlcmF0aW9uID0gZXhwb3J0cy5jbGVhclJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzID0gZXhwb3J0cy5nZXRSZWdpc3RlcmVkQXN5bmNEZXNjcmlwdG9ycyA9IHZvaWQgMDtcblxudmFyIF9sb2Rhc2ggPSByZXF1aXJlKFwibG9kYXNoXCIpO1xuXG52YXIgX2FzeW5jT3BlcmF0aW9uU3RhdGVVdGlscyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vYXN5bmNPcGVyYXRpb25TdGF0ZVV0aWxzXCIpKTtcblxudmFyIF9jb25maWcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL2NvbmZpZ1wiKSk7XG5cbnZhciBfYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yUmVnaXN0cnkgPSByZXF1aXJlKFwiLi9hc3luY09wZXJhdGlvbkRlc2NyaXB0b3JSZWdpc3RyeVwiKTtcblxudmFyIF9hc3luY09wZXJhdGlvblV0aWxzID0gcmVxdWlyZShcIi4vYXN5bmNPcGVyYXRpb25VdGlsc1wiKTtcblxudmFyIF9oZWxwZXJzID0gcmVxdWlyZShcIi4vaGVscGVyc1wiKTtcblxudmFyIF9jb25zdGFudHMgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XG5cbnZhciBfcmVhZFN0ZXBMb29rdXAsIF93cml0ZVN0ZXBMb29rdXAsIF90cmFuc2Zvcm1UeXBlTG9va3VwO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfVxuXG5mdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH1cblxuZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2VcIik7IH1cblxuZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gXCJbb2JqZWN0IEFyZ3VtZW50c11cIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7IH1cblxuZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfVxuXG52YXIgZ2V0UmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMgPSBfYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yUmVnaXN0cnkuYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yUmVnaXN0cnkuZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycztcbmV4cG9ydHMuZ2V0UmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnMgPSBnZXRSZWdpc3RlcmVkQXN5bmNEZXNjcmlwdG9ycztcbnZhciBjbGVhclJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzID0gX2FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5LmFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5LmNsZWFyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycztcbmV4cG9ydHMuY2xlYXJSZWdpc3RlcmVkQXN5bmNEZXNjcmlwdG9ycyA9IGNsZWFyUmVnaXN0ZXJlZEFzeW5jRGVzY3JpcHRvcnM7XG5cbnZhciBnZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSBmdW5jdGlvbiBnZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IoZGVzY3JpcHRvcklkKSB7XG4gIHZhciBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzID0gX2FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5LmFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5LmdldEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMoKTtcblxuICByZXR1cm4gX2FzeW5jT3BlcmF0aW9uU3RhdGVVdGlscy5kZWZhdWx0LmdldEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcihhc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzLCBkZXNjcmlwdG9ySWQpO1xufTtcblxuZXhwb3J0cy5nZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSBnZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3I7XG5cbnZhciBnZXRBc3luY09wZXJhdGlvbkluZm8gPSBmdW5jdGlvbiBnZXRBc3luY09wZXJhdGlvbkluZm8oZGVzY3JpcHRvcklkLCBwYXJhbXMpIHtcbiAgdmFyIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IGdldEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcihkZXNjcmlwdG9ySWQpO1xuICB2YXIgYXN5bmNPcGVyYXRpb25QYXJhbXMgPSAoMCwgX2hlbHBlcnMuZ2V0QW5kVmFsaWRhdGVQYXJhbXMpKHBhcmFtcywgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKTtcbiAgdmFyIGFzeW5jT3BlcmF0aW9uS2V5ID0gKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKGRlc2NyaXB0b3JJZCwgYXN5bmNPcGVyYXRpb25QYXJhbXMpO1xuICB2YXIgb3RoZXJGaWVsZHMgPSAoMCwgX2xvZGFzaC5vbWl0KShwYXJhbXMsIF90b0NvbnN1bWFibGVBcnJheShhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IucmVxdWlyZWRQYXJhbXMpKTtcbiAgcmV0dXJuIHtcbiAgICBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3I6IGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcixcbiAgICBhc3luY09wZXJhdGlvblBhcmFtczogYXN5bmNPcGVyYXRpb25QYXJhbXMsXG4gICAgYXN5bmNPcGVyYXRpb25LZXk6IGFzeW5jT3BlcmF0aW9uS2V5LFxuICAgIG90aGVyRmllbGRzOiBvdGhlckZpZWxkc1xuICB9O1xufTtcblxuZXhwb3J0cy5nZXRBc3luY09wZXJhdGlvbkluZm8gPSBnZXRBc3luY09wZXJhdGlvbkluZm87XG5cbnZhciByZWdpc3RlckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMgPSBmdW5jdGlvbiByZWdpc3RlckFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMoYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycykge1xuICB2YXIgbmV3QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycztcblxuICB2YXIgZXhpc3RpbmdBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzID0gX2FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5LmFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclJlZ2lzdHJ5LmdldEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMoKTtcblxuICB2YXIgY29uZmlnID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpO1xuXG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBvdGhlckRlc2NyaXB0b3JzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBvdGhlckRlc2NyaXB0b3JzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIGlmICghKDAsIF9sb2Rhc2guaXNFbXB0eSkob3RoZXJEZXNjcmlwdG9ycykpIHtcbiAgICBjb25maWcubG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjayhcIlxcbiAgICAgIFlvdSBwcm92aWRlZCBtb3JlIHRoYW4gb25lIGFyZ3VtZW50IHRvIHJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycy5cXG4gICAgICBZb3UgbGlrZWx5IGZvcmdvdCB0byBwdXQgbXVsdGlwbGUgZGVzY3JpcHRvcnMgd2l0aGluIGFuIGFycmF5XCIsIG5ldyBFcnJvcigpKTtcbiAgfSAvLyBoYW5kbGUgYXJyYXkgb3Igc2luZ2xlIG9iamVjdCBhcmd1bWVudHNcblxuXG4gIGlmICgoMCwgX2xvZGFzaC5pc0FycmF5KShhc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKSkge1xuICAgIG5ld0FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMgPSAoMCwgX2xvZGFzaC5yZWR1Y2UpKGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMsIGZ1bmN0aW9uIChhY2MsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcikge1xuICAgICAgcmV0dXJuIF9hc3luY09wZXJhdGlvblN0YXRlVXRpbHMuZGVmYXVsdC51cGRhdGVBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IoYWNjLCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpO1xuICAgIH0sIGV4aXN0aW5nQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyk7XG4gIH0gZWxzZSB7XG4gICAgbmV3QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyA9IF9hc3luY09wZXJhdGlvblN0YXRlVXRpbHMuZGVmYXVsdC51cGRhdGVBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IoZXhpc3RpbmdBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzLCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKTtcbiAgfVxuXG4gIF9hc3luY09wZXJhdGlvbkRlc2NyaXB0b3JSZWdpc3RyeS5hc3luY09wZXJhdGlvbkRlc2NyaXB0b3JSZWdpc3RyeS5zZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzKG5ld0FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMpO1xuXG4gIHJldHVybiBuZXdBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzO1xufTsgLy8gVE9ETzogaGVhdnkgdW5pdCB0ZXN0aW5nIG5lZWRlZCFcblxuXG5leHBvcnRzLnJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyA9IHJlZ2lzdGVyQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycztcblxudmFyIGdldEFzeW5jT3BlcmF0aW9uID0gZnVuY3Rpb24gZ2V0QXN5bmNPcGVyYXRpb24oc3RhdGUsIGRlc2NyaXB0b3JJZCwgcGFyYW1zLCBvdGhlckZpZWxkcykge1xuICB2YXIgX2dldEFzeW5jT3BlcmF0aW9uSW5mID0gZ2V0QXN5bmNPcGVyYXRpb25JbmZvKGRlc2NyaXB0b3JJZCwgcGFyYW1zKSxcbiAgICAgIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IF9nZXRBc3luY09wZXJhdGlvbkluZi5hc3luY09wZXJhdGlvbkRlc2NyaXB0b3IsXG4gICAgICBhc3luY09wZXJhdGlvblBhcmFtcyA9IF9nZXRBc3luY09wZXJhdGlvbkluZi5hc3luY09wZXJhdGlvblBhcmFtcyxcbiAgICAgIGFzeW5jT3BlcmF0aW9uS2V5ID0gX2dldEFzeW5jT3BlcmF0aW9uSW5mLmFzeW5jT3BlcmF0aW9uS2V5O1xuXG4gIHZhciByZWdpc3RlcmVkQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyA9IGdldFJlZ2lzdGVyZWRBc3luY0Rlc2NyaXB0b3JzKCk7XG4gIHJldHVybiBfYXN5bmNPcGVyYXRpb25TdGF0ZVV0aWxzLmRlZmF1bHQuZ2V0QXN5bmNPcGVyYXRpb24oc3RhdGUsIHJlZ2lzdGVyZWRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzLCBhc3luY09wZXJhdGlvbktleSwgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpO1xufTsgLy8gc3dpdGNoYm9hcmQgZm9yIHJlc29sdmluZyB0aGUgUmVhZCBvcGVyYXRpb24gc3RlcHNcblxuXG5leHBvcnRzLmdldEFzeW5jT3BlcmF0aW9uID0gZ2V0QXN5bmNPcGVyYXRpb247XG52YXIgcmVhZFN0ZXBMb29rdXAgPSAoX3JlYWRTdGVwTG9va3VwID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfcmVhZFN0ZXBMb29rdXAsIF9jb25zdGFudHMuQVNZTkNfT1BFUkFUSU9OX1NURVBTLkJFR0lOX0FTWU5DX09QRVJBVElPTiwgZnVuY3Rpb24gKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpIHtcbiAgcmV0dXJuICgwLCBfYXN5bmNPcGVyYXRpb25VdGlscy5iZWdpblJlYWRBc3luY09wZXJhdGlvbikoYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcyk7XG59KSwgX2RlZmluZVByb3BlcnR5KF9yZWFkU3RlcExvb2t1cCwgX2NvbnN0YW50cy5BU1lOQ19PUEVSQVRJT05fU1RFUFMuUkVTT0xWRV9BU1lOQ19PUEVSQVRJT04sIGZ1bmN0aW9uIChhc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25QYXJhbXMsIG90aGVyRmllbGRzKSB7XG4gIHJldHVybiAoMCwgX2FzeW5jT3BlcmF0aW9uVXRpbHMucmVzb2x2ZVJlYWRBc3luY09wZXJhdGlvbikoYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcyk7XG59KSwgX2RlZmluZVByb3BlcnR5KF9yZWFkU3RlcExvb2t1cCwgX2NvbnN0YW50cy5BU1lOQ19PUEVSQVRJT05fU1RFUFMuUkVKRUNUX0FTWU5DX09QRVJBVElPTiwgZnVuY3Rpb24gKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpIHtcbiAgcmV0dXJuICgwLCBfYXN5bmNPcGVyYXRpb25VdGlscy5yZWplY3RSZWFkQXN5bmNPcGVyYXRpb24pKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpO1xufSksIF9yZWFkU3RlcExvb2t1cCk7IC8vIHN3aXRjaGJvYXJkIGZvciByZXNvbHZpbmcgV3JpdGUgb3BlcmF0aW9uIHN0ZXBzXG5cbnZhciB3cml0ZVN0ZXBMb29rdXAgPSAoX3dyaXRlU3RlcExvb2t1cCA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX3dyaXRlU3RlcExvb2t1cCwgX2NvbnN0YW50cy5BU1lOQ19PUEVSQVRJT05fU1RFUFMuQkVHSU5fQVNZTkNfT1BFUkFUSU9OLCBmdW5jdGlvbiAoYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcykge1xuICByZXR1cm4gKDAsIF9hc3luY09wZXJhdGlvblV0aWxzLmJlZ2luV3JpdGVBc3luY09wZXJhdGlvbikoYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcyk7XG59KSwgX2RlZmluZVByb3BlcnR5KF93cml0ZVN0ZXBMb29rdXAsIF9jb25zdGFudHMuQVNZTkNfT1BFUkFUSU9OX1NURVBTLlJFU09MVkVfQVNZTkNfT1BFUkFUSU9OLCBmdW5jdGlvbiAoYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcykge1xuICByZXR1cm4gKDAsIF9hc3luY09wZXJhdGlvblV0aWxzLnJlc29sdmVXcml0ZUFzeW5jT3BlcmF0aW9uKShhc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25QYXJhbXMsIG90aGVyRmllbGRzKTtcbn0pLCBfZGVmaW5lUHJvcGVydHkoX3dyaXRlU3RlcExvb2t1cCwgX2NvbnN0YW50cy5BU1lOQ19PUEVSQVRJT05fU1RFUFMuUkVKRUNUX0FTWU5DX09QRVJBVElPTiwgZnVuY3Rpb24gKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpIHtcbiAgcmV0dXJuICgwLCBfYXN5bmNPcGVyYXRpb25VdGlscy5yZWplY3RXcml0ZUFzeW5jT3BlcmF0aW9uKShhc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25QYXJhbXMsIG90aGVyRmllbGRzKTtcbn0pLCBfd3JpdGVTdGVwTG9va3VwKTsgLy8gZmlyc3Qgc3dpdGNoYm9hcmQgdG8gdHJhbnNmb3JtIGFuIGFzeW5jIG9wZXJhdGlvblxuXG52YXIgdHJhbnNmb3JtVHlwZUxvb2t1cCA9IChfdHJhbnNmb3JtVHlwZUxvb2t1cCA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX3RyYW5zZm9ybVR5cGVMb29rdXAsIF9jb25zdGFudHMuQVNZTkNfT1BFUkFUSU9OX1RZUEVTLlJFQUQsIGZ1bmN0aW9uIChhc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25TdGVwLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpIHtcbiAgcmV0dXJuIHJlYWRTdGVwTG9va3VwW2FzeW5jT3BlcmF0aW9uU3RlcF0oYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcyk7XG59KSwgX2RlZmluZVByb3BlcnR5KF90cmFuc2Zvcm1UeXBlTG9va3VwLCBfY29uc3RhbnRzLkFTWU5DX09QRVJBVElPTl9UWVBFUy5XUklURSwgZnVuY3Rpb24gKGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvblN0ZXAsIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcykge1xuICByZXR1cm4gd3JpdGVTdGVwTG9va3VwW2FzeW5jT3BlcmF0aW9uU3RlcF0oYXN5bmNPcGVyYXRpb24sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBvdGhlckZpZWxkcyk7XG59KSwgX3RyYW5zZm9ybVR5cGVMb29rdXApOyAvLyB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBpbiB0aGUgcmVkdWNlciAoaW4gcmVkdXggaW50ZWdyYXRpb24pXG5cbnZhciBnZXRTdGF0ZUZvck9wZXJhdGlvbkFmdGVyU3RlcCA9IGZ1bmN0aW9uIGdldFN0YXRlRm9yT3BlcmF0aW9uQWZ0ZXJTdGVwKHN0YXRlLCBhc3luY09wZXJhdGlvblN0ZXAsIGRlc2NyaXB0b3JJZCwgcGFyYW1zKSB7XG4gIHZhciBuZXdTdGF0ZSA9IHN0YXRlO1xuXG4gIHZhciBfZ2V0QXN5bmNPcGVyYXRpb25JbmYyID0gZ2V0QXN5bmNPcGVyYXRpb25JbmZvKGRlc2NyaXB0b3JJZCwgcGFyYW1zKSxcbiAgICAgIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IF9nZXRBc3luY09wZXJhdGlvbkluZjIuYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yLFxuICAgICAgYXN5bmNPcGVyYXRpb25QYXJhbXMgPSBfZ2V0QXN5bmNPcGVyYXRpb25JbmYyLmFzeW5jT3BlcmF0aW9uUGFyYW1zLFxuICAgICAgYXN5bmNPcGVyYXRpb25LZXkgPSBfZ2V0QXN5bmNPcGVyYXRpb25JbmYyLmFzeW5jT3BlcmF0aW9uS2V5LFxuICAgICAgb3RoZXJGaWVsZHMgPSBfZ2V0QXN5bmNPcGVyYXRpb25JbmYyLm90aGVyRmllbGRzO1xuXG4gIHZhciBhc3luY09wZXJhdGlvblRvVHJhbmZvcm0gPSBnZXRBc3luY09wZXJhdGlvbihzdGF0ZSwgZGVzY3JpcHRvcklkLCBhc3luY09wZXJhdGlvblBhcmFtcywgb3RoZXJGaWVsZHMpO1xuICB2YXIgbmV3QXN5bmNPcGVyYXRpb24gPSB0cmFuc2Zvcm1UeXBlTG9va3VwW2FzeW5jT3BlcmF0aW9uRGVzY3JpcHRvci5vcGVyYXRpb25UeXBlXShhc3luY09wZXJhdGlvblRvVHJhbmZvcm0sIGFzeW5jT3BlcmF0aW9uU3RlcCwgYXN5bmNPcGVyYXRpb25QYXJhbXMsIG90aGVyRmllbGRzKTtcbiAgbmV3U3RhdGUgPSBfYXN5bmNPcGVyYXRpb25TdGF0ZVV0aWxzLmRlZmF1bHQudXBkYXRlQXN5bmNPcGVyYXRpb24oc3RhdGUsIGFzeW5jT3BlcmF0aW9uS2V5LCBuZXdBc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKTtcbiAgcmV0dXJuIG5ld1N0YXRlO1xufTtcblxuZXhwb3J0cy5nZXRTdGF0ZUZvck9wZXJhdGlvbkFmdGVyU3RlcCA9IGdldFN0YXRlRm9yT3BlcmF0aW9uQWZ0ZXJTdGVwOyJdfQ==