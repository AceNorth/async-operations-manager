f69a46b50391b9abfdaa59a1a2d53638
"use strict";

var _chai = require("chai");

var _sinon = _interopRequireDefault(require("sinon"));

var _config = _interopRequireDefault(require("../config"));

var _helpers = require("../helpers");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/* eslint-env jest */
describe('helpers', () => {
  beforeEach(() => {
    _config.default.setConfig({
      logger: {
        exceptionsCallback: _sinon.default.spy()
      }
    });
  });
  describe('generateAsyncOperationKey', () => {
    it('should create an asyncOperation key with no params', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData');
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData');
    });
    it('should create an asyncOperation key with one param', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_111');
    });
    it('should create an asyncOperation key with multiple params', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        teamId: 222,
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_222_111');
    });
    it('should throw an exception if a label is not provided', () => {
      const _asyncOperationManage = _config.default.getConfig(),
            logger = _asyncOperationManage.logger;

      (0, _helpers.generateAsyncOperationKey)();
      (0, _helpers.generateAsyncOperationKey)('');
      (0, _helpers.generateAsyncOperationKey)(undefined);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
    it('should throw an exception if a label is not a string', () => {
      const _asyncOperationManage2 = _config.default.getConfig(),
            logger = _asyncOperationManage2.logger;

      (0, _helpers.generateAsyncOperationKey)({});
      (0, _helpers.generateAsyncOperationKey)([]);
      (0, _helpers.generateAsyncOperationKey)(2);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
  });
  describe('getAndValidateParams', () => {
    beforeEach(() => {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should validate and successfully return correct asyncOperation params', () => {
      const params = {
        personId: 2,
        teamId: 10,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      const asyncOperationParams = (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(asyncOperationParams).to.deep.equal({
        personId: 2,
        teamId: 10
      });
    });
    it('should validate and fail on an undefined param', () => {
      const _asyncOperationManage3 = _config.default.getConfig(),
            logger = _asyncOperationManage3.logger;

      const params = {
        personId: undefined,
        teamId: 10,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
    it('should validate and fail on a missing param', () => {
      const _asyncOperationManage4 = _config.default.getConfig(),
            logger = _asyncOperationManage4.logger;

      const params = {
        personId: 2,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
  });
  describe('makeConstantsObject', () => {
    beforeEach(() => {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should make a constants object out of an array of string values', () => {
      const fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(fruits).to.deep.equal({
        APPLE: 'APPLE',
        BANANA: 'BANANA'
      });
    });
    it('should make a constants object that is immutable', () => {
      const fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(fruits.isExtensible()).to.be.true;
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlcnNfdGVzdC5qcyJdLCJuYW1lcyI6WyJfY2hhaSIsInJlcXVpcmUiLCJfc2lub24iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2NvbmZpZyIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJzZXRDb25maWciLCJsb2dnZXIiLCJleGNlcHRpb25zQ2FsbGJhY2siLCJzcHkiLCJpdCIsImFzeW5jT3BlcmF0aW9uS2V5IiwiZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSIsImV4cGVjdCIsInRvIiwiZXF1YWwiLCJwZXJzb25JZCIsInRlYW1JZCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZSIsImdldENvbmZpZyIsInVuZGVmaW5lZCIsImNhbGxlZCIsImNhbGxDb3VudCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTIiLCJwYXJhbXMiLCJuYW1lIiwiYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwicmVxdWlyZWRQYXJhbXMiLCJhc3luY09wZXJhdGlvblBhcmFtcyIsImdldEFuZFZhbGlkYXRlUGFyYW1zIiwiZGVlcCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTMiLCJfYXN5bmNPcGVyYXRpb25NYW5hZ2U0IiwiZnJ1aXRzIiwibWFrZUNvbnN0YW50c09iamVjdCIsIkFQUExFIiwiQkFOQU5BIiwiaXNFeHRlbnNpYmxlIiwiYmUiLCJ0cnVlIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFJQSxRQUFRQyxRQUFRLE1BQVIsQ0FBWjs7QUFFQSxJQUFJQyxTQUFTQyx1QkFBdUJGLFFBQVEsT0FBUixDQUF2QixDQUFiOztBQUVBLElBQUlHLFVBQVVELHVCQUF1QkYsUUFBUSxXQUFSLENBQXZCLENBQWQ7O0FBRUEsSUFBSUksV0FBV0osUUFBUSxZQUFSLENBQWY7O0FBRUEsU0FBU0Usc0JBQVQsQ0FBZ0NHLEdBQWhDLEVBQXFDO0FBQUUsU0FBT0EsT0FBT0EsSUFBSUMsVUFBWCxHQUF3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LE9BQUQsRUFBVSxRQUFWLENBQWxDLENBQWY7QUFDQSxPQUFDLEdBQUd2QyxNQUFNa0IsTUFBVixFQUFrQm9CLE9BQU9JLFlBQVAsRUFBbEIsRUFBeUN2QixFQUF6QyxDQUE0Q3dCLEVBQTVDLENBQStDQyxJQUEvQztBQUNELEtBSEQ7QUFJRCxHQW5CRDtBQW9CRCxDQXhIRCIsImZpbGUiOiJoZWxwZXJzX3Rlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxudmFyIF9jaGFpID0gcmVxdWlyZShcImNoYWlcIik7XG5cbnZhciBfc2lub24gPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJzaW5vblwiKSk7XG5cbnZhciBfY29uZmlnID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vY29uZmlnXCIpKTtcblxudmFyIF9oZWxwZXJzID0gcmVxdWlyZShcIi4uL2hlbHBlcnNcIik7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbi8qIGVzbGludC1lbnYgamVzdCAqL1xuZGVzY3JpYmUoJ2hlbHBlcnMnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIF9jb25maWcuZGVmYXVsdC5zZXRDb25maWcoe1xuICAgICAgbG9nZ2VyOiB7XG4gICAgICAgIGV4Y2VwdGlvbnNDYWxsYmFjazogX3Npbm9uLmRlZmF1bHQuc3B5KClcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdnZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGFuIGFzeW5jT3BlcmF0aW9uIGtleSB3aXRoIG5vIHBhcmFtcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uS2V5ID0gKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCd1cGRhdGVQZXJzb25EYXRhJyk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShhc3luY09wZXJhdGlvbktleSkudG8uZXF1YWwoJ3VwZGF0ZVBlcnNvbkRhdGEnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbiBhc3luY09wZXJhdGlvbiBrZXkgd2l0aCBvbmUgcGFyYW0nLCAoKSA9PiB7XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvbktleSA9ICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgndXBkYXRlUGVyc29uRGF0YScsIHtcbiAgICAgICAgcGVyc29uSWQ6IDExMVxuICAgICAgfSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShhc3luY09wZXJhdGlvbktleSkudG8uZXF1YWwoJ3VwZGF0ZVBlcnNvbkRhdGFfMTExJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW4gYXN5bmNPcGVyYXRpb24ga2V5IHdpdGggbXVsdGlwbGUgcGFyYW1zJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25LZXkgPSAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoJ3VwZGF0ZVBlcnNvbkRhdGEnLCB7XG4gICAgICAgIHRlYW1JZDogMjIyLFxuICAgICAgICBwZXJzb25JZDogMTExXG4gICAgICB9KTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGFzeW5jT3BlcmF0aW9uS2V5KS50by5lcXVhbCgndXBkYXRlUGVyc29uRGF0YV8yMjJfMTExJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBleGNlcHRpb24gaWYgYSBsYWJlbCBpcyBub3QgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBfYXN5bmNPcGVyYXRpb25NYW5hZ2UgPSBfY29uZmlnLmRlZmF1bHQuZ2V0Q29uZmlnKCksXG4gICAgICAgICAgICBsb2dnZXIgPSBfYXN5bmNPcGVyYXRpb25NYW5hZ2UubG9nZ2VyO1xuXG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoKTtcbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgnJyk7XG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkodW5kZWZpbmVkKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGxvZ2dlci5leGNlcHRpb25zQ2FsbGJhY2suY2FsbGVkKS50by5lcXVhbCh0cnVlKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGxvZ2dlci5leGNlcHRpb25zQ2FsbGJhY2suY2FsbENvdW50KS50by5lcXVhbCgzKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBhIGxhYmVsIGlzIG5vdCBhIHN0cmluZycsICgpID0+IHtcbiAgICAgIGNvbnN0IF9hc3luY09wZXJhdGlvbk1hbmFnZTIgPSBfY29uZmlnLmRlZmF1bHQuZ2V0Q29uZmlnKCksXG4gICAgICAgICAgICBsb2dnZXIgPSBfYXN5bmNPcGVyYXRpb25NYW5hZ2UyLmxvZ2dlcjtcblxuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKHt9KTtcbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KShbXSk7XG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoMik7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxDb3VudCkudG8uZXF1YWwoMyk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnZ2V0QW5kVmFsaWRhdGVQYXJhbXMnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBfY29uZmlnLmRlZmF1bHQuc2V0Q29uZmlnKHtcbiAgICAgICAgbG9nZ2VyOiB7XG4gICAgICAgICAgZXhjZXB0aW9uc0NhbGxiYWNrOiBfc2lub24uZGVmYXVsdC5zcHkoKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFuZCBzdWNjZXNzZnVsbHkgcmV0dXJuIGNvcnJlY3QgYXN5bmNPcGVyYXRpb24gcGFyYW1zJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICBwZXJzb25JZDogMixcbiAgICAgICAgdGVhbUlkOiAxMCxcbiAgICAgICAgbmFtZTogJ0RhcmllbidcbiAgICAgIH07XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSB7XG4gICAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJywgJ3RlYW1JZCddXG4gICAgICB9O1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25QYXJhbXMgPSAoMCwgX2hlbHBlcnMuZ2V0QW5kVmFsaWRhdGVQYXJhbXMpKHBhcmFtcywgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGFzeW5jT3BlcmF0aW9uUGFyYW1zKS50by5kZWVwLmVxdWFsKHtcbiAgICAgICAgcGVyc29uSWQ6IDIsXG4gICAgICAgIHRlYW1JZDogMTBcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYW5kIGZhaWwgb24gYW4gdW5kZWZpbmVkIHBhcmFtJywgKCkgPT4ge1xuICAgICAgY29uc3QgX2FzeW5jT3BlcmF0aW9uTWFuYWdlMyA9IF9jb25maWcuZGVmYXVsdC5nZXRDb25maWcoKSxcbiAgICAgICAgICAgIGxvZ2dlciA9IF9hc3luY09wZXJhdGlvbk1hbmFnZTMubG9nZ2VyO1xuXG4gICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgIHBlcnNvbklkOiB1bmRlZmluZWQsXG4gICAgICAgIHRlYW1JZDogMTAsXG4gICAgICAgIG5hbWU6ICdEYXJpZW4nXG4gICAgICB9O1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yID0ge1xuICAgICAgICByZXF1aXJlZFBhcmFtczogWydwZXJzb25JZCcsICd0ZWFtSWQnXVxuICAgICAgfTtcbiAgICAgICgwLCBfaGVscGVycy5nZXRBbmRWYWxpZGF0ZVBhcmFtcykocGFyYW1zLCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYW5kIGZhaWwgb24gYSBtaXNzaW5nIHBhcmFtJywgKCkgPT4ge1xuICAgICAgY29uc3QgX2FzeW5jT3BlcmF0aW9uTWFuYWdlNCA9IF9jb25maWcuZGVmYXVsdC5nZXRDb25maWcoKSxcbiAgICAgICAgICAgIGxvZ2dlciA9IF9hc3luY09wZXJhdGlvbk1hbmFnZTQubG9nZ2VyO1xuXG4gICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgIHBlcnNvbklkOiAyLFxuICAgICAgICBuYW1lOiAnRGFyaWVuJ1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IHtcbiAgICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnLCAndGVhbUlkJ11cbiAgICAgIH07XG4gICAgICAoMCwgX2hlbHBlcnMuZ2V0QW5kVmFsaWRhdGVQYXJhbXMpKHBhcmFtcywgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGxvZ2dlci5leGNlcHRpb25zQ2FsbGJhY2suY2FsbGVkKS50by5lcXVhbCh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdtYWtlQ29uc3RhbnRzT2JqZWN0JywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgX2NvbmZpZy5kZWZhdWx0LnNldENvbmZpZyh7XG4gICAgICAgIGxvZ2dlcjoge1xuICAgICAgICAgIGV4Y2VwdGlvbnNDYWxsYmFjazogX3Npbm9uLmRlZmF1bHQuc3B5KClcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBtYWtlIGEgY29uc3RhbnRzIG9iamVjdCBvdXQgb2YgYW4gYXJyYXkgb2Ygc3RyaW5nIHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGZydWl0cyA9ICgwLCBfaGVscGVycy5tYWtlQ29uc3RhbnRzT2JqZWN0KShbJ0FQUExFJywgJ0JBTkFOQSddKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGZydWl0cykudG8uZGVlcC5lcXVhbCh7XG4gICAgICAgIEFQUExFOiAnQVBQTEUnLFxuICAgICAgICBCQU5BTkE6ICdCQU5BTkEnXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG1ha2UgYSBjb25zdGFudHMgb2JqZWN0IHRoYXQgaXMgaW1tdXRhYmxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZnJ1aXRzID0gKDAsIF9oZWxwZXJzLm1ha2VDb25zdGFudHNPYmplY3QpKFsnQVBQTEUnLCAnQkFOQU5BJ10pO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoZnJ1aXRzLmlzRXh0ZW5zaWJsZSgpKS50by5iZS50cnVlO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdfQ==