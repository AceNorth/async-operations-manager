179165521c3c3d7cc399697355c14726
"use strict";

var _chai = require("chai");

var _sinon = _interopRequireDefault(require("sinon"));

var _config = _interopRequireDefault(require("../config"));

var _helpers = require("../helpers");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/* eslint-env jest */
describe('helpers', () => {
  beforeEach(() => {
    _config.default.setConfig({
      logger: {
        exceptionsCallback: _sinon.default.spy()
      }
    });
  });
  describe('generateAsyncOperationKey', () => {
    it('should create an asyncOperation key with no params', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData');
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData');
    });
    it('should create an asyncOperation key with one param', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_111');
    });
    it('should create an asyncOperation key with multiple params', () => {
      const asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        teamId: 222,
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_222_111');
    });
    it('should throw an exception if a label is not provided', () => {
      const _asyncOperationManage = _config.default.getConfig(),
            logger = _asyncOperationManage.logger;

      (0, _helpers.generateAsyncOperationKey)();
      (0, _helpers.generateAsyncOperationKey)('');
      (0, _helpers.generateAsyncOperationKey)(undefined);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
    it('should throw an exception if a label is not a string', () => {
      const _asyncOperationManage2 = _config.default.getConfig(),
            logger = _asyncOperationManage2.logger;

      (0, _helpers.generateAsyncOperationKey)({});
      (0, _helpers.generateAsyncOperationKey)([]);
      (0, _helpers.generateAsyncOperationKey)(2);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
  });
  describe('getAndValidateParams', () => {
    beforeEach(() => {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should validate and successfully return correct asyncOperation params', () => {
      const params = {
        personId: 2,
        teamId: 10,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      const asyncOperationParams = (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(asyncOperationParams).to.deep.equal({
        personId: 2,
        teamId: 10
      });
    });
    it('should validate and fail on an undefined param', () => {
      const _asyncOperationManage3 = _config.default.getConfig(),
            logger = _asyncOperationManage3.logger;

      const params = {
        personId: undefined,
        teamId: 10,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
    it('should validate and fail on a missing param', () => {
      const _asyncOperationManage4 = _config.default.getConfig(),
            logger = _asyncOperationManage4.logger;

      const params = {
        personId: 2,
        name: 'Darien'
      };
      const asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
  });
  describe('makeConstantsObject', () => {
    beforeEach(() => {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should make a constants object out of an array of string values', () => {
      const fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(fruits).to.deep.equal({
        APPLE: 'APPLE',
        BANANA: 'BANANA'
      });
    });
    it('should make a constants object that is immutable', () => {
      const fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(fruits.isFrozen()).to.be.true;
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlcnNfdGVzdC5qcyJdLCJuYW1lcyI6WyJfY2hhaSIsInJlcXVpcmUiLCJfc2lub24iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2NvbmZpZyIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJzZXRDb25maWciLCJsb2dnZXIiLCJleGNlcHRpb25zQ2FsbGJhY2siLCJzcHkiLCJpdCIsImFzeW5jT3BlcmF0aW9uS2V5IiwiZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSIsImV4cGVjdCIsInRvIiwiZXF1YWwiLCJwZXJzb25JZCIsInRlYW1JZCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZSIsImdldENvbmZpZyIsInVuZGVmaW5lZCIsImNhbGxlZCIsImNhbGxDb3VudCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTIiLCJwYXJhbXMiLCJuYW1lIiwiYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwicmVxdWlyZWRQYXJhbXMiLCJhc3luY09wZXJhdGlvblBhcmFtcyIsImdldEFuZFZhbGlkYXRlUGFyYW1zIiwiZGVlcCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTMiLCJfYXN5bmNPcGVyYXRpb25NYW5hZ2U0IiwiZnJ1aXRzIiwibWFrZUNvbnN0YW50c09iamVjdCIsIkFQUExFIiwiQkFOQU5BIiwiaXNGcm96ZW4iLCJiZSIsInRydWUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQUlBLFFBQVFDLFFBQVEsTUFBUixDQUFaOztBQUVBLElBQUlDLFNBQVNDLHVCQUF1QkYsUUFBUSxPQUFSLENBQXZCLENBQWI7O0FBRUEsSUFBSUcsVUFBVUQsdUJBQXVCRixRQUFRLFdBQVIsQ0FBdkIsQ0FBZDs7QUFFQSxJQUFJSSxXQUFXSixRQUFRLFlBQVIsQ0FBZjs7QUFFQSxTQUFTRSxzQkFBVCxDQUFnQ0csR0FBaEMsRUFBcUM7QUFBRSxTQUFPQSxPQUFPQSxJQUFJQyxVQUFYLEdBQXdCRCxH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RCxFQUFVLFFBQVYsQ0FBbEMsQ0FBZjtBQUNBLE9BQUMsR0FBR3ZDLE1BQU1rQixNQUFWLEVBQWtCb0IsT0FBT0ksUUFBUCxFQUFsQixFQUFxQ3ZCLEVBQXJDLENBQXdDd0IsRUFBeEMsQ0FBMkNDLElBQTNDO0FBQ0QsS0FIRDtBQUlELEdBbkJEO0FBb0JELENBeEhEIiwiZmlsZSI6ImhlbHBlcnNfdGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG52YXIgX2NoYWkgPSByZXF1aXJlKFwiY2hhaVwiKTtcblxudmFyIF9zaW5vbiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcInNpbm9uXCIpKTtcblxudmFyIF9jb25maWcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuXG52YXIgX2hlbHBlcnMgPSByZXF1aXJlKFwiLi4vaGVscGVyc1wiKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuLyogZXNsaW50LWVudiBqZXN0ICovXG5kZXNjcmliZSgnaGVscGVycycsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgX2NvbmZpZy5kZWZhdWx0LnNldENvbmZpZyh7XG4gICAgICBsb2dnZXI6IHtcbiAgICAgICAgZXhjZXB0aW9uc0NhbGxiYWNrOiBfc2lub24uZGVmYXVsdC5zcHkoKVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2dlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW4gYXN5bmNPcGVyYXRpb24ga2V5IHdpdGggbm8gcGFyYW1zJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25LZXkgPSAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoJ3VwZGF0ZVBlcnNvbkRhdGEnKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGFzeW5jT3BlcmF0aW9uS2V5KS50by5lcXVhbCgndXBkYXRlUGVyc29uRGF0YScpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGFuIGFzeW5jT3BlcmF0aW9uIGtleSB3aXRoIG9uZSBwYXJhbScsICgpID0+IHtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uS2V5ID0gKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCd1cGRhdGVQZXJzb25EYXRhJywge1xuICAgICAgICBwZXJzb25JZDogMTExXG4gICAgICB9KTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGFzeW5jT3BlcmF0aW9uS2V5KS50by5lcXVhbCgndXBkYXRlUGVyc29uRGF0YV8xMTEnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbiBhc3luY09wZXJhdGlvbiBrZXkgd2l0aCBtdWx0aXBsZSBwYXJhbXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvbktleSA9ICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgndXBkYXRlUGVyc29uRGF0YScsIHtcbiAgICAgICAgdGVhbUlkOiAyMjIsXG4gICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgIH0pO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoYXN5bmNPcGVyYXRpb25LZXkpLnRvLmVxdWFsKCd1cGRhdGVQZXJzb25EYXRhXzIyMl8xMTEnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBhIGxhYmVsIGlzIG5vdCBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IF9hc3luY09wZXJhdGlvbk1hbmFnZSA9IF9jb25maWcuZGVmYXVsdC5nZXRDb25maWcoKSxcbiAgICAgICAgICAgIGxvZ2dlciA9IF9hc3luY09wZXJhdGlvbk1hbmFnZS5sb2dnZXI7XG5cbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgpO1xuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCcnKTtcbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSh1bmRlZmluZWQpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsQ291bnQpLnRvLmVxdWFsKDMpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGEgbGFiZWwgaXMgbm90IGEgc3RyaW5nJywgKCkgPT4ge1xuICAgICAgY29uc3QgX2FzeW5jT3BlcmF0aW9uTWFuYWdlMiA9IF9jb25maWcuZGVmYXVsdC5nZXRDb25maWcoKSxcbiAgICAgICAgICAgIGxvZ2dlciA9IF9hc3luY09wZXJhdGlvbk1hbmFnZTIubG9nZ2VyO1xuXG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoe30pO1xuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKFtdKTtcbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgyKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGxvZ2dlci5leGNlcHRpb25zQ2FsbGJhY2suY2FsbGVkKS50by5lcXVhbCh0cnVlKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGxvZ2dlci5leGNlcHRpb25zQ2FsbGJhY2suY2FsbENvdW50KS50by5lcXVhbCgzKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdnZXRBbmRWYWxpZGF0ZVBhcmFtcycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIF9jb25maWcuZGVmYXVsdC5zZXRDb25maWcoe1xuICAgICAgICBsb2dnZXI6IHtcbiAgICAgICAgICBleGNlcHRpb25zQ2FsbGJhY2s6IF9zaW5vbi5kZWZhdWx0LnNweSgpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYW5kIHN1Y2Nlc3NmdWxseSByZXR1cm4gY29ycmVjdCBhc3luY09wZXJhdGlvbiBwYXJhbXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgIHBlcnNvbklkOiAyLFxuICAgICAgICB0ZWFtSWQ6IDEwLFxuICAgICAgICBuYW1lOiAnRGFyaWVuJ1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IHtcbiAgICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnLCAndGVhbUlkJ11cbiAgICAgIH07XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvblBhcmFtcyA9ICgwLCBfaGVscGVycy5nZXRBbmRWYWxpZGF0ZVBhcmFtcykocGFyYW1zLCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoYXN5bmNPcGVyYXRpb25QYXJhbXMpLnRvLmRlZXAuZXF1YWwoe1xuICAgICAgICBwZXJzb25JZDogMixcbiAgICAgICAgdGVhbUlkOiAxMFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhbmQgZmFpbCBvbiBhbiB1bmRlZmluZWQgcGFyYW0nLCAoKSA9PiB7XG4gICAgICBjb25zdCBfYXN5bmNPcGVyYXRpb25NYW5hZ2UzID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpLFxuICAgICAgICAgICAgbG9nZ2VyID0gX2FzeW5jT3BlcmF0aW9uTWFuYWdlMy5sb2dnZXI7XG5cbiAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgcGVyc29uSWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgdGVhbUlkOiAxMCxcbiAgICAgICAgbmFtZTogJ0RhcmllbidcbiAgICAgIH07XG4gICAgICBjb25zdCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSB7XG4gICAgICAgIHJlcXVpcmVkUGFyYW1zOiBbJ3BlcnNvbklkJywgJ3RlYW1JZCddXG4gICAgICB9O1xuICAgICAgKDAsIF9oZWxwZXJzLmdldEFuZFZhbGlkYXRlUGFyYW1zKShwYXJhbXMsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcik7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhbmQgZmFpbCBvbiBhIG1pc3NpbmcgcGFyYW0nLCAoKSA9PiB7XG4gICAgICBjb25zdCBfYXN5bmNPcGVyYXRpb25NYW5hZ2U0ID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpLFxuICAgICAgICAgICAgbG9nZ2VyID0gX2FzeW5jT3BlcmF0aW9uTWFuYWdlNC5sb2dnZXI7XG5cbiAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgcGVyc29uSWQ6IDIsXG4gICAgICAgIG5hbWU6ICdEYXJpZW4nXG4gICAgICB9O1xuICAgICAgY29uc3QgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yID0ge1xuICAgICAgICByZXF1aXJlZFBhcmFtczogWydwZXJzb25JZCcsICd0ZWFtSWQnXVxuICAgICAgfTtcbiAgICAgICgwLCBfaGVscGVycy5nZXRBbmRWYWxpZGF0ZVBhcmFtcykocGFyYW1zLCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ21ha2VDb25zdGFudHNPYmplY3QnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBfY29uZmlnLmRlZmF1bHQuc2V0Q29uZmlnKHtcbiAgICAgICAgbG9nZ2VyOiB7XG4gICAgICAgICAgZXhjZXB0aW9uc0NhbGxiYWNrOiBfc2lub24uZGVmYXVsdC5zcHkoKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG1ha2UgYSBjb25zdGFudHMgb2JqZWN0IG91dCBvZiBhbiBhcnJheSBvZiBzdHJpbmcgdmFsdWVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZnJ1aXRzID0gKDAsIF9oZWxwZXJzLm1ha2VDb25zdGFudHNPYmplY3QpKFsnQVBQTEUnLCAnQkFOQU5BJ10pO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoZnJ1aXRzKS50by5kZWVwLmVxdWFsKHtcbiAgICAgICAgQVBQTEU6ICdBUFBMRScsXG4gICAgICAgIEJBTkFOQTogJ0JBTkFOQSdcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbWFrZSBhIGNvbnN0YW50cyBvYmplY3QgdGhhdCBpcyBpbW11dGFibGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmcnVpdHMgPSAoMCwgX2hlbHBlcnMubWFrZUNvbnN0YW50c09iamVjdCkoWydBUFBMRScsICdCQU5BTkEnXSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShmcnVpdHMuaXNGcm96ZW4oKSkudG8uYmUudHJ1ZTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXX0=