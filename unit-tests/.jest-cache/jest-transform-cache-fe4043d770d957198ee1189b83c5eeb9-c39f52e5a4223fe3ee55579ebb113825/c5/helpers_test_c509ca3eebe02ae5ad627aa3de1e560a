7256c4e46f7dbd9752dd9eab412230b2
"use strict";

var _chai = require("chai");

var _sinon = _interopRequireDefault(require("sinon"));

var _config = _interopRequireDefault(require("../config"));

var _helpers = require("../helpers");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
/* eslint-env jest */


describe('helpers', function () {
  beforeEach(function () {
    _config.default.setConfig({
      logger: {
        exceptionsCallback: _sinon.default.spy()
      }
    });
  });
  describe('generateAsyncOperationKey', function () {
    it('should create an asyncOperation key with no params', function () {
      var asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData');
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData');
    });
    it('should create an asyncOperation key with one param', function () {
      var asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_111');
    });
    it('should create an asyncOperation key with multiple params', function () {
      var asyncOperationKey = (0, _helpers.generateAsyncOperationKey)('updatePersonData', {
        teamId: 222,
        personId: 111
      });
      (0, _chai.expect)(asyncOperationKey).to.equal('updatePersonData_222_111');
    });
    it('should throw an exception if a label is not provided', function () {
      var _asyncOperationManage = _config.default.getConfig(),
          logger = _asyncOperationManage.logger;

      (0, _helpers.generateAsyncOperationKey)();
      (0, _helpers.generateAsyncOperationKey)('');
      (0, _helpers.generateAsyncOperationKey)(undefined);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
    it('should throw an exception if a label is not a string', function () {
      var _asyncOperationManage2 = _config.default.getConfig(),
          logger = _asyncOperationManage2.logger;

      (0, _helpers.generateAsyncOperationKey)({});
      (0, _helpers.generateAsyncOperationKey)([]);
      (0, _helpers.generateAsyncOperationKey)(2);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
      (0, _chai.expect)(logger.exceptionsCallback.callCount).to.equal(3);
    });
  });
  describe('getAndValidateParams', function () {
    beforeEach(function () {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should validate and successfully return correct asyncOperation params', function () {
      var params = {
        personId: 2,
        teamId: 10,
        name: 'Darien'
      };
      var asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      var asyncOperationParams = (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(asyncOperationParams).to.deep.equal({
        personId: 2,
        teamId: 10
      });
    });
    it('should validate and fail on an undefined param', function () {
      var _asyncOperationManage3 = _config.default.getConfig(),
          logger = _asyncOperationManage3.logger;

      var params = {
        personId: undefined,
        teamId: 10,
        name: 'Darien'
      };
      var asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
    it('should validate and fail on a missing param', function () {
      var _asyncOperationManage4 = _config.default.getConfig(),
          logger = _asyncOperationManage4.logger;

      var params = {
        personId: 2,
        name: 'Darien'
      };
      var asyncOperationDescriptor = {
        requiredParams: ['personId', 'teamId']
      };
      (0, _helpers.getAndValidateParams)(params, asyncOperationDescriptor);
      (0, _chai.expect)(logger.exceptionsCallback.called).to.equal(true);
    });
  });
  describe('makeConstantsObject', function () {
    beforeEach(function () {
      _config.default.setConfig({
        logger: {
          exceptionsCallback: _sinon.default.spy()
        }
      });
    });
    it('should make a constants object out of an array of string values', function () {
      var fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(fruits).to.deep.equal({
        APPLE: 'APPLE',
        BANANA: 'BANANA'
      });
    });
    it('should make a constants object that is immutable', function () {
      var fruits = (0, _helpers.makeConstantsObject)(['APPLE', 'BANANA']);
      (0, _chai.expect)(Object.isExtensible(fruits)).to.be.false;
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlcnNfdGVzdC5qcyJdLCJuYW1lcyI6WyJfY2hhaSIsInJlcXVpcmUiLCJfc2lub24iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2NvbmZpZyIsIl9oZWxwZXJzIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJzZXRDb25maWciLCJsb2dnZXIiLCJleGNlcHRpb25zQ2FsbGJhY2siLCJzcHkiLCJpdCIsImFzeW5jT3BlcmF0aW9uS2V5IiwiZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSIsImV4cGVjdCIsInRvIiwiZXF1YWwiLCJwZXJzb25JZCIsInRlYW1JZCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZSIsImdldENvbmZpZyIsInVuZGVmaW5lZCIsImNhbGxlZCIsImNhbGxDb3VudCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTIiLCJwYXJhbXMiLCJuYW1lIiwiYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwicmVxdWlyZWRQYXJhbXMiLCJhc3luY09wZXJhdGlvblBhcmFtcyIsImdldEFuZFZhbGlkYXRlUGFyYW1zIiwiZGVlcCIsIl9hc3luY09wZXJhdGlvbk1hbmFnZTMiLCJfYXN5bmNPcGVyYXRpb25NYW5hZ2U0IiwiZnJ1aXRzIiwibWFrZUNvbnN0YW50c09iamVjdCIsIkFQUExFIiwiQkFOQU5BIiwiT2JqZWN0IiwiaXNFeHRlbnNpYmxlIiwiYmUiLCJmYWxzZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsTUFBRCxDQUFuQjs7QUFFQSxJQUFJQyxNQUFNLEdBQUdDLHNCQUFzQixDQUFDRixPQUFPLENBQUMsT0FBRCxDQUFSLENBQW5DOztBQUVBLElBQUlHLE9BQU8sR0FBR0Qsc0JBQXNCLENBQUNGLE9BQU8sQ0FBQyxXQUFELENBQVIsQ0FBcEM7O0FBRUEsSUFBSUksUUFBUSxHQUFHSixPQUFPLENBQUMsWUFBRCxDQUF0Qjs7QUFFQSxT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USxDQUFDa0MsbUJBQWIsRUFBa0MsQ0FBQyxPQUFELEVBQVUsUUFBVixDQUFsQyxDQUFiO0FBQ0EsT0FBQyxHQUFHdkMsS0FBSyxDQUFDa0IsTUFBVixFQUFrQndCLE1BQU0sQ0FBQ0MsWUFBUCxDQUFvQkwsTUFBcEIsQ0FBbEIsRUFBK0NuQixFQUEvQyxDQUFrRHlCLEVBQWxELENBQXFEQyxLQUFyRDtBQUNELEtBSEMsQ0FBRjtBQUlELEdBbkJPLENBQVI7QUFvQkQsQ0F4SE8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG52YXIgX2NoYWkgPSByZXF1aXJlKFwiY2hhaVwiKTtcblxudmFyIF9zaW5vbiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcInNpbm9uXCIpKTtcblxudmFyIF9jb25maWcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9jb25maWdcIikpO1xuXG52YXIgX2hlbHBlcnMgPSByZXF1aXJlKFwiLi4vaGVscGVyc1wiKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuLyogZXNsaW50LWVudiBqZXN0ICovXG5kZXNjcmliZSgnaGVscGVycycsIGZ1bmN0aW9uICgpIHtcbiAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgX2NvbmZpZy5kZWZhdWx0LnNldENvbmZpZyh7XG4gICAgICBsb2dnZXI6IHtcbiAgICAgICAgZXhjZXB0aW9uc0NhbGxiYWNrOiBfc2lub24uZGVmYXVsdC5zcHkoKVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2dlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXknLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW4gYXN5bmNPcGVyYXRpb24ga2V5IHdpdGggbm8gcGFyYW1zJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGFzeW5jT3BlcmF0aW9uS2V5ID0gKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCd1cGRhdGVQZXJzb25EYXRhJyk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShhc3luY09wZXJhdGlvbktleSkudG8uZXF1YWwoJ3VwZGF0ZVBlcnNvbkRhdGEnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbiBhc3luY09wZXJhdGlvbiBrZXkgd2l0aCBvbmUgcGFyYW0nLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgYXN5bmNPcGVyYXRpb25LZXkgPSAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoJ3VwZGF0ZVBlcnNvbkRhdGEnLCB7XG4gICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgIH0pO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoYXN5bmNPcGVyYXRpb25LZXkpLnRvLmVxdWFsKCd1cGRhdGVQZXJzb25EYXRhXzExMScpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGFuIGFzeW5jT3BlcmF0aW9uIGtleSB3aXRoIG11bHRpcGxlIHBhcmFtcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBhc3luY09wZXJhdGlvbktleSA9ICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KSgndXBkYXRlUGVyc29uRGF0YScsIHtcbiAgICAgICAgdGVhbUlkOiAyMjIsXG4gICAgICAgIHBlcnNvbklkOiAxMTFcbiAgICAgIH0pO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkoYXN5bmNPcGVyYXRpb25LZXkpLnRvLmVxdWFsKCd1cGRhdGVQZXJzb25EYXRhXzIyMl8xMTEnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBhIGxhYmVsIGlzIG5vdCBwcm92aWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBfYXN5bmNPcGVyYXRpb25NYW5hZ2UgPSBfY29uZmlnLmRlZmF1bHQuZ2V0Q29uZmlnKCksXG4gICAgICAgICAgbG9nZ2VyID0gX2FzeW5jT3BlcmF0aW9uTWFuYWdlLmxvZ2dlcjtcblxuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKCk7XG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoJycpO1xuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKHVuZGVmaW5lZCk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxDb3VudCkudG8uZXF1YWwoMyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBleGNlcHRpb24gaWYgYSBsYWJlbCBpcyBub3QgYSBzdHJpbmcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX2FzeW5jT3BlcmF0aW9uTWFuYWdlMiA9IF9jb25maWcuZGVmYXVsdC5nZXRDb25maWcoKSxcbiAgICAgICAgICBsb2dnZXIgPSBfYXN5bmNPcGVyYXRpb25NYW5hZ2UyLmxvZ2dlcjtcblxuICAgICAgKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKHt9KTtcbiAgICAgICgwLCBfaGVscGVycy5nZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5KShbXSk7XG4gICAgICAoMCwgX2hlbHBlcnMuZ2VuZXJhdGVBc3luY09wZXJhdGlvbktleSkoMik7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxlZCkudG8uZXF1YWwodHJ1ZSk7XG4gICAgICAoMCwgX2NoYWkuZXhwZWN0KShsb2dnZXIuZXhjZXB0aW9uc0NhbGxiYWNrLmNhbGxDb3VudCkudG8uZXF1YWwoMyk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnZ2V0QW5kVmFsaWRhdGVQYXJhbXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICBfY29uZmlnLmRlZmF1bHQuc2V0Q29uZmlnKHtcbiAgICAgICAgbG9nZ2VyOiB7XG4gICAgICAgICAgZXhjZXB0aW9uc0NhbGxiYWNrOiBfc2lub24uZGVmYXVsdC5zcHkoKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFuZCBzdWNjZXNzZnVsbHkgcmV0dXJuIGNvcnJlY3QgYXN5bmNPcGVyYXRpb24gcGFyYW1zJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgcGVyc29uSWQ6IDIsXG4gICAgICAgIHRlYW1JZDogMTAsXG4gICAgICAgIG5hbWU6ICdEYXJpZW4nXG4gICAgICB9O1xuICAgICAgdmFyIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IHtcbiAgICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnLCAndGVhbUlkJ11cbiAgICAgIH07XG4gICAgICB2YXIgYXN5bmNPcGVyYXRpb25QYXJhbXMgPSAoMCwgX2hlbHBlcnMuZ2V0QW5kVmFsaWRhdGVQYXJhbXMpKHBhcmFtcywgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGFzeW5jT3BlcmF0aW9uUGFyYW1zKS50by5kZWVwLmVxdWFsKHtcbiAgICAgICAgcGVyc29uSWQ6IDIsXG4gICAgICAgIHRlYW1JZDogMTBcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYW5kIGZhaWwgb24gYW4gdW5kZWZpbmVkIHBhcmFtJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF9hc3luY09wZXJhdGlvbk1hbmFnZTMgPSBfY29uZmlnLmRlZmF1bHQuZ2V0Q29uZmlnKCksXG4gICAgICAgICAgbG9nZ2VyID0gX2FzeW5jT3BlcmF0aW9uTWFuYWdlMy5sb2dnZXI7XG5cbiAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgIHBlcnNvbklkOiB1bmRlZmluZWQsXG4gICAgICAgIHRlYW1JZDogMTAsXG4gICAgICAgIG5hbWU6ICdEYXJpZW4nXG4gICAgICB9O1xuICAgICAgdmFyIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IHtcbiAgICAgICAgcmVxdWlyZWRQYXJhbXM6IFsncGVyc29uSWQnLCAndGVhbUlkJ11cbiAgICAgIH07XG4gICAgICAoMCwgX2hlbHBlcnMuZ2V0QW5kVmFsaWRhdGVQYXJhbXMpKHBhcmFtcywgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGxvZ2dlci5leGNlcHRpb25zQ2FsbGJhY2suY2FsbGVkKS50by5lcXVhbCh0cnVlKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFuZCBmYWlsIG9uIGEgbWlzc2luZyBwYXJhbScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBfYXN5bmNPcGVyYXRpb25NYW5hZ2U0ID0gX2NvbmZpZy5kZWZhdWx0LmdldENvbmZpZygpLFxuICAgICAgICAgIGxvZ2dlciA9IF9hc3luY09wZXJhdGlvbk1hbmFnZTQubG9nZ2VyO1xuXG4gICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICBwZXJzb25JZDogMixcbiAgICAgICAgbmFtZTogJ0RhcmllbidcbiAgICAgIH07XG4gICAgICB2YXIgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yID0ge1xuICAgICAgICByZXF1aXJlZFBhcmFtczogWydwZXJzb25JZCcsICd0ZWFtSWQnXVxuICAgICAgfTtcbiAgICAgICgwLCBfaGVscGVycy5nZXRBbmRWYWxpZGF0ZVBhcmFtcykocGFyYW1zLCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpO1xuICAgICAgKDAsIF9jaGFpLmV4cGVjdCkobG9nZ2VyLmV4Y2VwdGlvbnNDYWxsYmFjay5jYWxsZWQpLnRvLmVxdWFsKHRydWUpO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ21ha2VDb25zdGFudHNPYmplY3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICBfY29uZmlnLmRlZmF1bHQuc2V0Q29uZmlnKHtcbiAgICAgICAgbG9nZ2VyOiB7XG4gICAgICAgICAgZXhjZXB0aW9uc0NhbGxiYWNrOiBfc2lub24uZGVmYXVsdC5zcHkoKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG1ha2UgYSBjb25zdGFudHMgb2JqZWN0IG91dCBvZiBhbiBhcnJheSBvZiBzdHJpbmcgdmFsdWVzJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGZydWl0cyA9ICgwLCBfaGVscGVycy5tYWtlQ29uc3RhbnRzT2JqZWN0KShbJ0FQUExFJywgJ0JBTkFOQSddKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKGZydWl0cykudG8uZGVlcC5lcXVhbCh7XG4gICAgICAgIEFQUExFOiAnQVBQTEUnLFxuICAgICAgICBCQU5BTkE6ICdCQU5BTkEnXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG1ha2UgYSBjb25zdGFudHMgb2JqZWN0IHRoYXQgaXMgaW1tdXRhYmxlJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGZydWl0cyA9ICgwLCBfaGVscGVycy5tYWtlQ29uc3RhbnRzT2JqZWN0KShbJ0FQUExFJywgJ0JBTkFOQSddKTtcbiAgICAgICgwLCBfY2hhaS5leHBlY3QpKE9iamVjdC5pc0V4dGVuc2libGUoZnJ1aXRzKSkudG8uYmUuZmFsc2U7XG4gICAgfSk7XG4gIH0pO1xufSk7Il19