8316c724a4e28a4628b7e3767b2762f0
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("core-js/modules/web.dom.iterable");

var _lodash = _interopRequireDefault(require("lodash"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _config = _interopRequireDefault(require("./config"));

var _constants = require("./constants");

var _helpers = require("./helpers");

var _types = require("./types");

var _asyncOperationUtils = require("./asyncOperationUtils");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};var ownKeys = Object.keys(source);if (typeof Object.getOwnPropertySymbols === 'function') {
      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {
        return Object.getOwnPropertyDescriptor(source, sym).enumerable;
      }));
    }ownKeys.forEach(function (key) {
      _defineProperty(target, key, source[key]);
    });
  }return target;
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });
  } else {
    obj[key] = value;
  }return obj;
}

const updateAsyncOperationDescriptor = (asyncOperationDescriptors, descriptorOptions) => {
  const asyncOperationDescriptor = _objectSpread({
    debug: false,
    parentOperationDescriptorId: null,
    alwaysImmutable: false,
    minCacheTime: 5000,
    maxCacheTime: 60000
  }, descriptorOptions);

  _propTypes.default.checkPropTypes(_types.asyncOperationDescriptorPropType, asyncOperationDescriptor, 'prop', 'asyncOperationDescriptor');

  return _objectSpread({}, asyncOperationDescriptors, {
    [asyncOperationDescriptor.descriptorId]: asyncOperationDescriptor
  });
}; // validate whether the asyncOperationDescriptor exists


const getAsyncOperationDescriptor = (asyncOperationDescriptors, descriptorId) => {
  const config = _config.default.getConfig();

  const asyncOperationDescriptor = asyncOperationDescriptors[descriptorId];

  if (!asyncOperationDescriptor) {
    config.logger.warningsCallback(`descriptorId "${descriptorId}" does not match with any registered async operation descriptor`);
    return null;
  }

  if (asyncOperationDescriptor.debug) {
    config.logger.verboseLoggingCallback(`Inside getAsyncOperationDescriptor for ${descriptorId}`);
    config.logger.infoLoggingCallback('getAsyncOperationDescriptor [Data Snapshot]:', {
      asyncOperationDescriptors,
      asyncOperationDescriptor
    });
  }

  return asyncOperationDescriptor;
}; // This function will do all the work to determine if an async operation is returned as an initial async operation
// (if it is not found in state), an asyncOperation with parentAsyncOperation metaData (recursively searched to find if the parentAsyncOperation is more
// up-to-date) or just the asyncOperation itself if the none of the above apply.


const getAsyncOperation = (state, registeredAsyncOperationDescriptors, asyncOperationKey, asyncOperationDescriptor, asyncOperationParams, fieldsToAdd) => {
  const config = _config.default.getConfig();

  const fieldsToAddToAction = _objectSpread({}, asyncOperationParams, fieldsToAdd, {
    // key for the descriptor of the asyncOperation
    descriptorId: asyncOperationDescriptor.descriptorId
  });

  let parentAsyncOperation;
  let asyncOperation = state[asyncOperationKey] || null;

  if (asyncOperationDescriptor.parentOperationDescriptorId) {
    // grab key, descriptor, params, and async operation for parentAsyncOperation
    const parentAsyncOperationDescriptor = getAsyncOperationDescriptor(registeredAsyncOperationDescriptors, asyncOperationDescriptor.parentOperationDescriptorId);
    const parentAsyncOperationParams = (0, _helpers.getAndValidateParams)(asyncOperationParams, parentAsyncOperationDescriptor);
    const parentAsyncOperationKey = (0, _helpers.generateAsyncOperationKey)(asyncOperationDescriptor.parentOperationDescriptorId, parentAsyncOperationParams);
    parentAsyncOperation = getAsyncOperation(state, registeredAsyncOperationDescriptors, parentAsyncOperationKey, parentAsyncOperationDescriptor, asyncOperationParams, fieldsToAddToAction);
  }

  if (asyncOperationDescriptor.debug) {
    config.logger.verboseLoggingCallback(`Inside getAsyncOperation for ${asyncOperationKey}`);
    config.logger.infoLoggingCallback('getAsyncOperation [Data Snapshot]:', {
      state,
      asyncOperationParams,
      asyncOperationDescriptor,
      asyncOperation,
      asyncOperationKey
    });
  }

  if (!asyncOperation) {
    if (asyncOperationDescriptor.debug) {
      config.logger.verboseLoggingCallback(`asyncOperation not found with given key: ${asyncOperationKey}. Defaulting to an initial asyncOperation`);
    }

    asyncOperation = asyncOperationDescriptor.operationType === _constants.ASYNC_OPERATION_TYPES.READ ? (0, _asyncOperationUtils.initialReadAsyncOperationForAction)(asyncOperationDescriptor.descriptorId, fieldsToAddToAction, parentAsyncOperation) : (0, _asyncOperationUtils.initialWriteAsyncOperationForAction)(asyncOperationDescriptor.descriptorId, fieldsToAddToAction, parentAsyncOperation);
  } // We want to determine whether or not to use that parentAsyncOperation metaData based on the
  // newness of it's data in comparison to the asyncOperation


  if (parentAsyncOperation && asyncOperation) {
    return parentAsyncOperation.lastDataStatusTime.valueOf() > asyncOperation.lastDataStatusTime.valueOf() ? _objectSpread({}, asyncOperation, _lodash.default.pick(parentAsyncOperation, _constants.readAsyncOperationFieldsToPullFromParent)) : asyncOperation;
  }

  return asyncOperation;
};

const updateAsyncOperation = (state, asyncOperationKey, asyncOperation, asyncOperationDescriptor) => {
  const config = _config.default.getConfig();

  if (asyncOperationDescriptor.debug) {
    config.logger.verboseLoggingCallback(`Inside updateAsyncOperation for ${asyncOperationKey}`);
    config.logger.infoLoggingCallback('updateAsyncOperation [Data Snapshot]:', {
      state,
      asyncOperationDescriptor,
      asyncOperation,
      asyncOperationKey
    });
  }

  _propTypes.default.checkPropTypes(_types.asyncOperationPropType, asyncOperation, 'prop', 'asyncOperation');

  return _objectSpread({}, state, {
    [asyncOperationKey]: asyncOperation
  });
};

const bulkUpdateAsyncOperations = (state, asyncOperationsList) => {
  return _lodash.default.reduce(asyncOperationsList, (accumulator, _ref) => {
    let asyncOperationKey = _ref.asyncOperationKey,
        asyncOperation = _ref.asyncOperation,
        asyncOperationDescriptor = _ref.asyncOperationDescriptor;
    return updateAsyncOperation(accumulator, asyncOperationKey, asyncOperation, asyncOperationDescriptor);
  }, state);
};

var _default = {
  updateAsyncOperationDescriptor,
  updateAsyncOperation,
  bulkUpdateAsyncOperations,
  getAsyncOperation,
  getAsyncOperationDescriptor
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jT3BlcmF0aW9uU3RhdGVVdGlscy5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJyZXF1aXJlIiwiX2xvZGFzaCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfcHJvcFR5cGVzIiwiX2NvbmZpZyIsIl9jb25zdGFudHMiLCJfaGVscGVycyIsIl90eXBlcyIsIl9hc3luY09wZXJhdGlvblV0aWxzIiwib2JqIiwiX19lc01vZHVsZSIsIl9vYmplY3RTcHJlYWQiLCJ0YXJnZXQiLCJpIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwic291cmNlIiwib3duS2V5cyIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJjb25jYXQiLCJmaWx0ZXIiLCJzeW0iLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiZm9yRWFjaCIsImtleSIsIl9kZWZpbmVQcm9wZXJ0eSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwidXBkYXRlQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwiYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycyIsImRlc2NyaXB0b3JPcHRpb25zIiwiYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwiZGVidWciLCJwYXJlbnRPcGVyYXRpb25EZXNjcmlwdG9ySWQiLCJhbHdheXNJbW11dGFibGUiLCJtaW5DYWNoZVRpbWUiLCJtYXhDYWNoZVRpbWUiLCJjaGVja1Byb3BUeXBlcyIsImFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclByb3BUeXBlIiwiZGVzY3JpcHRvcklkIiwiZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIiwiY29uZmlnIiwiZ2V0Q29uZmlnIiwibG9nZ2VyIiwid2FybmluZ3NDYWxsYmFjayIsInZlcmJvc2VMb2dnaW5nQ2FsbGJhY2siLCJpbmZvTG9nZ2luZ0NhbGxiYWNrIiwiZ2V0QXN5bmNPcGVyYXRpb24iLCJzdGF0ZSIsInJlZ2lzdGVyZWRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzIiwiYXN5bmNPcGVyYXRpb25LZXkiLCJhc3luY09wZXJhdGlvblBhcmFtcyIsImZpZWxkc1RvQWRkIiwiZmllbGRzVG9BZGRUb0FjdGlvbiIsInBhcmVudEFzeW5jT3BlcmF0aW9uIiwiYXN5bmNPcGVyYXRpb24iLCJwYXJlbnRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IiLCJwYXJlbnRBc3luY09wZXJhdGlvblBhcmFtcyIsImdldEFuZFZhbGlkYXRlUGFyYW1zIiwicGFyZW50QXN5bmNPcGVyYXRpb25LZXkiLCJnZW5lcmF0ZUFzeW5jT3BlcmF0aW9uS2V5Iiwib3BlcmF0aW9uVHlwZSIsIkFTWU5DX09QRVJBVElPTl9UWVBFUyIsIlJFQUQiLCJpbml0aWFsUmVhZEFzeW5jT3BlcmF0aW9uRm9yQWN0aW9uIiwiaW5pdGlhbFdyaXRlQXN5bmNPcGVyYXRpb25Gb3JBY3Rpb24iLCJsYXN0RGF0YVN0YXR1c1RpbWUiLCJ2YWx1ZU9mIiwicGljayIsInJlYWRBc3luY09wZXJhdGlvbkZpZWxkc1RvUHVsbEZyb21QYXJlbnQiLCJ1cGRhdGVBc3luY09wZXJhdGlvbiIsImFzeW5jT3BlcmF0aW9uUHJvcFR5cGUiLCJidWxrVXBkYXRlQXN5bmNPcGVyYXRpb25zIiwiYXN5bmNPcGVyYXRpb25zTGlzdCIsInJlZHVjZSIsImFjY3VtdWxhdG9yIiwiX3JlZiIsIl9kZWZhdWx0Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsT0FBT0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLFNBQU87QUFEb0MsQ0FBN0M7QUFHQUQsUUFBUUUsT0FBUixHQUFrQixLQUFLLENBQXZCOztBQUVBQyxRQUFRLGtDQUFSOztBQUVBLElBQUlDLFVBQVVDLHVCQUF1QkYsUUFBUSxRQUFSLENBQXZCLENBQWQ7O0FBRUEsSUFBSUcsYUFBYUQsdUJBQXVCRixRQUFRLFlBQVIsQ0FBdkIsQ0FBakI7O0FBRUEsSUFBSUksVUFBVUYsdUJBQXVC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Q0FQRDs7QUFTQSxJQUFJNkIsV0FBVztBQUNiakQsZ0NBRGE7QUFFYjBDLHNCQUZhO0FBR2JFLDJCQUhhO0FBSWJ6QixtQkFKYTtBQUtiUDtBQUxhLENBQWY7QUFPQTdDLFFBQVFFLE9BQVIsR0FBa0JnRixRQUFsQiIsImZpbGUiOiJhc3luY09wZXJhdGlvblN0YXRlVXRpbHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxucmVxdWlyZShcImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlXCIpO1xuXG52YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImxvZGFzaFwiKSk7XG5cbnZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwicHJvcC10eXBlc1wiKSk7XG5cbnZhciBfY29uZmlnID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9jb25maWdcIikpO1xuXG52YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcblxudmFyIF9oZWxwZXJzID0gcmVxdWlyZShcIi4vaGVscGVyc1wiKTtcblxudmFyIF90eXBlcyA9IHJlcXVpcmUoXCIuL3R5cGVzXCIpO1xuXG52YXIgX2FzeW5jT3BlcmF0aW9uVXRpbHMgPSByZXF1aXJlKFwiLi9hc3luY09wZXJhdGlvblV0aWxzXCIpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgdmFyIG93bktleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpOyBpZiAodHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09ICdmdW5jdGlvbicpIHsgb3duS2V5cyA9IG93bktleXMuY29uY2F0KE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoc291cmNlKS5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIHN5bSkuZW51bWVyYWJsZTsgfSkpOyB9IG93bktleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSByZXR1cm4gdGFyZ2V0OyB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9XG5cbmNvbnN0IHVwZGF0ZUFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IChhc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzLCBkZXNjcmlwdG9yT3B0aW9ucykgPT4ge1xuICBjb25zdCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSBfb2JqZWN0U3ByZWFkKHtcbiAgICBkZWJ1ZzogZmFsc2UsXG4gICAgcGFyZW50T3BlcmF0aW9uRGVzY3JpcHRvcklkOiBudWxsLFxuICAgIGFsd2F5c0ltbXV0YWJsZTogZmFsc2UsXG4gICAgbWluQ2FjaGVUaW1lOiA1MDAwLFxuICAgIG1heENhY2hlVGltZTogNjAwMDBcbiAgfSwgZGVzY3JpcHRvck9wdGlvbnMpO1xuXG4gIF9wcm9wVHlwZXMuZGVmYXVsdC5jaGVja1Byb3BUeXBlcyhfdHlwZXMuYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yUHJvcFR5cGUsIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciwgJ3Byb3AnLCAnYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yJyk7XG5cbiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMsIHtcbiAgICBbYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yLmRlc2NyaXB0b3JJZF06IGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvclxuICB9KTtcbn07IC8vIHZhbGlkYXRlIHdoZXRoZXIgdGhlIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciBleGlzdHNcblxuXG5jb25zdCBnZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSAoYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycywgZGVzY3JpcHRvcklkKSA9PiB7XG4gIGNvbnN0IGNvbmZpZyA9IF9jb25maWcuZGVmYXVsdC5nZXRDb25maWcoKTtcblxuICBjb25zdCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgPSBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzW2Rlc2NyaXB0b3JJZF07XG5cbiAgaWYgKCFhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpIHtcbiAgICBjb25maWcubG9nZ2VyLndhcm5pbmdzQ2FsbGJhY2soYGRlc2NyaXB0b3JJZCBcIiR7ZGVzY3JpcHRvcklkfVwiIGRvZXMgbm90IG1hdGNoIHdpdGggYW55IHJlZ2lzdGVyZWQgYXN5bmMgb3BlcmF0aW9uIGRlc2NyaXB0b3JgKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmIChhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IuZGVidWcpIHtcbiAgICBjb25maWcubG9nZ2VyLnZlcmJvc2VMb2dnaW5nQ2FsbGJhY2soYEluc2lkZSBnZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IgZm9yICR7ZGVzY3JpcHRvcklkfWApO1xuICAgIGNvbmZpZy5sb2dnZXIuaW5mb0xvZ2dpbmdDYWxsYmFjaygnZ2V0QXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yIFtEYXRhIFNuYXBzaG90XTonLCB7XG4gICAgICBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3JzLFxuICAgICAgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yO1xufTsgLy8gVGhpcyBmdW5jdGlvbiB3aWxsIGRvIGFsbCB0aGUgd29yayB0byBkZXRlcm1pbmUgaWYgYW4gYXN5bmMgb3BlcmF0aW9uIGlzIHJldHVybmVkIGFzIGFuIGluaXRpYWwgYXN5bmMgb3BlcmF0aW9uXG4vLyAoaWYgaXQgaXMgbm90IGZvdW5kIGluIHN0YXRlKSwgYW4gYXN5bmNPcGVyYXRpb24gd2l0aCBwYXJlbnRBc3luY09wZXJhdGlvbiBtZXRhRGF0YSAocmVjdXJzaXZlbHkgc2VhcmNoZWQgdG8gZmluZCBpZiB0aGUgcGFyZW50QXN5bmNPcGVyYXRpb24gaXMgbW9yZVxuLy8gdXAtdG8tZGF0ZSkgb3IganVzdCB0aGUgYXN5bmNPcGVyYXRpb24gaXRzZWxmIGlmIHRoZSBub25lIG9mIHRoZSBhYm92ZSBhcHBseS5cblxuXG5jb25zdCBnZXRBc3luY09wZXJhdGlvbiA9IChzdGF0ZSwgcmVnaXN0ZXJlZEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcnMsIGFzeW5jT3BlcmF0aW9uS2V5LCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IsIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBmaWVsZHNUb0FkZCkgPT4ge1xuICBjb25zdCBjb25maWcgPSBfY29uZmlnLmRlZmF1bHQuZ2V0Q29uZmlnKCk7XG5cbiAgY29uc3QgZmllbGRzVG9BZGRUb0FjdGlvbiA9IF9vYmplY3RTcHJlYWQoe30sIGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBmaWVsZHNUb0FkZCwge1xuICAgIC8vIGtleSBmb3IgdGhlIGRlc2NyaXB0b3Igb2YgdGhlIGFzeW5jT3BlcmF0aW9uXG4gICAgZGVzY3JpcHRvcklkOiBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IuZGVzY3JpcHRvcklkXG4gIH0pO1xuXG4gIGxldCBwYXJlbnRBc3luY09wZXJhdGlvbjtcbiAgbGV0IGFzeW5jT3BlcmF0aW9uID0gc3RhdGVbYXN5bmNPcGVyYXRpb25LZXldIHx8IG51bGw7XG5cbiAgaWYgKGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvci5wYXJlbnRPcGVyYXRpb25EZXNjcmlwdG9ySWQpIHtcbiAgICAvLyBncmFiIGtleSwgZGVzY3JpcHRvciwgcGFyYW1zLCBhbmQgYXN5bmMgb3BlcmF0aW9uIGZvciBwYXJlbnRBc3luY09wZXJhdGlvblxuICAgIGNvbnN0IHBhcmVudEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IGdldEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcihyZWdpc3RlcmVkQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycywgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yLnBhcmVudE9wZXJhdGlvbkRlc2NyaXB0b3JJZCk7XG4gICAgY29uc3QgcGFyZW50QXN5bmNPcGVyYXRpb25QYXJhbXMgPSAoMCwgX2hlbHBlcnMuZ2V0QW5kVmFsaWRhdGVQYXJhbXMpKGFzeW5jT3BlcmF0aW9uUGFyYW1zLCBwYXJlbnRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpO1xuICAgIGNvbnN0IHBhcmVudEFzeW5jT3BlcmF0aW9uS2V5ID0gKDAsIF9oZWxwZXJzLmdlbmVyYXRlQXN5bmNPcGVyYXRpb25LZXkpKGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvci5wYXJlbnRPcGVyYXRpb25EZXNjcmlwdG9ySWQsIHBhcmVudEFzeW5jT3BlcmF0aW9uUGFyYW1zKTtcbiAgICBwYXJlbnRBc3luY09wZXJhdGlvbiA9IGdldEFzeW5jT3BlcmF0aW9uKHN0YXRlLCByZWdpc3RlcmVkQXN5bmNPcGVyYXRpb25EZXNjcmlwdG9ycywgcGFyZW50QXN5bmNPcGVyYXRpb25LZXksIHBhcmVudEFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciwgYXN5bmNPcGVyYXRpb25QYXJhbXMsIGZpZWxkc1RvQWRkVG9BY3Rpb24pO1xuICB9XG5cbiAgaWYgKGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvci5kZWJ1Zykge1xuICAgIGNvbmZpZy5sb2dnZXIudmVyYm9zZUxvZ2dpbmdDYWxsYmFjayhgSW5zaWRlIGdldEFzeW5jT3BlcmF0aW9uIGZvciAke2FzeW5jT3BlcmF0aW9uS2V5fWApO1xuICAgIGNvbmZpZy5sb2dnZXIuaW5mb0xvZ2dpbmdDYWxsYmFjaygnZ2V0QXN5bmNPcGVyYXRpb24gW0RhdGEgU25hcHNob3RdOicsIHtcbiAgICAgIHN0YXRlLFxuICAgICAgYXN5bmNPcGVyYXRpb25QYXJhbXMsXG4gICAgICBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IsXG4gICAgICBhc3luY09wZXJhdGlvbixcbiAgICAgIGFzeW5jT3BlcmF0aW9uS2V5XG4gICAgfSk7XG4gIH1cblxuICBpZiAoIWFzeW5jT3BlcmF0aW9uKSB7XG4gICAgaWYgKGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvci5kZWJ1Zykge1xuICAgICAgY29uZmlnLmxvZ2dlci52ZXJib3NlTG9nZ2luZ0NhbGxiYWNrKGBhc3luY09wZXJhdGlvbiBub3QgZm91bmQgd2l0aCBnaXZlbiBrZXk6ICR7YXN5bmNPcGVyYXRpb25LZXl9LiBEZWZhdWx0aW5nIHRvIGFuIGluaXRpYWwgYXN5bmNPcGVyYXRpb25gKTtcbiAgICB9XG5cbiAgICBhc3luY09wZXJhdGlvbiA9IGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvci5vcGVyYXRpb25UeXBlID09PSBfY29uc3RhbnRzLkFTWU5DX09QRVJBVElPTl9UWVBFUy5SRUFEID8gKDAsIF9hc3luY09wZXJhdGlvblV0aWxzLmluaXRpYWxSZWFkQXN5bmNPcGVyYXRpb25Gb3JBY3Rpb24pKGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvci5kZXNjcmlwdG9ySWQsIGZpZWxkc1RvQWRkVG9BY3Rpb24sIHBhcmVudEFzeW5jT3BlcmF0aW9uKSA6ICgwLCBfYXN5bmNPcGVyYXRpb25VdGlscy5pbml0aWFsV3JpdGVBc3luY09wZXJhdGlvbkZvckFjdGlvbikoYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yLmRlc2NyaXB0b3JJZCwgZmllbGRzVG9BZGRUb0FjdGlvbiwgcGFyZW50QXN5bmNPcGVyYXRpb24pO1xuICB9IC8vIFdlIHdhbnQgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgb3Igbm90IHRvIHVzZSB0aGF0IHBhcmVudEFzeW5jT3BlcmF0aW9uIG1ldGFEYXRhIGJhc2VkIG9uIHRoZVxuICAvLyBuZXduZXNzIG9mIGl0J3MgZGF0YSBpbiBjb21wYXJpc29uIHRvIHRoZSBhc3luY09wZXJhdGlvblxuXG5cbiAgaWYgKHBhcmVudEFzeW5jT3BlcmF0aW9uICYmIGFzeW5jT3BlcmF0aW9uKSB7XG4gICAgcmV0dXJuIHBhcmVudEFzeW5jT3BlcmF0aW9uLmxhc3REYXRhU3RhdHVzVGltZS52YWx1ZU9mKCkgPiBhc3luY09wZXJhdGlvbi5sYXN0RGF0YVN0YXR1c1RpbWUudmFsdWVPZigpID8gX29iamVjdFNwcmVhZCh7fSwgYXN5bmNPcGVyYXRpb24sIF9sb2Rhc2guZGVmYXVsdC5waWNrKHBhcmVudEFzeW5jT3BlcmF0aW9uLCBfY29uc3RhbnRzLnJlYWRBc3luY09wZXJhdGlvbkZpZWxkc1RvUHVsbEZyb21QYXJlbnQpKSA6IGFzeW5jT3BlcmF0aW9uO1xuICB9XG5cbiAgcmV0dXJuIGFzeW5jT3BlcmF0aW9uO1xufTtcblxuY29uc3QgdXBkYXRlQXN5bmNPcGVyYXRpb24gPSAoc3RhdGUsIGFzeW5jT3BlcmF0aW9uS2V5LCBhc3luY09wZXJhdGlvbiwgYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yKSA9PiB7XG4gIGNvbnN0IGNvbmZpZyA9IF9jb25maWcuZGVmYXVsdC5nZXRDb25maWcoKTtcblxuICBpZiAoYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yLmRlYnVnKSB7XG4gICAgY29uZmlnLmxvZ2dlci52ZXJib3NlTG9nZ2luZ0NhbGxiYWNrKGBJbnNpZGUgdXBkYXRlQXN5bmNPcGVyYXRpb24gZm9yICR7YXN5bmNPcGVyYXRpb25LZXl9YCk7XG4gICAgY29uZmlnLmxvZ2dlci5pbmZvTG9nZ2luZ0NhbGxiYWNrKCd1cGRhdGVBc3luY09wZXJhdGlvbiBbRGF0YSBTbmFwc2hvdF06Jywge1xuICAgICAgc3RhdGUsXG4gICAgICBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IsXG4gICAgICBhc3luY09wZXJhdGlvbixcbiAgICAgIGFzeW5jT3BlcmF0aW9uS2V5XG4gICAgfSk7XG4gIH1cblxuICBfcHJvcFR5cGVzLmRlZmF1bHQuY2hlY2tQcm9wVHlwZXMoX3R5cGVzLmFzeW5jT3BlcmF0aW9uUHJvcFR5cGUsIGFzeW5jT3BlcmF0aW9uLCAncHJvcCcsICdhc3luY09wZXJhdGlvbicpO1xuXG4gIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwge1xuICAgIFthc3luY09wZXJhdGlvbktleV06IGFzeW5jT3BlcmF0aW9uXG4gIH0pO1xufTtcblxuY29uc3QgYnVsa1VwZGF0ZUFzeW5jT3BlcmF0aW9ucyA9IChzdGF0ZSwgYXN5bmNPcGVyYXRpb25zTGlzdCkgPT4ge1xuICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0LnJlZHVjZShhc3luY09wZXJhdGlvbnNMaXN0LCAoYWNjdW11bGF0b3IsIF9yZWYpID0+IHtcbiAgICBsZXQgYXN5bmNPcGVyYXRpb25LZXkgPSBfcmVmLmFzeW5jT3BlcmF0aW9uS2V5LFxuICAgICAgICBhc3luY09wZXJhdGlvbiA9IF9yZWYuYXN5bmNPcGVyYXRpb24sXG4gICAgICAgIGFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvciA9IF9yZWYuYXN5bmNPcGVyYXRpb25EZXNjcmlwdG9yO1xuICAgIHJldHVybiB1cGRhdGVBc3luY09wZXJhdGlvbihhY2N1bXVsYXRvciwgYXN5bmNPcGVyYXRpb25LZXksIGFzeW5jT3BlcmF0aW9uLCBhc3luY09wZXJhdGlvbkRlc2NyaXB0b3IpO1xuICB9LCBzdGF0ZSk7XG59O1xuXG52YXIgX2RlZmF1bHQgPSB7XG4gIHVwZGF0ZUFzeW5jT3BlcmF0aW9uRGVzY3JpcHRvcixcbiAgdXBkYXRlQXN5bmNPcGVyYXRpb24sXG4gIGJ1bGtVcGRhdGVBc3luY09wZXJhdGlvbnMsXG4gIGdldEFzeW5jT3BlcmF0aW9uLFxuICBnZXRBc3luY09wZXJhdGlvbkRlc2NyaXB0b3Jcbn07XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDsiXX0=